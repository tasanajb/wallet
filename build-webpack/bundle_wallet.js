(()=>{"use strict";var e={448:function(e,t,a){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.transport=void 0;const r=n(a(5184));n(a(5142)).default.config(),t.transport=r.default.createTransport({host:process.env.MAIL_HOST,port:parseInt(process.env.MAIL_PORT),ignoreTLS:!1,tls:{rejectUnauthorized:!1},secure:"0"!=process.env.MAIL_SECURE,auth:{user:process.env.EMAIL_USERNAME,pass:process.env.EMAIL_PASSWORD}})},2275:function(e,t,a){var n=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function o(e){try{s(n.next(e))}catch(e){i(e)}}function d(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,d)}s((n=n.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.createRequestSecond=t.createPoolSecond=t.createRequest=t.createPoolFirst=t.poolSecond=t.pool=void 0;const i=r(a(9424));t.createPoolFirst=function(e){return n(this,void 0,void 0,(function*(){t.pool=yield new i.default.ConnectionPool(Object.assign({},e)).connect()}))},t.createRequest=function(e=null){return null==e?t.pool.request():new i.default.Request(e)},t.createPoolSecond=function(e){return n(this,void 0,void 0,(function*(){t.poolSecond=yield new i.default.ConnectionPool(Object.assign({},e)).connect()}))},t.createRequestSecond=function(e=null){return null==e?t.poolSecond.request():new i.default.Request(e)}},1383:function(e,t,a){var n=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function o(e){try{s(n.next(e))}catch(e){i(e)}}function d(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,d)}s((n=n.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.checkToken=t.token=void 0;const i=r(a(6113)),o=r(a(5960)),d=a(961),s=a(2275);t.token=(e,t,a)=>n(void 0,void 0,void 0,(function*(){try{let a,{client_id:n,client_secret:r,grant_type:c,scope:u}=e.body,l="Bearer",_=7200,p="success";if("client_credentials"===c)if(n===process.env.TOKEN_CLIENT_ID&&r===process.env.TOKEN_CLIENT_SECRET){let e=i.default.createHmac("sha256",n+"+"+r).update(process.env.TOKEN_CLIENT_SIG).digest("base64");a=o.default.sign({message:p,result:e},{expiresIn:"2h",algorithm:"RS256"}),yield d.Transaction_Token_User.delete((0,s.createRequest)(),{user_id:"0"}),yield d.Transaction_Token_User.insert((0,s.createRequest)(),{user_id:"0",token_id:a,status:"active"})}else p="The client_id or client_secret was not correct";else p="The Client Credentials grant type is used by clients to obtain an access token outside of the context of a user.";t.send({message:p,access_token:a,token_type:l,expires_in:_,scope:u})}catch(e){a(e)}})),t.checkToken=(e,t,a)=>n(void 0,void 0,void 0,(function*(){try{t.send({status:200,message:"OK"})}catch(e){a(e)}}))},2548:function(e,t,a){var n=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function o(e){try{s(n.next(e))}catch(e){i(e)}}function d(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,d)}s((n=n.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.checkCredit=t.stampLog=t.creditLoan=t.creditNCB=void 0;const i=a(2275),o=r(a(9424)),d=r(a(6517)),s=a(961),c=a(3833);let u,l,_;function p(e,t,a,r){return n(this,void 0,void 0,(function*(){const l=yield(0,i.createRequest)().input("developer_id",o.default.Int,t).query("\n        SELECT DeveloperId, TotalBalance, TotalIn, TotalOut, ExpiredDate \n        FROM Master_Credit_Free \n        WHERE TotalBalance > 0 AND DeveloperId = @developer_id AND ExpiredDate >= getDate() \n    ");let _,p,f,m=(0,c.snakeCaseKeys)(l.recordset[0]),h={};if(m)_=m.total_balance-1,p=m.total_out+1,f=!0,yield s.Master_Credit_Free.update((0,i.createRequest)(),{total_balance:_,total_out:p,update_date:new Date},{developer_id:t}),h={body:e,before:d.default.omit(m,["id","developer_id"])};else{const n=yield s.Master_Credit_Balance.findOne((0,i.createRequest)(),{developer_id:t});if(!n)return{status:400,message:"หักเครดิตไม่สำเร็จ ไม่พบบัญชี Wallet กรุณาติดต่อผู้ให้บริการ"};if(!(n.total_balance>=1500&&n.total_balance-a>=1e3))return{status:400,message:"หักเครดิตไม่สำเร็จ เครดิตไม่เพียงพอ กรุณาติดต่อผู้ให้บริการ"};_=n.total_balance-a,p=n.total_out+a,f=!1,yield s.Master_Credit_Balance.update((0,i.createRequest)(),{total_balance:_,total_out:p,update_date:new Date},{developer_id:t}),h={body:e,before:d.default.omit(n,["id","developer_id"])}}return u=yield function(e){return n(this,void 0,void 0,(function*(){const e=yield(0,i.createRequest)().input("RunKey",o.default.NVarChar,"O").input("KeyCode",o.default.NVarChar,"O").input("CreateDate",o.default.Date,new Date).execute("sp_CreateRunning");return e?String(e.recordset[0].RunKey):null}))}(),yield s.Transaction_Out_Log.insert((0,i.createRequest)(),{order_code:u,type:"out",amount:a,status:"สำเร็จ",developer_id:t}),yield s.Transaction_Activity_Log.update((0,i.createRequest)(),{referance_id:u,body:JSON.stringify(h),is_credit_free:f,update_date:new Date,description_code:"success",description:"สำเร็จ",response:"{ status: 200,  message: 'หักเครดิตสำเร็จ'}",update_by:"0"},{transaction_id:r,description_code:"pending"}),{status:200,message:"หักเครดิตสำเร็จ"}}))}t.creditNCB=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const{developer_code:a,is_credit:n,ncb_id:r}=e.body;_=r;let o=process.env.WALLET_NCB;const d=yield s.Master_Developer.findOne((0,i.createRequest)(),{developer_code:a});if(!d)throw{status:400,message:"หักเครดิตไม่สำเร็จ ไม่พบ developer กรุณาติดต่อผู้ให้บริการ"};if(l=d.id,yield s.Transaction_Activity_Log.insert((0,i.createRequest)(),{transaction_id:_,developer_id:l,is_credit:n,type:"หักเครดิต(ncb)",method:"post",origin:e.originalUrl,header:JSON.stringify(e.headers),body:JSON.stringify(e.body),description_code:"pending",description:"รอดำเนินการ",create_by:"0"}),n){const t=yield p(e.body,l,parseInt(o),_);if(200!=t.status)throw t}else yield s.Transaction_Activity_Log.update((0,i.createRequest)(),{response:"{ status: 200, message: 'หักเครดิตสำเร็จ' }",update_date:new Date,update_by:"0",description_code:"success",description:"สำเร็จ"},{transaction_id:_,description_code:"pending"});t.status(200).send({status:200,message:"หักเครดิตสำเร็จ"})}catch(e){yield s.Transaction_Activity_Log.update((0,i.createRequest)(),{error_message:e.message,description_code:"failed",description:"ไม่สำเร็จ",update_date:new Date},{transaction_id:_,description_code:"pending"}),t.status(500|e.status).send({status:500|e.status,message:e.message})}})),t.creditLoan=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const{developer_code:a,is_credit:n,loan_id:r}=e.body;_=r;let o=process.env.WALLET_LOAN;const c=yield s.Master_Developer.findOne((0,i.createRequest)(),{developer_code:a});if(!c)throw{status:400,message:"หักเครดิตไม่สำเร็จ ไม่พบ developer กรุณาติดต่อผู้ให้บริการ"};l=c.id;const u=yield s.Master_Credit_Balance.findOne((0,i.createRequest)(),{developer_id:l}),f={body:e.body,before:d.default.omit(u,["id","developer_id"])};if(yield s.Transaction_Activity_Log.insert((0,i.createRequest)(),{transaction_id:_,developer_id:l,is_credit:n,type:"หักเครดิต(loan)",method:"post",origin:e.originalUrl,header:JSON.stringify(e.headers),body:JSON.stringify(f),description_code:"pending",description:"รอดำเนินการ",create_by:"0"}),n){const t=yield p(e.body,l,parseInt(o),_);if(200!=t.status)throw t}else yield s.Transaction_Activity_Log.update((0,i.createRequest)(),{response:"{ status: 200, message: 'หักเครดิตสำเร็จ' }",update_date:new Date,update_by:"0",description_code:"success",description:"สำเร็จ"},{transaction_id:_,description_code:"pending"});t.status(200).send({status:200,message:"หักเครดิตสำเร็จ"})}catch(e){yield s.Transaction_Activity_Log.update((0,i.createRequest)(),{error_message:e.message,description_code:"failed",description:"ไม่สำเร็จ",update_date:new Date},{transaction_id:_,description_code:"pending"}),t.status(500|e.status).send({status:500|e.status,message:e.message})}})),t.stampLog=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const a=yield s.Master_Developer.findOne((0,i.createRequest)(),{developer_code:e.body[0].developer_code});for(let t in e.body)yield s.Transaction_Stamp_Log.insert((0,i.createRequest)(),{order_code:e.body[t].order_code,type:e.body[t].type,amount:e.body[t].amount,status:"success",developer_id:a.id});t.status(200).send({status:200,message:"บันทึกสำเร็จ"})}catch(e){t.status(500).send({status:500,message:e.message})}})),t.checkCredit=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const{developer_code:a,amount:n}=e.body,r=yield s.Master_Developer.findOne((0,i.createRequest)(),{developer_code:a});if(!r)throw{status:400,message:"หักเครดิตไม่สำเร็จ ไม่พบ developer กรุณาติดต่อผู้ให้บริการ"};let d=r.id;const u=yield(0,i.createRequest)().input("developer_id",o.default.Int,d).query("\n        SELECT DeveloperId, TotalBalance, TotalIn, TotalOut, ExpiredDate \n        FROM Master_Credit_Free \n        WHERE TotalBalance > 0 AND DeveloperId = @developer_id AND ExpiredDate >= getDate()  \n      ");let l=(0,c.snakeCaseKeys)(u.recordset[0]);const _=yield s.Master_Credit_Balance.findOne((0,i.createRequest)(),{developer_id:d});if(!_)return t.status(400).send({status:400,message:"หักเครดิตไม่สำเร็จ ไม่พบบัญชี Wallet กรุณาติดต่อผู้ให้บริการ"});if(!(_.total_balance>=1500&&_.total_balance-parseInt(n)>=1e3))return t.status(400).send({status:400,message:"เครดิตไม่เพียงพอ กรุณาติดต่อผู้ให้บริการ",data:{credit_balance:(null==_?void 0:_.total_balance)||0,credit_free_balance:(null==l?void 0:l.total_balance)||0,credit_free_expire_date:(null==l?void 0:l.expired_date)||""}});t.status(200).send({status:200,message:"เครดิตเพียงพอ สารถทำรายการต่อได้",data:{credit_balance:(null==_?void 0:_.total_balance)||0,credit_free_balance:(null==l?void 0:l.total_balance)||0,credit_free_expire_date:(null==l?void 0:l.expired_date)||""}})}catch(e){t.status(500|e.status).send({status:500|e.status,message:e.message})}}))},7059:function(e,t,a){var n=this&&this.__createBinding||(Object.create?function(e,t,a,n){void 0===n&&(n=a);var r=Object.getOwnPropertyDescriptor(t,a);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,n,r)}:function(e,t,a,n){void 0===n&&(n=a),e[n]=t[a]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&n(t,e,a);return r(t,e),t},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const d=o(a(6860)),s=a(1383),c=i(a(2548)),u=a(2821),l=d.default.Router();l.post("/credit/ncb/out",u.withOAuth,c.creditNCB),l.post("/credit/loan/out",u.withOAuth,c.creditLoan),l.post("/credit/ncb/stamp",u.withOAuth,c.stampLog),l.post("/credit/check",u.withOAuth,c.checkCredit),l.post("/oauth/token",s.token),l.post("/oauth/me",u.withOAuth,s.checkToken),t.default=l},5045:function(e,t,a){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(a(6860)),i=n(a(7059)),o=n(a(298)),d=r.default.Router();d.use("/externals",i.default),d.use("/internals",o.default),t.default=d},8563:function(e,t,a){var n=this&&this.__createBinding||(Object.create?function(e,t,a,n){void 0===n&&(n=a);var r=Object.getOwnPropertyDescriptor(t,a);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,n,r)}:function(e,t,a,n){void 0===n&&(n=a),e[n]=t[a]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&n(t,e,a);return r(t,e),t},o=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function o(e){try{s(n.next(e))}catch(e){i(e)}}function d(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,d)}s((n=n.apply(e,t||[])).next())}))},d=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getModule=t.login=t.createUser=void 0;const s=a(961),c=a(2275),u=d(a(7096)),l=i(a(9424)),_=d(a(6517)),p=d(a(5960)),f=a(3833);function m(e){return o(this,void 0,void 0,(function*(){const t=yield(0,c.createRequest)().input("id",l.default.Int,e).query("SELECT DISTINCT t3.Id, t3.Path, t3.Name, t3.ParentId, t3.Seq\n       FROM Mapping_Role_User t1\n       INNER JOIN Mapping_Role_Module t2 ON t1.RoleId = t2.RoleId\n       INNER JOIN Master_Module t3 ON t2.ModuleId = t3.Id AND t3.Status = 'active'\n       WHERE t1.UserId = @id\n        ORDER BY t3.Seq ");return yield(0,f.snakeCaseKeys)(t.recordset)}))}t.createUser=(e,t,a)=>o(void 0,void 0,void 0,(function*(){let a=new l.default.Transaction(c.pool);try{yield a.begin();const{first_name:n,last_name:r,email:i,password:o,role_id:d}=e.body;if(yield s.Master_User.findOne((0,c.createRequest)(),{email:i}))t.status(400).send({status:400,message:"This user account already exists."});else{const e=u.default.hashSync(o,10),l=yield s.Master_User.insert((0,c.createRequest)(a),{first_name:n,last_name:r,email:i,password:e,status:"active"});yield s.Mapping_Role_User.insert((0,c.createRequest)(a),{user_id:parseInt(l),role_id:parseInt(d)}),yield a.commit(),t.status(200).send({status:200,message:"success"})}}catch(e){a&&(yield a.rollback()),t.status(500).send({status:500,message:"error"})}})),t.login=(e,t,a)=>o(void 0,void 0,void 0,(function*(){var a;let n=new l.default.Transaction(c.pool);try{yield n.begin();const{user_name:r,password:i}=e.body,o=yield(0,c.createRequest)(n).input("user",l.NVarChar,r).input("status",l.NVarChar,"active").query("\n        SELECT *\n          FROM  Master_User as u\n          LEFT JOIN  Mapping_Role_User as map on u.Id = map.UserId\n          WHERE email = @user AND Status = @status\n        "),d=(0,f.snakeCaseKeys)(o.recordset[0]);let h,y;if(d||(yield n.commit(),t.status(400).send({status:400,message:"ไม่พบผู้ใช้"})),d&&u.default.compareSync(i,d.password)){h=_.default.omit(d,["password","status","user_id","created_date","modified_date"]),y=p.default.sign(h,{expiresIn:"12h",algorithm:"RS256"}),yield s.Transaction_Token_User.insert((0,c.createRequest)(n),{user_id:null===(a=h.id)||void 0===a?void 0:a.toString(),token_id:y,status:"active"});let e=yield m(d.id);yield n.commit(),t.status(200).send({status:200,message:"success",data:{data:h,module_data:e},token:y})}else yield n.commit(),t.status(400).send({status:400,message:"ชื่อผู้ใช้ หรือ รหัสผ่าน ไม่ถูกต้อง"})}catch(e){n&&(yield n.rollback()),t.status(500).send({status:500,message:"error"})}})),t.getModule=(e,t,a)=>o(void 0,void 0,void 0,(function*(){try{const a=yield m(e.auth.id);t.status(200).send({status:200,message:"success",data:Object.assign(Object.assign({},e.auth),{module_data:a})})}catch(e){t.status(500).send({status:500,message:"error"})}}))},6923:function(e,t,a){var n=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function o(e){try{s(n.next(e))}catch(e){i(e)}}function d(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,d)}s((n=n.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.historysCreditFreeForAdmin=t.historyCreditFree=t.changExpiredCreditFree=t.cancelCreditFree=t.addCreditFree=t.creditHistory=t.history=t.cancelCredit=t.addCredit=void 0;const i=a(3833),o=a(2275),d=r(a(9424)),s=r(a(6517)),c=a(961);let u,l;function _(e){return n(this,void 0,void 0,(function*(){const t=yield(0,o.createRequest)().input("RunKey",d.default.NVarChar,e).input("KeyCode",d.default.NVarChar,e).input("CreateDate",d.default.Date,new Date).execute("sp_CreateRunning");return t?String(t.recordset[0].RunKey):null}))}t.addCredit=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const{user_id:a,developer_id:n,amount:r}=e.body;if(l=yield _("IN"),!l)throw{status:400,message:"Can’t generate transection id"};const i=yield c.Master_Credit_Balance.findOne((0,o.createRequest)(),{developer_id:n}),d={body:e.body,before:s.default.omit(i,["id","developer_id"])};if(yield c.Transaction_Activity_Log.insert((0,o.createRequest)(),{transaction_id:l,developer_id:n,is_credit:!1,type:"เติมเครดิต",method:"post",origin:e.originalUrl,header:JSON.stringify(e.headers),body:JSON.stringify(d),description_code:"pending",description:"รอดำเนินการ",create_by:a}),u=yield _("I"),!u)throw{status:400,message:"Can’t generate order code"};if(yield c.Transaction_In_Log.insert((0,o.createRequest)(),{order_code:u,developer_id:n,type:"IN",amount:r,status:"สำเร็จ"}),i){let e=i.total_balance+r,t=i.total_in+r;yield c.Master_Credit_Balance.update((0,o.createRequest)(),{developer_id:n,total_balance:e,total_in:t,update_date:new Date},{developer_id:n})}else yield c.Master_Credit_Balance.insert((0,o.createRequest)(),{developer_id:n,total_balance:r,total_in:r,total_out:0});yield c.Transaction_Activity_Log.update((0,o.createRequest)(),{referance_id:u,response:"{ status: 200, message: 'เพิ่มเครดิตสำเร็จ' }",description_code:"success",description:"สำเร็จ",update_by:a,update_date:new Date},{transaction_id:l}),t.status(200).send({status:200,message:"เพิ่มเครดิตสำเร็จ"})}catch(e){yield c.Transaction_Activity_Log.update((0,o.createRequest)(),{error_message:e.message,description_code:"failed",description:"ไม่สำเร็จ",update_date:new Date},{transaction_id:l}),t.status(500).send({status:500|e.status,message:e.message})}})),t.cancelCredit=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const{order_code:a,user_id:n}=e.body,r=yield c.Transaction_In_Log.findOne((0,o.createRequest)(),{order_code:a}),i=yield c.Master_Credit_Balance.findOne((0,o.createRequest)(),{developer_id:null==r?void 0:r.developer_id});if(!r||!i)throw{status:400,message:"ไม่พบรายการที่ต้องการยกเลิก"};if(l=yield _("CXL"),!l)throw{status:400,message:"Can’t generate transection id"};const d={body:e.body,before:s.default.omit(i,["id","developer_id"])};if(yield c.Transaction_Activity_Log.insert((0,o.createRequest)(),{transaction_id:l,developer_id:r.developer_id,is_credit:!1,type:"ยกเลิกเครดิต",method:"post",origin:e.originalUrl,header:JSON.stringify(e.headers),body:JSON.stringify(d),description_code:"pending",description:"รอดำเนินการ",create_by:n}),"ยกเลิก"===r.status)throw{status:400,message:"รายการนี้ถูกยกเลิกแล้ว"};if(!(i.total_balance>=1e3&&i.total_balance-r.amount>=1e3))throw{status:400,message:"ยกเลิกรายการไม่สำเร็จ เงินคงเหลือไม่เพียงพอ"};yield c.Transaction_In_Log.update((0,o.createRequest)(),{status:"ยกเลิก"},{order_code:a});const u=i.total_balance-r.amount,p=i.total_in-r.amount;yield c.Master_Credit_Balance.update((0,o.createRequest)(),{total_balance:u,total_in:p},{developer_id:r.developer_id}),yield c.Transaction_Activity_Log.update((0,o.createRequest)(),{response:"{ status: 200, message: 'ยกเลิกการเติมเครดิต สำเร็จ' }",referance_id:a,update_date:new Date,update_by:n,description_code:"success",description:"สำเร็จ"},{transaction_id:l,developer_id:r.developer_id}),t.status(200).send({status:200,message:"ยกเลิกการเติมเครดิต สำเร็จ"})}catch(e){yield c.Transaction_Activity_Log.update((0,o.createRequest)(),{error_message:e.message,description_code:"failed",description:"ไม่สำเร็จ",update_date:new Date},{transaction_id:l}),t.status(500|e.status).send({status:500|e.status,message:e.message})}})),t.history=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const{developer_id:a,current_page:n,per_page:r}=e.body,s=yield(0,o.createRequest)().input("id",d.default.Int,a).input("offset",d.default.Int,n||1).input("limit",d.default.Int,r||10).query("CREATE TABLE #templactivity (Id INT, TransactionId NVARCHAR(100),CreateDate DATETIME, Type NVARCHAR(50), Description NVARCHAR(100), Amount INT)\n        INSERT INTO #templactivity (Id, TransactionId, CreateDate, Type, Description, Amount)\n        SELECT ROW_NUMBER() OVER (ORDER BY Id) AS Id, TransactionId, CreateDate, Type, Description, Amount\n        FROM (\n            SELECT log.Id, log.TransactionId, log.CreateDate, log.Type, log.Description, inlog.Amount\n            FROM Transaction_Activity_Log log\n            INNER JOIN Transaction_In_Log inlog ON log.ReferanceId = inlog.OrderCode\n            WHERE log.DeveloperId = @id AND log.Type IN('ยกเลิกเครดิต','เติมเครดิต')\n        \n            UNION ALL\n        \n            SELECT log.Id, log.TransactionId, log.CreateDate, log.Type, log.Description, outlog.Amount\n            FROM Transaction_Activity_Log log\n            INNER JOIN Transaction_Out_Log outlog ON log.ReferanceId = outlog.OrderCode\n            WHERE log.DeveloperId = @id AND log.Type LIKE'หักเครดิต%' AND log.IsCredit = 1 AND log.IsCreditFree = 0     \n        )T\n        ORDER BY CreateDate desc\n        \n        SELECT Id as RowId, TransactionId, CreateDate, Type, Description, Amount\n        FROM #templactivity\n        ORDER BY CreateDate desc\n        OFFSET (@offset-1)*@limit ROWS\n        FETCH NEXT @limit ROWS ONLY\n        SET @offset = @offset + 1\n                          \n        SELECT COUNT(0) AS Total\n        FROM #templactivity\n        \n        DROP TABLE #templactivity\n      ");t.status(200).send({total:(0,i.snakeCaseKeys)(s.recordsets[1][0].Total),data:(0,i.snakeCaseKeys)(s.recordsets[0])})}catch(e){t.status(500).send({status:500,message:e.message})}})),t.creditHistory=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const{developer_id:a,current_page:n,per_page:r}=e.body,s=yield(0,o.createRequest)().input("id",d.default.Int,a).input("offset",d.default.Int,n||1).input("limit",d.default.Int,r||10).query("\n        SELECT ROW_NUMBER() OVER (ORDER BY Id) AS RowId\n        , OrderCode, CreateDate, Status, Amount\n        FROM Transaction_In_Log\n          WHERE DeveloperId = @id AND Type = 'IN'\n          ORDER BY CreateDate DESC\n            OFFSET (@offset-1)*@limit ROWS\n            FETCH NEXT @limit ROWS ONLY\n            SET @offset = @offset + 1\n        \n        SELECT COUNT(0) AS Total FROM Transaction_In_Log WHERE DeveloperId = @id AND Type = 'IN'\n      ");t.status(200).send({total:(0,i.snakeCaseKeys)(s.recordsets[1][0].Total),data:(0,i.snakeCaseKeys)(s.recordsets[0])})}catch(e){t.status(500).send({status:500,message:e.message})}})),t.addCreditFree=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const{user_id:a,developer_id:n,amount:r,credit_expire:i}=e.body;if(l=yield _("IN"),!l)throw{status:400,message:"Can’t generate transection id"};const d=yield c.Master_Credit_Free.findOne((0,o.createRequest)(),{developer_id:n}),p={body:e.body,before:s.default.omit(d,["id","developer_id"])};if(yield c.Transaction_Activity_Log.insert((0,o.createRequest)(),{transaction_id:l,developer_id:n,is_credit:!1,type:"เติมเครดิตฟรี",method:"post",origin:e.originalUrl,header:JSON.stringify(e.headers),body:JSON.stringify(p),description_code:"pending",description:"รอดำเนินการ",create_by:String(a)}),u=yield _("I"),!u)throw{status:400,message:"Can’t generate order code"};if(yield c.Transaction_In_Log.insert((0,o.createRequest)(),{order_code:u,developer_id:n,type:"INF",amount:r,status:"สำเร็จ"}),d){let e=d.total_balance+r,t=d.total_in+r;yield c.Master_Credit_Free.update((0,o.createRequest)(),{developer_id:n,total_balance:e,total_in:t,expired_date:i,update_date:new Date},{developer_id:n})}else yield c.Master_Credit_Free.insert((0,o.createRequest)(),{developer_id:n,total_balance:r,total_in:r,total_out:0,expired_date:i});yield c.Transaction_Activity_Log.update((0,o.createRequest)(),{referance_id:u,response:"{ status: 200, message: 'เพิ่มเครดิตฟรีสำเร็จ' }",description_code:"success",description:"สำเร็จ",update_by:String(a),update_date:new Date},{transaction_id:l}),t.status(200).send({status:200,message:"เพิ่มเครดิตฟรีสำเร็จ"})}catch(e){yield c.Transaction_Activity_Log.update((0,o.createRequest)(),{error_message:e.message,description_code:"failed",description:"ไม่สำเร็จ",update_date:new Date},{transaction_id:l}),t.status(500).send({status:500|e.status,message:e.message})}})),t.cancelCreditFree=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const{order_code:a,user_id:n}=e.body,r=yield c.Transaction_In_Log.findOne((0,o.createRequest)(),{order_code:a}),i=yield c.Master_Credit_Free.findOne((0,o.createRequest)(),{developer_id:null==r?void 0:r.developer_id});if(!r||!i)throw{status:400,message:"ไม่พบรายการที่ต้องการยกเลิก"};if(l=yield _("CXL"),!l)throw{status:400,message:"Can’t generate transection id"};const d={body:e.body,before:s.default.omit(i,["id","developer_id"])};if(yield c.Transaction_Activity_Log.insert((0,o.createRequest)(),{transaction_id:l,developer_id:r.developer_id,is_credit:!1,type:"ยกเลิกเครดิตฟรี",method:"post",origin:e.originalUrl,header:JSON.stringify(e.headers),body:JSON.stringify(d),description_code:"pending",description:"รอดำเนินการ",create_by:String(n)}),"ยกเลิก"===r.status)throw{status:400,message:"รายการนี้ถูกยกเลิกแล้ว"};const u=i.total_balance-r.amount;if(u<0)throw{status:400,message:"ยกเลิกรายการไม่สำเร็จ เครดิตฟรีคงเหลือไม่เพียงพอ"};yield c.Transaction_In_Log.update((0,o.createRequest)(),{status:"ยกเลิก"},{order_code:a});const p=i.total_in-r.amount;yield c.Master_Credit_Free.update((0,o.createRequest)(),{total_balance:u,total_in:p},{developer_id:r.developer_id}),yield c.Transaction_Activity_Log.update((0,o.createRequest)(),{response:"{ status: 200, message: 'ยกเลิกการเติมเครดิต สำเร็จ' }",referance_id:a,update_date:new Date,update_by:String(n),description_code:"success",description:"สำเร็จ"},{transaction_id:l,developer_id:r.developer_id}),t.status(200).send({status:200,message:"ยกเลิกการเติมเครดิตฟรี สำเร็จ"})}catch(e){yield c.Transaction_Activity_Log.update((0,o.createRequest)(),{error_message:e.message,description_code:"failed",description:"ยกเลิกการเติมเครดิตฟรี ไม่สำเร็จ",update_date:new Date},{transaction_id:l}),t.status(500|e.status).send({status:500|e.status,message:e.message})}})),t.changExpiredCreditFree=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const{user_id:a,developer_id:n,credit_expire:r}=e.body;if(l=yield _("EXP"),!l)throw{status:400,message:"Can’t generate transection id"};const i=yield c.Master_Credit_Free.findOne((0,o.createRequest)(),{developer_id:n});if(!i)return t.status(400).send({status:400,message:"ไม่พบข้อมูลเครดิตฟรี"});const d={body:e.body,before:s.default.omit(i,["id","developer_id"])};yield c.Transaction_Activity_Log.insert((0,o.createRequest)(),{transaction_id:l,developer_id:n,is_credit:!1,type:"เปลี่ยนวันหมดอายุเครดิตฟรี",method:"post",origin:e.originalUrl,header:JSON.stringify(e.headers),body:JSON.stringify(d),description_code:"pending",description:"รอดำเนินการ",create_by:String(a)}),yield c.Master_Credit_Free.update((0,o.createRequest)(),{expired_date:r,update_date:new Date},{developer_id:n}),yield c.Transaction_Activity_Log.update((0,o.createRequest)(),{response:"{ status: 200, message: เปลี่ยนวันหมดอายุเครดิตฟรี สำเร็จ' }",description_code:"success",description:"สำเร็จ",update_by:String(a),update_date:new Date},{transaction_id:l}),t.status(200).send({status:200,message:"เปลี่ยนวันหมดอายุเครดิตฟรี สำเร็จ"})}catch(e){yield c.Transaction_Activity_Log.update((0,o.createRequest)(),{error_message:e.message,description_code:"failed",description:"เปลี่ยนวันหมดอายุเครดิตฟรี ไม่สำเร็จ",update_date:new Date},{transaction_id:l}),t.status(500).send({status:500|e.status,message:e.message})}})),t.historyCreditFree=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const{developer_id:a,current_page:n,per_page:r}=e.body,s=yield(0,o.createRequest)().input("id",d.default.Int,a).input("offset",d.default.Int,n||1).input("limit",d.default.Int,r||10).query("   \n      CREATE TABLE #templactivity (Id INT, TransactionId NVARCHAR(100),CreateDate DATETIME, Type NVARCHAR(50), Description NVARCHAR(100), Amount INT)\n      INSERT INTO #templactivity (Id, TransactionId, CreateDate, Type, Description, Amount)\n      SELECT ROW_NUMBER() OVER (ORDER BY Id) AS Id, TransactionId, CreateDate, Type, Description, Amount\n      FROM (\n          SELECT log.Id, log.TransactionId, log.CreateDate, REPLACE(log.Type,'ฟรี','') as Type, log.Description, inlog.Amount\n          FROM Transaction_Activity_Log log\n          INNER JOIN Transaction_In_Log inlog ON log.ReferanceId = inlog.OrderCode\n          WHERE log.DeveloperId = @id AND log.Type IN('ยกเลิกเครดิตฟรี','เติมเครดิตฟรี')\n      \n          UNION ALL\n      \n          SELECT log.Id, log.TransactionId, log.CreateDate, log.Type, log.Description, 1 as Amount\n          FROM Transaction_Activity_Log log\n          INNER JOIN Transaction_Out_Log outlog ON log.ReferanceId = outlog.OrderCode\n          WHERE log.DeveloperId = @id AND log.Type LIKE'หักเครดิต%' AND log.IsCredit = 1 AND log.IsCreditFree = 1     \n      )T\n      ORDER BY CreateDate desc\n      \n      SELECT Id as RowId, TransactionId, CreateDate, Type, Description, Amount\n      FROM #templactivity\n      ORDER BY CreateDate desc\n      OFFSET (@offset-1)*@limit ROWS\n      FETCH NEXT @limit ROWS ONLY\n      SET @offset = @offset + 1\n                        \n      SELECT COUNT(0) AS Total\n      FROM #templactivity\n      \n      DROP TABLE #templactivity\n      ");t.status(200).send({total:(0,i.snakeCaseKeys)(s.recordsets[1][0].Total),data:(0,i.snakeCaseKeys)(s.recordsets[0])})}catch(e){t.status(500).send({status:500,message:e.message})}})),t.historysCreditFreeForAdmin=(e,t)=>n(void 0,void 0,void 0,(function*(){try{const{developer_id:a,current_page:n,per_page:r}=e.body,s=yield(0,o.createRequest)().input("id",d.default.Int,a).input("offset",d.default.Int,n||1).input("limit",d.default.Int,r||10).query("\n        SELECT ROW_NUMBER() OVER (ORDER BY Id) AS RowId\n        , OrderCode, CreateDate, Status, Amount\n        FROM Transaction_In_Log\n          WHERE DeveloperId = @id AND Type = 'INF'\n          ORDER BY CreateDate DESC\n            OFFSET (@offset-1)*@limit ROWS\n            FETCH NEXT @limit ROWS ONLY\n            SET @offset = @offset + 1\n        \n        SELECT COUNT(0) AS Total FROM Transaction_In_Log WHERE DeveloperId = @id AND Type = 'INF'\n      ");t.status(200).send({total:(0,i.snakeCaseKeys)(s.recordsets[1][0].Total),data:(0,i.snakeCaseKeys)(s.recordsets[0])})}catch(e){t.status(500).send({status:500,message:e.message})}}))},4017:function(e,t,a){var n=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function o(e){try{s(n.next(e))}catch(e){i(e)}}function d(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,d)}s((n=n.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getDeveloperDetail=t.getDevelopers=void 0;const i=a(3833),o=a(2275),d=r(a(9424));t.getDevelopers=(e,t,a)=>n(void 0,void 0,void 0,(function*(){try{const a=yield function(){return n(this,void 0,void 0,(function*(){const e=yield(0,o.createRequest)().query(" SELECT dev.Id, dev.DeveloperCode, dev.DeveloperName, dev.DeveloperImageUrl \n            FROM  Master_Developer dev \n            WHERE IsActive = 1\n        ");return yield(0,i.snakeCaseKeys)(e.recordset)}))}();t.status(200).send({status:200,message:"success",data:Object.assign(Object.assign({},e.auth),{developer_data:a})})}catch(e){t.status(500).send({status:500,message:"error"})}})),t.getDeveloperDetail=(e,t,a)=>n(void 0,void 0,void 0,(function*(){try{const{developer_id:a}=e.body,r=yield function(e){var t,a,r,s,c,u,l;return n(this,void 0,void 0,(function*(){const n=yield(0,o.createRequest)().input("id",d.default.Int,e).query("\n        SELECT dev.DeveloperCode, dev.DeveloperName, dev.DeveloperImageUrl,\n        balance.TotalBalance, balance.UpdateDate,\n        free.TotalBalance as TotalBalanceFree, free.UpdateDate as UpdateDateFree, \n        free.ExpiredDate as CreditExpire\n        FROM  Master_Developer dev\n        LEFT JOIN Master_Credit_Balance balance ON dev.Id = balance.DeveloperId\n        LEFT JOIN Master_Credit_Free free ON free.DeveloperId = dev.Id\n        WHERE dev.Id = @id AND IsActive = 1\n    "),_=yield(0,o.createRequest)().input("id",d.default.Int,e).query("  \n        SELECT  COUNT(CASE WHEN a.DescriptionCode = 'success' THEN 1 END) AS 'success',\n                COUNT(CASE WHEN a.DescriptionCode = 'pending' THEN 1 END) AS 'pending',\n                COUNT(CASE WHEN a.DescriptionCode = 'cancel' THEN 1 END) AS 'cancel'\n        FROM Transaction_Activity_Log  a\n          WHERE a.DeveloperId = @id\n    "),p=String((new Date).getFullYear()),f=yield(0,o.createRequest)().input("developer_id",d.default.Int,e).input("year",d.default.NVarChar,p).query("\n        CREATE TABLE #tempdate (Month NVarChar(50), CreditTotal INT, Type NVARCHAR(50), MonthNumber INT);\n        INSERT INTO #tempdate (Month, CreditTotal, Type, MonthNumber)\n        VALUES    ('มกราคม',0,'',1),\n                  ('กุมภาพันธ์',0,'',2),\n                  ('มีนาคม',0,'',3),\n                  ('เมษายน',0,'',4),\n                  ('พฤษภาคม',0,'',5),\n                  ('มิถุนายน',0,'',6),\n                  ('กรกฎาคม',0,'',7),\n                  ('สิงหาคม',0,'',8),\n                  ('กันยายน',0,'',9),\n                  ('ตุลาคม',0,'',10),\n                  ('พฤษจิกายน',0,'',11),\n                  ('ธันวาคม',0,'',12)\n   \n        --credit in year\n        CREATE TABLE #tempcredit (Month NVarChar(50), Value INT, Type NVARCHAR(50), MonthNumber INT);\n        INSERT INTO #tempcredit (Month, Value, Type, MonthNumber)\n        SELECT Month, Value, Type , MonthNumber\n        FROM(   \n            SELECT Month, SUM(CreditTotal) as Value, Type, MonthNumber \n            FROM (\n              SELECT FORMAT(CreateDate, 'MMMM', 'th-TH') as Month, SUM(Amount) as CreditTotal, '1' as Type, MONTH(CreateDate) as MonthNumber\n              FROM Transaction_In_Log\n              WHERE Status <> 'ยกเลิก' AND Type = 'IN' AND YEAR(CreateDate) =  @year AND DeveloperId = @developer_id\n              GROUP BY MONTH(CreateDate), FORMAT(CreateDate, 'MMMM', 'th-TH')\n   \n              UNION ALL\n   \n              SELECT Month, CreditTotal,CASE WHEN ISNULL(Type, '') != '' THEN Type ELSE '1' END, MonthNumber \n              FROM #tempdate\n            )I\n            GROUP BY I.MonthNumber, I.Month, I.Type\n   \n            UNION\n   \n            SELECT Month, SUM(o.CreditTotal) as Value, Type, MonthNumber \n            FROM (\n              SELECT FORMAT(o.CreateDate, 'MMMM', 'th-TH') as Month, SUM(o.Amount) as CreditTotal, '2' as Type, MONTH(o.CreateDate) as MonthNumber\n              FROM Transaction_Out_Log o \n              INNER JOIN Transaction_Activity_Log a ON a.ReferanceId = o.OrderCode AND a.IsCredit = 1 AND ISNULL(a.IsCreditFree, 0) = 0\n              WHERE o.Status = 'สำเร็จ'  AND YEAR(o.CreateDate) = @year AND o.DeveloperId = @developer_id AND a.DescriptionCode ='success'\n              GROUP BY MONTH(o.CreateDate), FORMAT(o.CreateDate, 'MMMM', 'th-TH')\n   \n              UNION ALL\n   \n              SELECT Month, CreditTotal, CASE WHEN ISNULL(Type, '') != '' THEN Type ELSE '2' END, MonthNumber \n              FROM #tempdate\n            )O\n            GROUP BY O.MonthNumber, O.Month, O.Type\n        )T\n   \n        --credit free in year\n        CREATE TABLE #tempcreditfree (Month NVarChar(50), Value INT, Type NVARCHAR(50), MonthNumber INT);\n        INSERT INTO #tempcreditfree (Month, Value, Type, MonthNumber)\n        SELECT Month, Value, Type , MonthNumber\n        FROM(   \n            SELECT Month, SUM(CreditTotal) as Value, Type, MonthNumber \n            FROM (\n              SELECT FORMAT(CreateDate, 'MMMM', 'th-TH') as Month, SUM(Amount) as CreditTotal, '1' as Type, MONTH(CreateDate) as MonthNumber\n              FROM Transaction_In_Log\n              WHERE Status <> 'ยกเลิก' AND Type = 'INF' AND YEAR(CreateDate) =  @year AND DeveloperId = @developer_id\n              GROUP BY MONTH(CreateDate), FORMAT(CreateDate, 'MMMM', 'th-TH')\n   \n              UNION ALL\n   \n              SELECT Month, CreditTotal,CASE WHEN ISNULL(Type, '') != '' THEN Type ELSE '1' END, MonthNumber \n              FROM #tempdate\n            )I\n            GROUP BY I.MonthNumber, I.Month, I.Type\n   \n            UNION\n   \n            SELECT Month, SUM(o.CreditTotal) as Value, Type, MonthNumber \n            FROM (\n              SELECT FORMAT(o.CreateDate, 'MMMM', 'th-TH') as Month,  count(o.Id) as CreditTotal, '2' as Type, MONTH(o.CreateDate) as MonthNumber\n              FROM Transaction_Out_Log o \n              INNER JOIN Transaction_Activity_Log a ON a.ReferanceId = o.OrderCode AND a.IsCredit = 1 AND ISNULL(a.IsCreditFree, 0) = 1\n              WHERE o.Status = 'สำเร็จ'  AND YEAR(o.CreateDate) = @year AND o.DeveloperId = @developer_id AND a.DescriptionCode ='success'\n              GROUP BY MONTH(o.CreateDate), FORMAT(o.CreateDate, 'MMMM', 'th-TH')\n   \n              UNION ALL\n   \n              SELECT Month, CreditTotal, CASE WHEN ISNULL(Type, '') != '' THEN Type ELSE '2' END, MonthNumber \n              FROM #tempdate\n            )O\n            GROUP BY O.MonthNumber, O.Month, O.Type\n        )T\n  \n        -- credit \n        SELECT Month, Value, CASE WHEN Type = '1' THEN 'เครดิตที่เติม' WHEN Type = '2' THEN 'เครดิตที่ใช้' ELSE '' END as Type FROM #tempcredit \n        ORDER BY MonthNumber, Type asc\n  \n        SELECT SUM(CreditTotalIn) AS CreditTotalIn, SUM(CreditTotalOut) as CreditTotalOut FROM(\n        SELECT CASE WHEN Type = '1' THEN SUM(Value) ELSE 0 END as CreditTotalIn , CASE WHEN Type = '2' THEN SUM(Value) ELSE 0 END as CreditTotalOut FROM #tempcredit\n        GROUP BY Type\n      )T\n  \n        -- credit free\n        SELECT Month, Value, CASE WHEN Type = '1' THEN 'เครดิตฟรีที่เติม' WHEN Type = '2' THEN 'เครดิตฟรีที่ใช้' ELSE '' END as Type FROM #tempcreditfree\n        ORDER BY MonthNumber, Type asc\n  \n        SELECT SUM(CreditTotalIn) AS CreditTotalIn, SUM(CreditTotalOut) as CreditTotalOut \n        FROM(\n        SELECT CASE WHEN Type = '1' THEN SUM(Value) ELSE 0 END as CreditTotalIn , CASE WHEN Type = '2' THEN SUM(Value) ELSE 0 END as CreditTotalOut FROM #tempcreditfree\n        GROUP BY Type\n        )T\n  \n        --total credit all year\n        SELECT TotalIn as CreditTotalIn, TotalOut as CreditTotalOut, TotalBalance as CreditTotalBalance\n        FROM Master_Credit_Balance \n        WHERE DeveloperId = @developer_id\n  \n        --total credit free all year\n        SELECT TotalIn as CreditFreeTotalIn, TotalOut as CreditFreeTotalOut, TotalBalance as CreditFreeTotalBalance \n        FROM Master_Credit_Free \n        WHERE DeveloperId = @developer_id\n  \n        DROP TABLE #tempdate, #tempcredit, #tempcreditfree\n  \n    "),m=yield(0,o.createRequest)().input("developer_id",d.default.Int,e).query("\n    SELECT e.EmailTo, e.EmailCc, e.SendDate\n    FROM Master_Email e\n    INNER JOIN Master_Developer d ON e.DeveloperCode = d.DeveloperCode \n    WHERE d.Id = @developer_id      \n");let h=(0,i.snakeCaseKeys)(m.recordset[0]),y=(0,i.snakeCaseKeys)(null==f?void 0:f.recordsets[4][0]),N=(0,i.snakeCaseKeys)(null==f?void 0:f.recordsets[5][0]);return{dev:(0,i.snakeCaseKeys)(n.recordset[0]),dashboard:{success:(null===(t=null==_?void 0:_.recordset[0])||void 0===t?void 0:t.success)||0,cancel:(null===(a=null==_?void 0:_.recordset[0])||void 0===a?void 0:a.cancel)||0,pending:(null===(r=null==_?void 0:_.recordset[0])||void 0===r?void 0:r.pending)||0,credit_total_in:(null==y?void 0:y.credit_total_in)||0,credit_total_out:(null==y?void 0:y.credit_total_out)||0,credit_total_balance:(null==y?void 0:y.credit_total_balance)||0,credit_free_total_in:(null==N?void 0:N.credit_free_total_in)||0,credit_free_total_out:(null==N?void 0:N.credit_free_total_out)||0,credit_free_total_balance:(null==N?void 0:N.credit_free_total_balance)||0,credit:{credit:{year:p,credit_total_in:(null===(s=(0,i.snakeCaseKeys)(null==f?void 0:f.recordsets[1][0]))||void 0===s?void 0:s.credit_total_in)||0,credit_total_out:(null===(c=(0,i.snakeCaseKeys)(null==f?void 0:f.recordsets[1][0]))||void 0===c?void 0:c.credit_total_out)||0,data:(0,i.snakeCaseKeys)(null==f?void 0:f.recordsets[0])||[]},credit_free:{year:p,credit_total_in:(null===(u=(0,i.snakeCaseKeys)(null==f?void 0:f.recordsets[3][0]))||void 0===u?void 0:u.credit_total_in)||0,credit_total_out:(null===(l=(0,i.snakeCaseKeys)(null==f?void 0:f.recordsets[3][0]))||void 0===l?void 0:l.credit_total_out)||0,data:(0,i.snakeCaseKeys)(null==f?void 0:f.recordsets[2])||[]}}},email:{email_to:(null==h?void 0:h.email_to)||"",email_cc:(null==h?void 0:h.email_cc)||"",send_date:(null==h?void 0:h.send_date)||""}}}))}(a);t.status(200).send({status:200,message:"success",data:r})}catch(e){t.status(500).send({status:500,message:"error"})}}))},7123:function(e,t,a){var n=this&&this.__createBinding||(Object.create?function(e,t,a,n){void 0===n&&(n=a);var r=Object.getOwnPropertyDescriptor(t,a);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,n,r)}:function(e,t,a,n){void 0===n&&(n=a),e[n]=t[a]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&n(t,e,a);return r(t,e),t},o=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function o(e){try{s(n.next(e))}catch(e){i(e)}}function d(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,d)}s((n=n.apply(e,t||[])).next())}))},d=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.sendMailBulkSummaryJob=t.conflictDownload=t.resendEmail=t.conflictReportBulk=t.transactionEmail=t.updateEmail=t.getEmail=void 0;const s=a(3833),c=a(2275),u=d(a(9424)),l=a(961),_=i(a(6753)),p=a(82);function f(e){var t,a,n,r,i,d,s,c,u,l,p,f,m,h,y,N,v,E,T,C,b,D,O,R,I,M,A,g;return o(this,void 0,void 0,(function*(){let o={top:{style:"thin",color:{auto:1}},bottom:{style:"thin",color:{auto:1}},left:{style:"thin",color:{auto:1}},right:{style:"thin",color:{auto:1}}},L={font:{color:{rgb:"000000"},bold:!1,sz:14},alignment:{horizontal:"center"},border:o},S={font:{color:{rgb:"ffffff"},bold:!1,sz:14},alignment:{horizontal:"center",vertical:"center"},fill:{fgColor:{rgb:"800000"}},border:o};const P=(e,t,a,n,r)=>{for(let i=a;i<=n;i++)for(let a=e;a<=t;a++){const e=_.utils.encode_cell({r:i,c:a});w[e].s=r}};var w=_.utils.aoa_to_sheet([["บริษัท ไอคอน เฟรมเวิร์ค จำกัด (สำนักงานใหญ่)\nทรู ดิจิทัล พาร์ค สุขุมวิท 101 ตึกฟีนิกซ์ ชั้น 6 ห้องเลขที่ 602 ถนนสุขุมวิท\nแขวงบางจาก เขตพระโขนง กรุงเทพมหานคร ประเทศไทย 10260, โทร. 02-746-4903\n\nIcon Framework Co., Ltd., 101 True Digital Park, Phoenix Building, Floor 6 Room 602, Sukhumvit Road, Bangchak, Phrakhanong,\nBangkok 10260, Thailand, www.iconframework.com, Tel: 02-026-3802"]]);w["!rows"]=[],w["!rows"][0]={hpx:150},w.A1.s={font:{color:{rgb:"000000 "},bold:!1,sz:14},alignment:{horizontal:"right",vertical:"center"}},_.utils.sheet_add_aoa(w,[["สรุปการตรวจสอบเครดิตบูโร และยื่นขอสินเชื่อ\n(Summary of Credit Bureau Checks and Apply for a Loan)"]],{origin:"A3"}),w.A3.s={font:{color:{rgb:"800000"},sz:20},alignment:{horizontal:"center",vertical:"center"}},w["!rows"][2]={hpx:70},_.utils.sheet_add_aoa(w,[[`วันที่ระหว่าง (Date between) : ${null===(t=null==e?void 0:e.bulk_sum_data)||void 0===t?void 0:t.between_date}`],[`ชื่อบริษัท (Company name) : ${null===(a=null==e?void 0:e.bulk_sum_data)||void 0===a?void 0:a.developer_name}`]],{origin:"A5"}),P(0,0,4,5,{font:{color:{rgb:"000000"},bold:!1,sz:14},alignment:{horizontal:"left",vertical:"center"}}),_.utils.sheet_add_aoa(w,[["ที่\n(No.)","รายการ\n(Detail)","จำนวน\n(Quantity)","ราคาต่อหน่วย\n(Unit price)","ราคา (บาท)\n(Price (Baht))"]],{origin:"A8"}),w["!rows"][7]={hpx:40},P(0,4,7,7,S);let B=[];for(var U in null===(n=null==e?void 0:e.bulk_sum_data)||void 0===n?void 0:n.transantion_all){let t=null===(r=null==e?void 0:e.bulk_sum_data)||void 0===r?void 0:r.transantion_all[U];B.push([t.no,t.detail,t.quantity,t.unit_price,t.price])}_.utils.sheet_add_json(w,B,{skipHeader:!0,origin:"A9"});const j=_.utils.decode_range(w["!ref"]);P(0,j.e.c,8,j.e.r,L),P(1,1,8,j.e.r,{font:{color:{rgb:"000000"},bold:!1,sz:14},alignment:{horizontal:"left",vertical:"center"},border:o}),P(4,4,8,j.e.r,{font:{color:{rgb:"000000"},bold:!1,sz:14},alignment:{horizontal:"right",vertical:"center"},border:o}),_.utils.sheet_add_json(w,[["Bulk Free"]],{skipHeader:!0,origin:"A12"}),w.A12.s={font:{color:{rgb:"000000"},bold:!0,sz:14},alignment:{horizontal:"left",vertical:"center"}};let H=[];for(var U in null===(i=null==e?void 0:e.bulk_sum_data)||void 0===i?void 0:i.transantion_free){let t=null===(d=null==e?void 0:e.bulk_sum_data)||void 0===d?void 0:d.transantion_free[U];H.push([t.no,t.detail,t.quantity,t.unit_price,t.price])}_.utils.sheet_add_json(w,H,{skipHeader:!0,origin:"A13"});const F=_.utils.decode_range(w["!ref"]);P(0,F.e.c,12,F.e.r,L),P(1,1,12,F.e.r,{font:{color:{rgb:"000000"},bold:!1,sz:14},alignment:{horizontal:"left",vertical:"center"},border:o}),P(4,4,12,F.e.r,{font:{color:{rgb:"000000"},bold:!1,sz:14},alignment:{horizontal:"right",vertical:"center"},border:o}),_.utils.sheet_add_json(w,[["ค่าใช้จ่ายก่อนหัก Bulk Free"],["หักจาก Bulk Free"],["รวมทั้งสิ้น"]],{skipHeader:!0,origin:"B16"}),P(1,1,15,16,{font:{color:{rgb:"000000"},bold:!1,sz:14},alignment:{horizontal:"right",vertical:"center"}}),w.B18.s={font:{color:{rgb:"000000"},bold:!0,sz:14},alignment:{horizontal:"right",vertical:"center"}},_.utils.sheet_add_json(w,[[null===(c=null===(s=null==e?void 0:e.bulk_sum_data)||void 0===s?void 0:s.summary_price)||void 0===c?void 0:c.price_total],[null===(l=null===(u=null==e?void 0:e.bulk_sum_data)||void 0===u?void 0:u.summary_price)||void 0===l?void 0:l.free_price_total],[null===(f=null===(p=null==e?void 0:e.bulk_sum_data)||void 0===p?void 0:p.summary_price)||void 0===f?void 0:f.net_price_total]],{skipHeader:!0,origin:"E16"}),w.E16.s={font:{color:{rgb:"000000"},bold:!1,sz:14},alignment:{horizontal:"right",vertical:"center"}},w.E17.s={font:{color:{rgb:"000000"},bold:!1,sz:14},alignment:{horizontal:"right",vertical:"center"},border:{bottom:{style:"thin",color:{auto:1}}}},w.E18.s={font:{color:{rgb:"000000"},bold:!0,sz:14},alignment:{horizontal:"right",vertical:"center"},border:{bottom:{style:"double",color:{auto:1}}}},_.utils.sheet_add_json(w,[[`สรุป Bulk คงเหลือ (Summary of Bulk remaining) : ${null===(h=null===(m=null==e?void 0:e.bulk_sum_data)||void 0===m?void 0:m.bulk_remaining)||void 0===h?void 0:h.summary_of_bulk_date}`]],{skipHeader:!0,origin:"A20"}),_.utils.sheet_add_json(w,[["Bulk Cradit"],["Bulk Free Transaction"]],{skipHeader:!0,origin:"B21"}),_.utils.sheet_add_json(w,[[null===(N=null===(y=null==e?void 0:e.bulk_sum_data)||void 0===y?void 0:y.bulk_remaining)||void 0===N?void 0:N.credit_total_balance,"บาท (Baht)"],[null===(E=null===(v=null==e?void 0:e.bulk_sum_data)||void 0===v?void 0:v.bulk_remaining)||void 0===E?void 0:E.credit_free_total_balance,"บาท (Baht)"]],{skipHeader:!0,origin:"D21"}),w.A20.s={font:{color:{rgb:"000000"},bold:!0,sz:14},alignment:{horizontal:"left",vertical:"center"}},P(1,1,20,21,{font:{color:{rgb:"000000"},bold:!1,sz:14},alignment:{horizontal:"left",vertical:"center"}}),P(3,4,20,21,{font:{color:{rgb:"000000"},bold:!1,sz:14},alignment:{horizontal:"right",vertical:"center"}}),w["!merges"]=[{s:{r:0,c:0},e:{r:0,c:4}},{s:{r:2,c:0},e:{r:2,c:4}},{s:{r:11,c:0},e:{r:11,c:1}},{s:{r:15,c:1},e:{r:15,c:3}},{s:{r:16,c:1},e:{r:16,c:3}},{s:{r:17,c:1},e:{r:17,c:3}},{s:{r:19,c:0},e:{r:19,c:1}}],w["!cols"]=[{wch:10},{wch:70},{wch:20},{wch:20},{wch:20},{wch:20}];const k=(e,t,a,n,r)=>{for(let i=a;i<=n;i++)for(let a=e;a<=t;a++){const e=_.utils.encode_cell({r:i,c:a});q[e].s=r}},q=_.utils.aoa_to_sheet([]);_.utils.sheet_add_aoa(q,[["บริษัท ไอคอน เฟรมเวิร์ค จำกัด (สำนักงานใหญ่) ทรู ดิจิทัล พาร์ค สุขุมวิท 101 ตึกฟีนิกซ์ ชั้น 6 ห้องเลขที่ 602 ถนนสุขุมวิท แขวงบางจาก เขตพระโขนง กรุงเทพมหานคร ประเทศไทย 10260, โทร. 02-746-4903"]],{origin:"C2"}),_.utils.sheet_add_aoa(q,[["Icon Framework Co., Ltd., 101 True Digital Park, Phoenix Building, Floor 6 Room 602, Sukhumvit Road, Bangchak, Phrakhanong, Bangkok 10260, Thailand, www.iconframework.com, Tel: 02-026-3802"]],{origin:"C3"}),_.utils.sheet_add_json(q,[["รายงานสรุปยอดลูกค้าที่ตรวจสอบเครดิตบูโร และยื่นขอสินเชื่อของบริษัทอสังหาริมทรัพย์"]],{skipHeader:!0,origin:"A6"}),_.utils.sheet_add_aoa(q,[[`วันที่ระหว่าง (Date between) : ${null===(T=null==e?void 0:e.bulk_sum_data)||void 0===T?void 0:T.between_date}`],[`ชื่อบริษัท (Company name) : ${null===(C=null==e?void 0:e.bulk_sum_data)||void 0===C?void 0:C.developer_name}`]],{origin:"A8"}),k(2,2,1,2,{font:{color:{rgb:"000000"},bold:!1,sz:14},alignment:{horizontal:"left",vertical:"center"}}),q.A6.s={font:{color:{rgb:"800000"},sz:20},alignment:{vertical:"center"}},k(0,0,7,8,{font:{color:{rgb:"000000"},bold:!1,sz:14},alignment:{horizontal:"left",vertical:"center"}}),_.utils.sheet_add_aoa(q,[["รายการที่","วัน-เวลา ที่ทำรายการ","หมายเลข Unit","เลขที่ใบจอง","เลขที่สัญญา","Member ID(REM)","โครงการ","ชื่อ - สกุลลูกค้า","เลขที่บัตรประชาชน","เบอร์โทร"]],{origin:"A11"}),_.utils.sheet_add_aoa(q,[["การทำรายการ"]],{origin:"K11"}),_.utils.sheet_add_aoa(q,[["NCB","ยื่นขอสินเชื่อ"]],{origin:"K12"}),_.utils.sheet_add_aoa(q,[["วันที่ชำระค่าบริการ","เวลาที่ชำระค่าบริการ","ค่าบริการ NCB + ยื่นขอสินเชื่อ","ยื่นขอสินเชื่อ","รวมค่าบริการ"]],{origin:"M11"}),k(0,9,10,10,S),k(12,16,10,10,S),q["!autofilter"]={ref:"K12:L12"},k(10,11,11,11,S),q.K11.s=S;let V=[];for(var U in null===(b=null==e?void 0:e.bulk_sum_detail)||void 0===b?void 0:b.bulk_detail){let t=null===(D=null==e?void 0:e.bulk_sum_detail)||void 0===D?void 0:D.bulk_detail[U];V.push([t.no,t.create_date,t.unit_no,t.booking_no,t.contract_no,t.member_id,t.project_name,t.customer_name,t.citizen_id,t.mobile_number,t.ncb_date,t.loan_date,t.paid_date,t.paid_time,t.price_ncb_and_loan,t.price_loan,t.price_total])}_.utils.sheet_add_json(q,V,{skipHeader:!0,origin:"A13"});var x=_.utils.decode_range(q["!ref"]);k(0,16,12,x.e.r,L),_.utils.sheet_add_aoa(q,[["รวมค่าบริการ"]],{origin:`N${x.e.r+2}`}),_.utils.sheet_add_aoa(q,[[null===(R=null===(O=null==e?void 0:e.bulk_sum_detail)||void 0===O?void 0:O.total_price)||void 0===R?void 0:R.price_ncb_and_loan_total,null===(M=null===(I=null==e?void 0:e.bulk_sum_detail)||void 0===I?void 0:I.total_price)||void 0===M?void 0:M.price_loan_total,null===(g=null===(A=null==e?void 0:e.bulk_sum_detail)||void 0===A?void 0:A.total_price)||void 0===g?void 0:g.price_all_total]],{origin:`O${x.e.r+2}`}),q[`N${x.e.r+2}`].s={fill:{fgColor:{rgb:"f2f2f2"}},font:{color:{rgb:"000000"},bold:!0,sz:14},alignment:{horizontal:"right",vertical:"center"}},q[`O${x.e.r+2}`].s={fill:{fgColor:{rgb:"f2f2f2"}},font:{color:{rgb:")00000"},sz:14},alignment:{horizontal:"center",vertical:"center"}},q[`P${x.e.r+2}`].s={fill:{fgColor:{rgb:"f2f2f2"}},font:{color:{rgb:")00000"},sz:14},alignment:{horizontal:"center",vertical:"center"}},q[`Q${x.e.r+2}`].s={fill:{fgColor:{rgb:"f2f2f2"}},font:{color:{rgb:")00000"},bold:!0,sz:14},alignment:{horizontal:"center",vertical:"center"}},q["!merges"]=[{s:{r:10,c:0},e:{r:11,c:0}},{s:{r:10,c:1},e:{r:11,c:1}},{s:{r:10,c:2},e:{r:11,c:2}},{s:{r:10,c:3},e:{r:11,c:3}},{s:{r:10,c:4},e:{r:11,c:4}},{s:{r:10,c:5},e:{r:11,c:5}},{s:{r:10,c:6},e:{r:11,c:6}},{s:{r:10,c:7},e:{r:11,c:7}},{s:{r:10,c:8},e:{r:11,c:8}},{s:{r:10,c:9},e:{r:11,c:9}},{s:{r:10,c:10},e:{r:10,c:11}},{s:{r:10,c:12},e:{r:11,c:12}},{s:{r:10,c:13},e:{r:11,c:13}},{s:{r:10,c:14},e:{r:11,c:14}},{s:{r:10,c:15},e:{r:11,c:15}},{s:{r:10,c:16},e:{r:11,c:16}}],q["!cols"]=[{wch:10},{wch:25},{wch:20},{wch:20},{wch:20},{wch:20},{wch:20},{wch:20},{wch:20},{wch:20},{wch:20},{wch:20},{wch:20},{wch:20},{wch:30},{wch:20},{wch:20}];const Y=_.utils.book_new();return _.utils.book_append_sheet(Y,w,"Summary Report"),_.utils.book_append_sheet(Y,q,"Detail Report"),{workbook:Y,buffer:_.write(Y,{type:"buffer",bookType:"xlsx"})}}))}t.getEmail=(e,t,a)=>o(void 0,void 0,void 0,(function*(){try{const{developer_code:a}=e.body,n=yield l.Master_Email.findOne((0,c.createRequest)(),{developer_code:a});t.status(200).send({status:200,message:"succcess",data:{email_to:(null==n?void 0:n.email_to)||"",email_cc:(null==n?void 0:n.email_cc)||"",send_date:(null==n?void 0:n.send_date)||""}})}catch(e){t.status(500).send({status:500,message:e.message})}})),t.updateEmail=(e,t,a)=>o(void 0,void 0,void 0,(function*(){try{const{developer_code:a,email_to:n,email_cc:r,send_date:i}=e.body;(yield l.Master_Email.findOne((0,c.createRequest)(),{developer_code:a}))?yield l.Master_Email.update((0,c.createRequest)(),{email_to:n,email_cc:r,send_date:i,update_date:new Date},{developer_code:a}):yield l.Master_Email.insert((0,c.createRequest)(),{developer_code:a,email_to:n,email_cc:r,send_date:i}),yield l.Transaction_Email.update((0,c.createRequest)(),{status:"fail",send_to:n,send_cc:r||"",effective_date:new Date,update_date:new Date},{status:"wait email",developer_code:a}),t.status(200).send({status:200,message:"แก้ไขอีเมลสำเร็จ",data:{email_to:n||"",email_cc:r||"",send_date:i||""}})}catch(e){t.status(500).send({status:500,message:e.message})}})),t.transactionEmail=(e,t,a)=>o(void 0,void 0,void 0,(function*(){var a;try{const{year:n,month:r,developer_code:i,status:o,current_page:d,per_page:l}=e.body;let _="";switch(o){case"สำเร็จ":_="success";break;case"ไม่สำเร็จ":_="fail";break;case"กรุณาตั้งค่าอีเมล":_="wait email";break;case"รอดำเนินการ":_="pending"}const p=yield(0,c.createRequest)().input("year",u.default.NVarChar,n||"").input("month",u.default.NVarChar,r||"").input("developer_code",u.default.NVarChar,i||"").input("status",u.default.NVarChar,_||"").input("limit",u.default.Int,l||10).input("offset",u.default.Int,d||1).query("\n                SELECT e.JobId as Id, r.Month, r.Year,\n                    e.Subject , e.DeveloperCode, d.DeveloperName,\n                    FORMAT(ISNULL(e.SentDate, e.CreateDate) , 'dd/MM/yyyy') as SentDate, \n                    CASE WHEN e.Status = 'success' THEN 'สำเร็จ' \n                        WHEN  e.Status = 'fail' THEN 'ไม่สำเร็จ'\n                        WHEN  e.Status = 'wait email' THEN 'กรุณาตั้งค่าอีเมล'\n                        ELSE 'รอดำเนินการ' END as Status, r.IsConflict\n                FROM Transaction_Email e\n                INNER JOIN Transaction_Report r ON r.ReportId = e.JobId\n                INNER JOIN Master_Developer d ON e.DeveloperCode = d.DeveloperCode\n                WHERE e.DeveloperCode LIKE'%'+ @developer_code +'%' \n                AND r.MonthNumber LIKE'%' + @month +'%' AND r.Year LIKE'%'+ @year +'%'\n                AND e.Status LIKE'%' + @status + '%'\n                ORDER BY e.CreateDate, e.SentDate desc\n        \n                OFFSET (@offset-1)*@limit ROWS\n                FETCH NEXT @limit ROWS ONLY\n                SET @offset = @offset + 1\n\n\n                SELECT COUNT(0) AS Total \n                FROM Transaction_Email e\n                INNER JOIN Transaction_Report r ON r.ReportId = e.JobId\n                INNER JOIN Master_Developer d ON e.DeveloperCode = d.DeveloperCode\n                WHERE e.DeveloperCode LIKE'%'+ @developer_code +'%' \n                AND r.MonthNumber LIKE'%' + @month +'%' AND r.Year LIKE'%'+ @year +'%'\n                AND e.Status LIKE'%' + @status + '%'\n            ");t.status(200).send({status:200,message:"succcess",total:(null===(a=null==p?void 0:p.recordsets[1][0])||void 0===a?void 0:a.Total)||0,data:(0,s.snakeCaseKeys)(null==p?void 0:p.recordsets[0])||[]})}catch(e){t.status(500).send({status:500,message:e.message})}})),t.conflictReportBulk=(e,t,a)=>o(void 0,void 0,void 0,(function*(){var a,n;try{const{id:r,developer_code:i}=e.body,o=yield(0,c.createRequest)().input("developer_code",u.default.NVarChar,i).input("id",u.default.NVarChar,r).query("\n            SELECT TOP 1 e.SendTo, e.SendCC, e.Subject, e.Body, e.DeveloperCode, e.ErrorCount, e.Status, \n            r.ReportId, r.Type, r.Data, r.DataConflict, r.Month, r.MonthNumber, r.Year, r.IsConflict\n            FROM Transaction_Email e \n            INNER JOIN Transaction_Report r ON e.JobId = r.ReportId AND e.DeveloperCode = r.DeveloperCode AND r.Type = 'bulk'\n            WHERE e.DeveloperCode = @developer_code AND e.JobId = @id\n            ");if(!o.recordset[0]||!(null===(a=null==o?void 0:o.recordset[0])||void 0===a?void 0:a.IsConflict)||!(null===(n=null==o?void 0:o.recordset[0])||void 0===n?void 0:n.DataConflict))return t.status(400).send({status:400,message:"ไม่พบข้อมูลรายงาน"});let d=(0,s.snakeCaseKeys)(o.recordset[0]),l=null==d?void 0:d.report_id,_=`summary_report_${d.month_number}${d.year}.xlsx`,p=JSON.parse(d.data_conflict);const m=yield f(p);t.status(200).send({status:200,message:"success",data:{report_id:l,file_name:_,workbook:m.workbook}})}catch(e){t.status((null==e?void 0:e.status)||500).send({status:(null==e?void 0:e.status)||500,message:e.message||"ไม่สำเร็จ"})}})),t.resendEmail=(e,t,a)=>o(void 0,void 0,void 0,(function*(){try{const{id:a,developer_code:n}=e.body,r=yield(0,c.createRequest)().input("developer_code",u.default.NVarChar,n).input("id",u.default.NVarChar,a).query("\n            SELECT TOP 1 e.SendTo, e.SendCC, e.Subject, e.Body, e.DeveloperCode, e.ErrorCount, e.Status, \n            r.ReportId, r.Type, r.Data, r.Month, r.MonthNumber, r.Year\n            FROM Transaction_Email e \n            INNER JOIN Transaction_Report r ON e.JobId = r.ReportId AND e.DeveloperCode = r.DeveloperCode AND r.Type = 'bulk'\n            WHERE e.Status <> 'success' AND e.ErrorCount <= 5 AND e.DeveloperCode = @developer_code AND e.JobId = @id\n            ");if(!r.recordset[0])return t.status(400).send({status:400,message:"ไม่พบข้อมูลรายงานการส่งอีเมล หรือส่งอีเมลนี้ไปแล้ว"});let i=(0,s.snakeCaseKeys)(r.recordset[0]);if("wait email"===(null==i?void 0:i.status))return t.status(400).send({status:400,message:"ไม่สามารถส่งอีเมลได้ กรุณาตั้งค่าอีเมลบริษัท"});let o=null==i?void 0:i.report_id,d=`summary_report_${i.month_number}${i.year}.xlsx`,_=JSON.parse(r.recordset[0].Data);yield f(_);let m=JSON.parse(i.data);const h=yield f(m);let y=[{filename:d,content:Buffer.from(h.buffer,"binary")}];const N={send_to:i.send_to,send_cc:(null==i?void 0:i.send_cc)?`${null==i?void 0:i.send_cc},${process.env.EMAIL_SUPPORT}`:"",subject:i.subject,text:i.body,html:"",attachments:y},v=yield(0,p.sendMail)(N);if(!v.status)throw v.error;yield l.Transaction_Email.update((0,c.createRequest)(),{effective_date:new Date,sent_date:new Date,update_date:new Date,status:"success"},{job_id:o}),yield l.Transaction_Report.update((0,c.createRequest)(),{status:"success",update_date:new Date},{report_id:o}),t.status(200).send({status:200,message:"ส่งอีเมลสำเร็จ"})}catch(e){t.status((null==e?void 0:e.status)||500).send({status:(null==e?void 0:e.status)||500,message:e.message||"ส่งอีเมลไม่สำเร็จ"})}})),t.conflictDownload=(e,t,a)=>o(void 0,void 0,void 0,(function*(){try{const{id:a,developer_code:n}=e.body;yield l.Transaction_Email.findOne((0,c.createRequest)(),{job_id:a,developer_code:n}),t.status(200).send({status:200,message:"ส่งอีเมลสำเร็จ"})}catch(e){t.status(500).send({status:500,message:e.message})}})),t.sendMailBulkSummaryJob=()=>o(void 0,void 0,void 0,(function*(){try{const t=yield(0,c.createRequest)().query("\n            SELECT e.SendTo, e.SendCC, e.Subject, e.Body, e.DeveloperCode, e.ErrorCount, e.Status, \n            r.ReportId, r.Type, r.Data, r.Month, r.MonthNumber, r.Year\n            FROM Transaction_Email e \n            INNER JOIN Transaction_Report r ON e.JobId = r.ReportId AND e.DeveloperCode = r.DeveloperCode AND r.Type = 'bulk'\n            WHERE e.Status <> 'success' AND e.Status <> 'wait email' AND e.ErrorCount <= 5 \n            ");let a=1,n=0;for(var e in t.recordset){let r=(0,s.snakeCaseKeys)(t.recordset[e]),i=(null==r||r.developer_code,null==r?void 0:r.report_id),o=`summary_report_${r.month_number}${r.year}.xlsx`;for(;a<=5;)try{let e=JSON.parse(r.data);const t=yield f(e);let a=[{filename:o,content:Buffer.from(t.buffer,"binary")}];const n={send_to:r.send_to,send_cc:(null==r?void 0:r.send_cc)?`${null==r?void 0:r.send_cc},${process.env.EMAIL_SUPPORT}`:"",subject:r.subject,text:r.body,html:"",attachments:a},d=yield(0,p.sendMail)(n);if(!d.status)throw d.error;yield l.Transaction_Email.update((0,c.createRequest)(),{effective_date:new Date,sent_date:new Date,update_date:new Date,status:"success"},{job_id:i}),yield l.Transaction_Report.update((0,c.createRequest)(),{status:"success",update_date:new Date},{report_id:i});break}catch(e){n+=1,yield l.Transaction_Email.update((0,c.createRequest)(),{effective_date:new Date,error_date:new Date,error_count:n,error_message:e.message,status:"fail"},{job_id:i}),a++}}return!0}catch(e){return!1}}))},298:function(e,t,a){var n=this&&this.__createBinding||(Object.create?function(e,t,a,n){void 0===n&&(n=a);var r=Object.getOwnPropertyDescriptor(t,a);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,n,r)}:function(e,t,a,n){void 0===n&&(n=a),e[n]=t[a]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&n(t,e,a);return r(t,e),t},o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.storage=void 0;const d=o(a(6860)),s=i(a(8563)),c=i(a(4017)),u=i(a(6923)),l=i(a(5373)),_=i(a(7123)),p=a(2821),f=a(5222),m=o(a(1738));t.storage=m.default.memoryStorage();const h=(0,m.default)({storage:t.storage,limits:{fileSize:26214400}}),y=d.default.Router();y.post("/auth/login",s.login),y.get("/auth/module",p.withAuthen,s.getModule),y.post("/auth/create-user",s.createUser),y.get("/developer/lists",p.withAuthen,c.getDevelopers),y.post("/developer/detail",p.withAuthen,c.getDeveloperDetail),y.post("/credit/in",p.withAuthen,u.addCredit),y.post("/credit/out",p.withAuthen,u.cancelCredit),y.post("/credit/history",p.withAuthen,u.history),y.post("/credit/add/history",p.withAuthen,u.creditHistory),y.post("/credit-free/in",p.withAuthen,u.addCreditFree),y.post("/credit-free/out",p.withAuthen,u.cancelCreditFree),y.post("/credit-free/expired",p.withAuthen,u.changExpiredCreditFree),y.post("/credit-free/history",p.withAuthen,u.historyCreditFree),y.post("/credit-free/add/history",p.withAuthen,u.historysCreditFreeForAdmin),y.post("/report/ncb",p.withAuthen,l.reportNcb),y.post("/report/loan/1",p.withAuthen,l.reportLoan),y.post("/report/loan/2",p.withAuthen,l.reportLoan),y.post("/report/loan/ncb",p.withAuthen,l.reportLoanSelf),y.post("/report/stamp/ndid",p.withAuthen,l.reportNdid),y.post("/report/stamp/set",p.withAuthen,l.reportSet),y.get("/report/developers",p.withAuthen,l.developerList),y.get("/report/projects",p.withAuthen,l.projectList),y.post("/report/ncb/txt",p.withAuthen,l.reportNcbText),y.post("/report/in/summary/user",p.withAuthen,l.reportInSummary),y.post("/report/in/summary/monitering",p.withAuthen,l.reportInSumMonitering),y.post("/report/in/summary/developer",p.withAuthen,l.reportInSumByDev),y.post("/report/bulk/summary",p.withAuthen,l.reportBulkSummary),y.post("/report/bulk/detail",p.withAuthen,l.reportBulkDetail),y.post("/compare/set/detail"),y.post("/compare/ndid/detail"),y.post("/compare/set/upload"),y.post("/compare/ndid/upload"),y.post("/report/bulk/conflict/download",p.withAuthen,_.conflictReportBulk),y.post("/report/bulk/download"),y.post("/email",p.withAuthen,_.getEmail),y.post("/email/save",p.withAuthen,_.updateEmail),y.post("/email/list",p.withAuthen,_.transactionEmail),y.post("/email/resend",p.withAuthen,_.resendEmail),y.get("/sftp/file",h.any(),f.getfileDecrypt),y.get("/sftp/list",f.getReportNcb),y.post("/sftp/retry",f.retryReportNcb),y.post("/sftp/report",f.reportNcb),t.default=y},5373:function(e,t,a){var n=this&&this.__createBinding||(Object.create?function(e,t,a,n){void 0===n&&(n=a);var r=Object.getOwnPropertyDescriptor(t,a);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,n,r)}:function(e,t,a,n){void 0===n&&(n=a),e[n]=t[a]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&n(t,e,a);return r(t,e),t},o=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function o(e){try{s(n.next(e))}catch(e){i(e)}}function d(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,d)}s((n=n.apply(e,t||[])).next())}))},d=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.reportBulkDetailData=t.reportBulkSumaryData=t.reportBulkSummaryJob=t.reportBulkDetail=t.reportBulkSummary=t.reportInSumByDev=t.reportInSumMonitering=t.reportInSummary=t.projectList=t.developerList=t.reportSet=t.reportNdid=t.reportLoanSelf=t.reportLoan=t.reportNcbText=t.reportNcb=void 0;const s=a(2275),c=d(a(9424)),u=i(a(6517)),l=a(3027),_=a(4814),p=d(a(7147)),f=a(3833),m=a(5828),h=a(961);let y;function N(e,t){const a=new Date(e);let n=a.getMonth()+1,r="",i="";if("txt"!=t)r=a.getDate()+"/"+n+"/"+a.getFullYear(),i=a.getHours()+":"+a.getMinutes()+":"+a.getSeconds();else{const e=String(n).padStart(2,"0");r=String(a.getDate()).padStart(2,"0")+e+a.getFullYear(),i=String(a.getHours()).padStart(2,"0")+String(a.getMinutes()).padStart(2,"0")+String(a.getSeconds()).padStart(2,"0")}return{date:r,time:i}}function v(e){return(0,l.maskCard)(e,{maskWith:"*",unmaskedStartDigits:3,unmaskedEndDigits:3})}function E(e){const t={maskWith:"*",values:[e.slice(4,-4)],maskAll:!1,maskSpace:!1};return(0,l.maskString)(e,t)}function T(e){return e.customer_no===y}function C(e){let t="";for(let a=0;a<e;a++)t+=" ";return t}function b(e){var t,a,n,r;return o(this,void 0,void 0,(function*(){try{const{start_date:i,end_date:o,developer_code:d,developer_name:u,project_code:l}=e;let _=process.env.DB_NAME_SECOND;const p=yield(0,s.createRequest)().input("developer_code",c.default.NVarChar,d).input("project_code",c.default.NVarChar,l||"").input("start",c.default.NVarChar,i).input("end",c.default.NVarChar,o).query(`\n            DECLARE @start_date NVARCHAR(50) = @start\n            DECLARE @end_date NVARCHAR(50) = @end\n            --Find the start date of Month\n            SET @start_date =\n                (SELECT CASE WHEN ISNULL(@start_date, '') <> '' THEN @start_date ELSE(SELECT DATEFROMPARTS(YEAR(DATEADD(MONTH, -1, getDate())), MONTH(DATEADD(MONTH, -1, getDate())), 1)) END)\n            SET @end_date = (SELECT CASE WHEN ISNULL(@end_date, '') <> '' THEN @end_date ELSE(SELECT DATEADD(DAY, -1, DATEADD(MONTH, 1, DATEFROMPARTS(YEAR(DATEADD(MONTH, -1, getDate())), MONTH(DATEADD(MONTH, -1, getDate())), 1)))) END)\n            DECLARE @month NVARCHAR(50) = FORMAT(CONVERT(DATETIME, @start_date), 'MMMM', 'th-TH')\n\n                --map tran x set\n            CREATE TABLE #temptran(TransactionId NVARCHAR(50), IsSet BIT)\n            INSERT INTO #temptran(TransactionId, IsSet)\n            SELECT DISTINCT n.NcbId as TransactionId,\n                    CASE WHEN(n.NdidRequestId IN(SELECT OrderCode FROM Transaction_Stamp_Log) AND n.ReferenceId IS NOT NULL) OR(n.ReferenceId IN(SELECT OrderCode FROM Transaction_Stamp_Log))\n            THEN 1 ELSE 0 END as IsSet\n                FROM[${_}].[dbo].[Master_Ncb] n\n            INNER JOIN[${_}].[dbo].[Master_Unit] u ON u.UnitId = n.UnitId AND u.DeveloperCode = @developer_code\n            WHERE n.NcbStatusCode <> 'NCB01' AND n.ProjectCode LIKE'%' + @project_code + '%' \n            \n            UNION ALL\n            \n            SELECT DISTINCT LoanId as TransactionId, IsSet = 1\n                FROM[${_}].[dbo].[Master_Loan] \n            WHERE Status <> 'active' AND DeveloperCode = @developer_code AND ProjectCode LIKE'%' + @project_code + '%'\n            \n            \n            CREATE TABLE #tempall(Detail NVARCHAR(200), Quantity INT, UnitPrice INT, Price INT, Month NVARCHAR(50), Type NVARCHAR(50))\n            INSERT INTO #tempall(Detail, Quantity, UnitPrice, Price, Month, Type)\n                VALUES(CONCAT('Loan Transaction Case 300 THB - เดือน', @month), 0, 300, 0, MONTH(@start_date), 'Loan'),\n                    (CONCAT('NCB Transaction Case 500 THB - เดือน', @month), 0, 500, 0, MONTH(@start_date), 'NCB')\n            \n            CREATE TABLE #tempfree(Detail NVARCHAR(200), Quantity INT, UnitPrice INT, Price INT, Month NVARCHAR(50), Type NVARCHAR(50))\n            INSERT INTO #tempfree(Detail, Quantity, UnitPrice, Price, Month, Type)\n                VALUES('Bulk Free Loan Transaction Case 300 THB (Amount 0 Transaction)', 0, 300, 0, MONTH(@start_date), 'Loan'),\n                    ('Bulk Free NCB Transaction Case 500 THB (Amount 0 Transaction)', 0, 500, 0, MONTH(@start_date), 'NCB')\n            \n            -------  start tran data -----------\n                --transantion all\n            CREATE TABLE #temptranall(Detail NVARCHAR(200), Quantity INT, UnitPrice INT, Price INT, Month NVARCHAR(50), Type NVARCHAR(50))\n            INSERT INTO #temptranall(Detail, Quantity, UnitPrice, Price, Month, Type)\n            SELECT CONCAT((CASE WHEN o.Amount = 500 THEN 'NCB' WHEN o.Amount = 300 THEN 'Loan' ELSE ''END), ' Transaction Case ', o.Amount, ' THB - เดือน', FORMAT(a.UpdateDate, 'MMMM', 'th-TH') ) as Detail,\n                    COUNT(*) as Quantity, o.Amount as UnitPrice, (COUNT(*) * o.Amount) as Price, MONTH(a.UpdateDate) as Month, (CASE WHEN o.Amount = 500 THEN 'NCB' WHEN o.Amount = 300 THEN 'Loan' ELSE ''END) as Type\n            FROM Transaction_Activity_Log a\n            INNER JOIN Transaction_Out_Log o ON o.OrderCode = a.ReferanceId\n            INNER JOIN Master_Developer d ON d.Id = a.DeveloperId AND d.DeveloperCode = @developer_code\n                WHERE\n                a.TransactionId IN(\n                    SELECT TransactionId FROM #temptran WHERE IsSet = 1\n                )\n            AND CONVERT(date, a.UpdateDate) BETWEEN @start_date AND @end_date AND a.DescriptionCode = 'success'\n            GROUP BY o.Amount, a.Type, MONTH(a.UpdateDate), FORMAT(a.UpdateDate, 'MMMM', 'th-TH')\n            ORDER BY MONTH(a.UpdateDate)\n\n                --transantion bulk free\n            CREATE TABLE #temptranfree(Detail NVARCHAR(200), Quantity INT, UnitPrice INT, Price INT, Month NVARCHAR(50), Type NVARCHAR(50))\n            INSERT INTO #temptranfree(Detail, Quantity, UnitPrice, Price, Month, Type)\n            SELECT CONCAT((CASE WHEN o.Amount = 500 THEN 'Bulk Free NCB' WHEN o.Amount = 300 THEN 'Bulk Free Loan' ELSE ''END), ' Transaction Case ', o.Amount, ' THB', ' (Amount ', COUNT(*), ' Transaction)' ) as Detail,\n                    COUNT(*) as Quantity, o.Amount as UnitPrice, (COUNT(*) * o.Amount) as Price,\n                    MONTH(a.UpdateDate) as Month, (CASE WHEN o.Amount = 500 THEN 'NCB' WHEN o.Amount = 300 THEN 'Loan' ELSE ''END) as Type\n            FROM Transaction_Activity_Log a\n            INNER JOIN Transaction_Out_Log o ON o.OrderCode = a.ReferanceId\n            INNER JOIN Master_Developer d ON  d.Id = a.DeveloperId AND d.DeveloperCode = @developer_code\n                WHERE\n                a.TransactionId IN(\n                    SELECT TransactionId FROM #temptran WHERE IsSet = 1\n                )\n            AND CONVERT(date, a.UpdateDate) BETWEEN @start_date AND @end_date \n            AND a.DescriptionCode = 'success' AND a.IsCredit = 1 AND a.IsCreditFree = 1\n            GROUP BY o.Amount, a.Type, MONTH(a.UpdateDate)\n            ORDER BY MONTH(a.UpdateDate)\n            -------  end tran data -----------\n\n            -------  start conflict data -----------\n            -- conflict transantion all\n            CREATE TABLE #tempconflicttranall (Detail NVARCHAR(200), Quantity INT, UnitPrice INT, Price INT, Month NVARCHAR(50), Type NVARCHAR(50))\n            INSERT INTO #tempconflicttranall (Detail, Quantity, UnitPrice, Price, Month, Type)\n            SELECT CONCAT((CASE WHEN o.Amount = 500 THEN 'NCB' WHEN o.Amount = 300 THEN 'Loan' ELSE ''END), ' Transaction Case ', o.Amount , ' THB - เดือน',FORMAT(a.UpdateDate, 'MMMM', 'th-TH') ) as Detail, \n            COUNT(*) as Quantity, o.Amount as UnitPrice, (COUNT(*) * o.Amount) as Price, MONTH(a.UpdateDate) as Month, (CASE WHEN o.Amount = 500 THEN 'NCB' WHEN o.Amount = 300 THEN 'Loan' ELSE ''END) as Type\n            FROM Transaction_Activity_Log a\n            INNER JOIN Transaction_Out_Log o ON o.OrderCode = a.ReferanceId\n            INNER JOIN Master_Developer d ON d.Id = a.DeveloperId AND d.DeveloperCode = @developer_code\n            WHERE \n            a.TransactionId IN(\n                SELECT TransactionId FROM #temptran WHERE IsSet = 0\n            )\n            AND \n            CONVERT(date, a.UpdateDate) BETWEEN @start_date AND @end_date AND a.DescriptionCode = 'success'\n            GROUP BY o.Amount, a.Type, MONTH(a.UpdateDate),FORMAT(a.UpdateDate, 'MMMM', 'th-TH')\n            ORDER BY MONTH(a.UpdateDate)\n            \n            -- conflict transantion bulk free\n            CREATE TABLE #tempconflicttranfree (Detail NVARCHAR(200), Quantity INT, UnitPrice INT, Price INT, Month NVARCHAR(50), Type NVARCHAR(50))\n            INSERT INTO #tempconflicttranfree (Detail, Quantity, UnitPrice, Price, Month, Type)\n            SELECT CONCAT((CASE WHEN o.Amount = 500 THEN 'Bulk Free NCB' WHEN o.Amount = 300 THEN 'Bulk Free Loan' ELSE ''END),' Transaction Case ', o.Amount , ' THB', ' (Amount ' ,COUNT(*), ' Transaction)' ) as Detail, \n            COUNT(*) as Quantity, o.Amount as UnitPrice, (COUNT(*) * o.Amount) as Price, MONTH(a.UpdateDate) as Month, (CASE WHEN o.Amount = 500 THEN 'NCB' WHEN o.Amount = 300 THEN 'Loan' ELSE ''END) as Type\n            FROM Transaction_Activity_Log a\n            INNER JOIN Transaction_Out_Log o ON o.OrderCode = a.ReferanceId\n            INNER JOIN Master_Developer d ON  d.Id = a.DeveloperId AND d.DeveloperCode = @developer_code\n            WHERE \n            a.TransactionId IN(\n                SELECT TransactionId FROM #temptran WHERE IsSet = 0\n            )\n            AND \n            CONVERT(date, a.UpdateDate) BETWEEN @start_date AND @end_date AND a.DescriptionCode = 'success' AND a.IsCredit = 1 AND a.IsCreditFree = 1\n            GROUP BY o.Amount, a.Type, MONTH(a.UpdateDate)\n            ORDER BY MONTH(a.UpdateDate)\n            -------  end conflict data -----------\n\n            -------  start select data -----------\n                --0 transantion all\n            SELECT ROW_NUMBER() OVER (ORDER BY a.Month) AS No, Detail, SUM(Quantity) as Quantity, UnitPrice, CAST(CONVERT(DECIMAL(18, 2), SUM(Price)) AS VARCHAR(255) ) as Price\n                FROM(\n                    SELECT Detail, Quantity, UnitPrice, Price, Type, Month FROM #temptranall\n                UNION ALL\n                SELECT Detail, Quantity, UnitPrice, Price, Type, Month FROM #tempall\n                )a\n            GROUP BY a.Detail, a.Type, a.UnitPrice, a.Month\n            ORDER BY a.Month asc\n\n                --1 transantion free\n            SELECT ROW_NUMBER() OVER (ORDER BY f.Detail) AS No, Detail, SUM(Quantity) as Quantity, CONCAT('-', UnitPrice) as UnitPrice, CONCAT('-', CONVERT(DECIMAL(18, 2), SUM(Price))) as Price\n                FROM(\n                    SELECT Detail, Quantity, UnitPrice, Price, Type FROM #temptranfree\n                UNION ALL\n                SELECT Detail, Quantity, UnitPrice, Price, Type FROM #tempfree WHERE Type NOT IN(SELECT Type FROM #temptranfree)\n                )f\n            GROUP BY f.Detail, f.Type, f.UnitPrice\n\n                --2 summary price\n            SELECT CAST(CONVERT(DECIMAL(18, 2), SUM(PriceTotal)) AS VARCHAR(255) ) as PriceTotal,\n                    CONCAT('-', CONVERT(DECIMAL(18, 2), SUM(FreePriceTotal))) as FreePriceTotal,\n                    CAST(CONVERT(DECIMAL(18, 2), (SUM(PriceTotal) - SUM(FreePriceTotal))) AS VARCHAR(255) ) as NetPriceTotal\n                FROM(\n                    SELECT SUM(Price) as PriceTotal, 0 as FreePriceTotal FROM #temptranall\n                UNION ALL \n                SELECT 0 as PriceTotal, SUM(Price) as FreePriceTotal FROM #temptranfree\n                )S\n\n                --3 Summary of Bulk remaining\n            SELECT FORMAT(GETDATE(), 'dd/MM/yyyy, hh:mm tt') AS SummaryOfBulkDate, ISNULL(b.TotalBalance, 0) as CreditTotalBalance, ISNULL(f.TotalBalance, 0) as CreditFreeTotalBalance\n            FROM Master_Developer d\n            LEFT JOIN Master_Credit_Balance b ON b.DeveloperId = d.Id\n            LEFT JOIN Master_Credit_Free f ON f.DeveloperId = d.Id AND f.ExpiredDate >= getDate() \n            WHERE d.DeveloperCode = @developer_code\n            -------  end select data -----------\n            \n                --4 start - end date\n            SELECT CONCAT(FORMAT(CAST(@start_date AS date), 'dd/MM/yyyy'), ' - ', FORMAT(CAST(@end_date AS date), 'dd/MM/yyyy')) as BetweenDate,\n                    YEAR(CAST(@start_date AS date)) as Year, @month as Month, FORMAT(CAST(@start_date AS date),'MM') as MonthNumber\n                \n            -------  start select conflict data -----------\n                --5 conflict\n            SELECT TransactionId, IsSet FROM #temptran WHERE IsSet = 0\n                    \n            -- 6 transantion all\n            SELECT ROW_NUMBER() OVER (ORDER BY a.Month) AS No, Detail, SUM(Quantity) as Quantity, UnitPrice, CAST(CONVERT(DECIMAL(18,2),SUM(Price)) AS VARCHAR(255) ) as Price\n            FROM(\n                SELECT Detail, Quantity, UnitPrice, Price, Type, Month FROM #tempconflicttranall\n                UNION ALL\n                SELECT Detail, Quantity, UnitPrice, Price, Type, Month FROM #tempall\n            )a\n            GROUP BY a.Detail, a.Type, a.UnitPrice, a.Month\n            ORDER BY a.Month asc\n            \n            -- 7 transantion free\n            SELECT  ROW_NUMBER() OVER (ORDER BY f.Detail) AS No, Detail, SUM(Quantity) as Quantity, CONCAT('-',UnitPrice) as UnitPrice, CONCAT('-',CONVERT(DECIMAL(18,2),SUM(Price))) as Price\n            FROM(\n                SELECT Detail, Quantity, UnitPrice, Price, Type FROM #tempconflicttranfree\n                UNION ALL\n                SELECT Detail, Quantity, UnitPrice, Price, Type FROM #tempfree WHERE Type NOT IN ( SELECT Type FROM #temptranfree)\n            )f\n            GROUP BY f.Detail, f.Type, f.UnitPrice\n            \n            -- 8 summary price\n            SELECT CAST(CONVERT(DECIMAL(18,2),SUM(PriceTotal)) AS VARCHAR(255) ) as PriceTotal, CONCAT('-',CONVERT(DECIMAL(18,2),SUM(FreePriceTotal))) as FreePriceTotal, \n            CAST(CONVERT(DECIMAL(18,2),(SUM(PriceTotal) - SUM(FreePriceTotal))) AS VARCHAR(255) ) as NetPriceTotal\n            FROM(\n                SELECT SUM(Price) as PriceTotal, 0 as FreePriceTotal FROM #tempconflicttranall\n                UNION ALL \n                SELECT 0 as PriceTotal, SUM(Price) as FreePriceTotal FROM #tempconflicttranfree\n            )S\n            \n            -- 9 Summary of Bulk remaining\n            SELECT FORMAT(GETDATE(), 'dd/MM/yyyy, hh:mm tt') AS SummaryOfBulkDate, ISNULL(b.TotalBalance,0) as CreditTotalBalance, ISNULL(f.TotalBalance,0) as CreditFreeTotalBalance\n            FROM Master_Developer d\n            LEFT JOIN Master_Credit_Balance b ON b.DeveloperId = d.Id\n            LEFT JOIN Master_Credit_Free f ON f.DeveloperId = d.Id AND f.ExpiredDate >= getDate() \n            WHERE d.DeveloperCode = @developer_code\n            -------  end select conflict data -----------\n\n            DROP TABLE #temptranall, #temptranfree, #tempall, #tempfree, #temptran, #tempconflicttranall, #tempconflicttranfree\n            `);let m=[],h=[],y=!1,N="",v="",E="";if(p.recordsets){let e=null===(t=null==p?void 0:p.recordsets[4][0])||void 0===t?void 0:t.BetweenDate,i=(0,f.snakeCaseKeys)(p.recordsets[0]),o=(0,f.snakeCaseKeys)(p.recordsets[1]),d=(0,f.snakeCaseKeys)(p.recordsets[2][0]),s=(0,f.snakeCaseKeys)(p.recordsets[3][0]),c=(0,f.snakeCaseKeys)(p.recordsets[5]),l=(0,f.snakeCaseKeys)(p.recordsets[6]),_=(0,f.snakeCaseKeys)(p.recordsets[7]),T=(0,f.snakeCaseKeys)(p.recordsets[8][0]),C=(0,f.snakeCaseKeys)(p.recordsets[9][0]);(null==c?void 0:c.length)>0&&(y=!0),E=null===(a=null==p?void 0:p.recordsets[4][0])||void 0===a?void 0:a.Year,N=null===(n=null==p?void 0:p.recordsets[4][0])||void 0===n?void 0:n.Month,v=null===(r=null==p?void 0:p.recordsets[4][0])||void 0===r?void 0:r.MonthNumber,m.push({between_date:e,developer_name:u,transantion_all:i||[],transantion_free:o||[],summary_price:d||[],bulk_remaining:s||[]}),h.push({between_date:e,developer_name:u,transantion_all:l||[],transantion_free:_||[],summary_price:T||[],bulk_remaining:C||[]})}return{status:200,message:"success",data:{year:String(E),month:N,month_number:v,bulk_sum_data:m[0]||{},bulk_conflict_data:h[0]||{},is_conflict:y}}}catch(e){return{status:e.status||500,message:e.message}}}))}function D(e){var t,a,n;return o(this,void 0,void 0,(function*(){try{const{start_date:r,end_date:i,developer_code:o,developer_name:d,project_code:l}=e;let _=process.env.DB_NAME_SECOND;const p=yield(0,s.createRequest)().input("developer_code",c.default.NVarChar,o).input("project_code",c.default.NVarChar,l||"").input("start",c.default.NVarChar,r).input("end",c.default.NVarChar,i).query(`\n            DECLARE @start_date NVARCHAR(50) = @start\n            DECLARE @end_date NVARCHAR(50) = @end\n                --Find the start date of Month\n            SET @start_date =\n                (SELECT CASE WHEN ISNULL(@start_date, '') <> '' THEN @start_date ELSE(SELECT DATEFROMPARTS(YEAR(DATEADD(MONTH, -1, getDate())), MONTH(DATEADD(MONTH, -1, getDate())), 1)) END )\n            SET @end_date = (SELECT CASE WHEN ISNULL(@end_date, '') <> '' THEN @end_date ELSE(SELECT DATEADD(DAY, -1, DATEADD(MONTH, 1, DATEFROMPARTS(YEAR(DATEADD(MONTH, -1, getDate())), MONTH(DATEADD(MONTH, -1, getDate())), 1)))) END)\n            DECLARE @month NVARCHAR(50) = FORMAT(CONVERT(DATETIME, @start_date), 'MMMM', 'th-TH')\n\n                --map tran x set\n            CREATE TABLE #temptran(TransactionId NVARCHAR(50), IsSet BIT)\n            INSERT INTO #temptran(TransactionId, IsSet)\n            SELECT DISTINCT n.NcbId as TransactionId,\n                    CASE WHEN(n.NdidRequestId IN(SELECT OrderCode FROM Transaction_Stamp_Log) AND n.ReferenceId IS NOT NULL) OR(n.ReferenceId IN(SELECT OrderCode FROM Transaction_Stamp_Log))\n            THEN 1 ELSE 0 END as IsSet\n                FROM[${_}].[dbo].[Master_Ncb] n\n            INNER JOIN[${_}].[dbo].[Master_Unit] u ON u.UnitId = n.UnitId AND u.DeveloperCode = @developer_code\n            WHERE n.NcbStatusCode <> 'NCB01' AND n.ProjectCode LIKE'%' + @project_code + '%' \n            \n            UNION ALL\n            \n            SELECT DISTINCT LoanId as TransactionId, IsSet = 1\n                FROM[${_}].[dbo].[Master_Loan] \n            WHERE Status <> 'active' AND DeveloperCode = @developer_code AND ProjectCode LIKE'%' + @project_code + '%'\n            \n            ---- start tran data ----\n            CREATE TABLE #tempncb(TransactionId NVARCHAR(100), CreateDate DATETIME, UnitNo NVARCHAR(50), BookingNo NVARCHAR(50), ContractNo NVARCHAR(100), MemberId NVARCHAR(100), DeveloperName NVARCHAR(100), ProjectName NVARCHAR(100), CustomerName NVARCHAR(100), CitizenId NVARCHAR(100), MobileNumber NVARCHAR(100), NcbDate DATETIME, LoanDate DATETIME, PaidDate DATETIME, PriceNcbAndLoan INT, PriceLoan INT, PriceTotal INT)\n            CREATE TABLE #temploan(TransactionId NVARCHAR(100), TypeOfBorrower NVARCHAR(100), CreateDate DATETIME, UnitNo NVARCHAR(50), BookingNo NVARCHAR(50), ContractNo NVARCHAR(100), MemberId NVARCHAR(100), DeveloperName NVARCHAR(100), ProjectName NVARCHAR(100), CustomerName NVARCHAR(100), CitizenId NVARCHAR(100), MobileNumber NVARCHAR(100), NcbDate DATETIME, LoanDate DATETIME, PaidDate DATETIME, PriceNcbAndLoan INT, PriceLoan INT, PriceTotal INT)\n                --NCB\n            INSERT INTO #tempncb(TransactionId, CreateDate, UnitNo, BookingNo, ContractNo, MemberId, DeveloperName, ProjectName, CustomerName, CitizenId, MobileNumber, NcbDate, LoanDate, PaidDate, PriceNcbAndLoan, PriceLoan, PriceTotal)\n            SELECT n.NcbId as TransactionId, w.CreateDate, u.UnitNo, n.BookingNo, n.ContractNo,\n                    JSON_VALUE(n.RequestParams, '$.member_id') as MemberId,\n                    d.DeveloperName, n.ProjectName,\n                    JSON_VALUE(n.RequestParams, '$.customer_name') as CustomerName,\n                    JSON_VALUE(n.RequestParams, '$.citizen_id') as CitizenId,\n                    JSON_VALUE(n.RequestParams, '$.mobile_number') as MobileNumber,\n                    ISNULL(n.UpdateDate, n.CreateDate) as NcbDate,\n                    NULL as LoanDate, w.PaidDate as PaidDate, ISNULL(w.PriceNcbAndLoan, 0) as PriceNcbAndLoan, 0 as PriceLoan, 0 as PriceTotal\n                FROM[${_}].[dbo].[Master_Ncb] n\n            INNER JOIN[${_}].[dbo].[Master_Customer] c ON n.CustomerId = c.CustomerId\n            INNER JOIN[${_}].[dbo].[Master_Unit] u ON n.UnitId = u.UnitId\n            INNER JOIN[${_}].[dbo].[Master_Developer] d ON u.DeveloperCode = d.DeveloperCode\n            INNER JOIN(\n                    SELECT ISNULL(log.UpdateDate, log.CreateDate) as CreateDate, log.TransactionId, out.CreateDate as PaidDate, out.Amount as PriceNcbAndLoan \n                FROM Transaction_Activity_Log log\n                LEFT JOIN Transaction_Out_Log out ON log.ReferanceId = out.OrderCode\n                WHERE log.DescriptionCode = 'success'\n                )w ON n.NcbId = w.TransactionId\n            WHERE w.TransactionId IN(\n                    SELECT TransactionId FROM #temptran WHERE IsSet = 1\n                )\n            AND n.RequestParams LIKE'{%%}' AND n.NcbStatusCode <> 'NCB01' AND u.DeveloperCode = @developer_code\n            AND CONVERT(date, w.CreateDate) BETWEEN @start_date AND @end_date\n\n                --Loan\n            INSERT INTO #temploan(TransactionId, TypeOfBorrower, CreateDate, UnitNo, BookingNo, ContractNo, MemberId, DeveloperName, ProjectName, CustomerName, CitizenId, MobileNumber, NcbDate, LoanDate, PaidDate, PriceNcbAndLoan, PriceLoan, PriceTotal)\n            SELECT l.LoanId as TransactionId, m.TypeOfBorrower, w.CreateDate, u.UnitNo, l.BookingNo, l.ContractNo, '' as MemberId, d.DeveloperName, u.ProjectName,\n                    CONCAT(JSON_VALUE(m.CustomerData, '$.customer.prefix_Name'), JSON_VALUE(m.CustomerData, '$.customer.first_name'), ' ', JSON_VALUE(m.CustomerData, '$.customer.last_name')) as CustomerName,\n                    JSON_VALUE(m.CustomerData, '$.customer.citizen_id') as CitizenId,\n                    JSON_VALUE(m.CustomerData, '$.customer.mobile_number') as MobileNumber,\n                    NULL as NcbDate, ISNULL(l.UpdateDate, l.CreateDate) as LoanDate,\n                    w.PaidDate as PaidDate, 0 as PriceNcbAndLoan, ISNULL(w.PriceLoan, 0) as PriceLoan, 0 as PriceTotal\n                FROM[${_}].[dbo].[Master_Loan] l\n            INNER JOIN[${_}].[dbo].[Mapping_Loan] m ON l.LoanId = m.LoanId\n            INNER JOIN[${_}].[dbo].[Master_Customer] c ON m.CustomerId = c.CustomerId\n            INNER JOIN[${_}].[dbo].[Master_Unit] u ON l.UnitId = u.UnitId\n            INNER JOIN[${_}].[dbo].[Master_Developer] d ON l.DeveloperCode = d.DeveloperCode\n            INNER JOIN(\n                    SELECT ISNULL(log.UpdateDate, log.CreateDate) as CreateDate, log.TransactionId, out.CreateDate as PaidDate, out.Amount as PriceLoan \n                FROM Transaction_Activity_Log log\n                LEFT JOIN Transaction_Out_Log out ON log.ReferanceId = out.OrderCode\n                WHERE log.DescriptionCode = 'success'\n                )w ON l.LoanId = w.TransactionId\n            WHERE w.TransactionId IN(\n                    SELECT TransactionId FROM #temptran WHERE IsSet = 1\n                )\n            AND l.Status = 'inprogress' AND l.DeveloperCode = @developer_code\n            AND CONVERT(date, w.CreateDate) BETWEEN @start_date AND @end_date\n            ORDER BY l.BookingNo\n\n                --insert bulk detail to  #tempdetail \n            CREATE TABLE #tempdetail(CreateDate DATETIME, UnitNo NVARCHAR(50), BookingNo NVARCHAR(50), ContractNo NVARCHAR(100), MemberId NVARCHAR(100), DeveloperName NVARCHAR(100), ProjectName NVARCHAR(100), CustomerName NVARCHAR(100), CitizenId NVARCHAR(100), MobileNumber NVARCHAR(100), NcbDate DATETIME, LoanDate DATETIME, PaidDate DATETIME, PriceNcbAndLoan INT, PriceLoan INT, PriceTotal INT)\n            INSERT INTO #tempdetail(CreateDate, UnitNo, BookingNo, ContractNo, MemberId, DeveloperName, ProjectName, CustomerName, CitizenId, MobileNumber, NcbDate, LoanDate, PaidDate, PriceNcbAndLoan, PriceLoan, PriceTotal)\n            SELECT CreateDate, UnitNo, BookingNo, ContractNo, MemberId, DeveloperName, ProjectName, CustomerName, CitizenId, MobileNumber, NcbDate, LoanDate, PaidDate, PriceNcbAndLoan, PriceLoan, (SUM(PriceNcbAndLoan) + SUM(PriceLoan)) as PriceTotal\n                FROM(\n                    SELECT n.TransactionId, n.CreateDate, n.UnitNo, n.BookingNo, n.ContractNo, n.MemberId, n.DeveloperName, n.ProjectName, n.CustomerName,\n                    n.CitizenId, n.MobileNumber, n.NcbDate, ISNULL(t.LoanDate, n.LoanDate) as LoanDate, n.PaidDate, n.PriceNcbAndLoan,\n                    ISNULL(t.PriceLoan, n.PriceLoan) as PriceLoan, n.PriceTotal\n            FROM #tempncb n\n            LEFT JOIN(\n                        SELECT TransactionId, CreateDate, UnitNo, BookingNo, ContractNo, ProjectName, CustomerName, CitizenId, LoanDate, PaidDate, PriceLoan\n                FROM #temploan WHERE TypeOfBorrower = 'Borrower'\n                    )t ON t.BookingNo = n.BookingNo AND t.CitizenId = n.CitizenId\n            UNION\n            SELECT TransactionId, CreateDate, UnitNo, BookingNo, ContractNo, MemberId, DeveloperName, ProjectName, CustomerName,\n                    CitizenId, MobileNumber, NcbDate, LoanDate, CASE WHEN TypeOfBorrower = 'Co-Borrower' THEN NULL ELSE PaidDate END as PaidDate, PriceNcbAndLoan,\n                    CASE WHEN TypeOfBorrower = 'Co-Borrower' THEN 0 ELSE PriceLoan END as PriceLoan, PriceTotal\n            FROM #temploan\n            WHERE CONCAT(BookingNo, CitizenId) NOT IN(SELECT CONCAT(BookingNo, CitizenId) FROM #tempncb)\n                )t\n            GROUP BY CreateDate, UnitNo, BookingNo, ContractNo, MemberId, DeveloperName, ProjectName, CustomerName,\n                    CitizenId, MobileNumber, NcbDate, LoanDate, PaidDate, PriceNcbAndLoan, PriceLoan\n            ORDER BY t.CreateDate, t.BookingNo\n            ---- end tran data ----\n\n            ---- start conflict data ----\n            CREATE TABLE #tempconflictncb (TransactionId NVARCHAR(100), CreateDate DATETIME, UnitNo NVARCHAR(50), BookingNo NVARCHAR(50),ContractNo NVARCHAR(100), MemberId NVARCHAR(100), DeveloperName NVARCHAR(100), ProjectName NVARCHAR(100), CustomerName NVARCHAR(100), CitizenId NVARCHAR(100), MobileNumber NVARCHAR(100), NcbDate DATETIME, LoanDate DATETIME, PaidDate DATETIME, PriceNcbAndLoan INT, PriceLoan INT, PriceTotal INT)\n            CREATE TABLE #tempconflictloan (TransactionId NVARCHAR(100), TypeOfBorrower NVARCHAR(100), CreateDate DATETIME, UnitNo NVARCHAR(50), BookingNo NVARCHAR(50),ContractNo NVARCHAR(100), MemberId NVARCHAR(100), DeveloperName NVARCHAR(100), ProjectName NVARCHAR(100), CustomerName NVARCHAR(100), CitizenId NVARCHAR(100), MobileNumber NVARCHAR(100), NcbDate DATETIME, LoanDate DATETIME, PaidDate DATETIME, PriceNcbAndLoan INT, PriceLoan INT, PriceTotal INT)\n            --NCB\n            INSERT INTO #tempconflictncb (TransactionId, CreateDate , UnitNo, BookingNo, ContractNo, MemberId, DeveloperName, ProjectName, CustomerName, CitizenId, MobileNumber, NcbDate, LoanDate, PaidDate, PriceNcbAndLoan, PriceLoan, PriceTotal)\n            SELECT n.NcbId as TransactionId , w.CreateDate, u.UnitNo, n.BookingNo, n.ContractNo, \n            JSON_VALUE(n.RequestParams,'$.member_id') as MemberId, \n            d.DeveloperName, n.ProjectName,\n            JSON_VALUE(n.RequestParams,'$.customer_name') as CustomerName,\n            JSON_VALUE(n.RequestParams,'$.citizen_id') as CitizenId,\n            JSON_VALUE(n.RequestParams,'$.mobile_number') as MobileNumber,\n            ISNULL(n.UpdateDate, n.CreateDate) as NcbDate, \n            NULL as LoanDate, w.PaidDate as PaidDate, ISNULL(w.PriceNcbAndLoan,0) as PriceNcbAndLoan, 0 as PriceLoan, 0 as PriceTotal\n            FROM [${_}].[dbo].[Master_Ncb] n\n            INNER JOIN [${_}].[dbo].[Master_Customer] c ON n.CustomerId = c.CustomerId\n            INNER JOIN [${_}].[dbo].[Master_Unit] u ON n.UnitId = u.UnitId\n            INNER JOIN [${_}].[dbo].[Master_Developer] d ON u.DeveloperCode = d.DeveloperCode\n            INNER JOIN (\n                SELECT ISNULL(log.UpdateDate, log.CreateDate) as CreateDate,log.TransactionId, out.CreateDate as PaidDate, out.Amount as PriceNcbAndLoan \n                FROM Transaction_Activity_Log log\n                LEFT JOIN Transaction_Out_Log out ON log.ReferanceId = out.OrderCode\n                WHERE log.DescriptionCode = 'success'\n            )w ON n.NcbId = w.TransactionId\n            WHERE w.TransactionId IN(\n                SELECT TransactionId FROM #temptran WHERE IsSet = 0\n            )\n            AND n.RequestParams LIKE'{%%}' AND n.NcbStatusCode <> 'NCB01' AND u.DeveloperCode = @developer_code\n            AND CONVERT(date, w.CreateDate) BETWEEN @start_date AND @end_date\n            \n            --Loan\n            INSERT INTO #tempconflictloan (TransactionId, TypeOfBorrower, CreateDate , UnitNo, BookingNo, ContractNo, MemberId, DeveloperName, ProjectName, CustomerName, CitizenId, MobileNumber, NcbDate, LoanDate, PaidDate, PriceNcbAndLoan, PriceLoan, PriceTotal)\n            SELECT l.LoanId as TransactionId, m.TypeOfBorrower, w.CreateDate ,u.UnitNo, l.BookingNo, l.ContractNo, '' as MemberId, d.DeveloperName, u.ProjectName,\n            CONCAT(JSON_VALUE(m.CustomerData,'$.customer.prefix_Name'),JSON_VALUE(m.CustomerData,'$.customer.first_name'),' ',JSON_VALUE(m.CustomerData,'$.customer.last_name')) as CustomerName, \n            JSON_VALUE(m.CustomerData,'$.customer.citizen_id') as CitizenId,\n            JSON_VALUE(m.CustomerData,'$.customer.mobile_number') as MobileNumber,\n            NULL as NcbDate, ISNULL(l.UpdateDate, l.CreateDate) as LoanDate, \n            w.PaidDate as PaidDate, 0 as PriceNcbAndLoan, ISNULL(w.PriceLoan,0) as PriceLoan, 0 as PriceTotal\n            FROM [${_}].[dbo].[Master_Loan] l\n            INNER JOIN [${_}].[dbo].[Mapping_Loan] m ON l.LoanId = m.LoanId\n            INNER JOIN [${_}].[dbo].[Master_Customer] c ON m.CustomerId = c.CustomerId\n            INNER JOIN [${_}].[dbo].[Master_Unit] u ON l.UnitId = u.UnitId\n            INNER JOIN [${_}].[dbo].[Master_Developer] d ON l.DeveloperCode = d.DeveloperCode\n            INNER JOIN (\n                SELECT ISNULL(log.UpdateDate, log.CreateDate) as CreateDate,log.TransactionId, out.CreateDate as PaidDate, out.Amount as PriceLoan \n                FROM Transaction_Activity_Log log\n                LEFT JOIN Transaction_Out_Log out ON log.ReferanceId = out.OrderCode\n                WHERE log.DescriptionCode = 'success'\n            )w ON l.LoanId = w.TransactionId\n            WHERE w.TransactionId IN(\n                SELECT TransactionId FROM #temptran WHERE IsSet = 0\n            )\n            AND l.Status = 'inprogress' AND l.DeveloperCode = @developer_code\n            AND CONVERT(date, w.CreateDate) BETWEEN @start_date AND @end_date\n            ORDER BY l.BookingNo\n            \n            -- insert bulk detail to  #tempconflictdetail \n            CREATE TABLE #tempconflictdetail (CreateDate DATETIME, UnitNo NVARCHAR(50), BookingNo NVARCHAR(50),ContractNo NVARCHAR(100), MemberId NVARCHAR(100), DeveloperName NVARCHAR(100), ProjectName NVARCHAR(100), CustomerName NVARCHAR(100), CitizenId NVARCHAR(100), MobileNumber NVARCHAR(100), NcbDate DATETIME, LoanDate DATETIME, PaidDate DATETIME, PriceNcbAndLoan INT, PriceLoan INT, PriceTotal INT)\n            INSERT INTO #tempconflictdetail (CreateDate , UnitNo, BookingNo, ContractNo, MemberId, DeveloperName, ProjectName, CustomerName, CitizenId, MobileNumber, NcbDate, LoanDate, PaidDate, PriceNcbAndLoan, PriceLoan, PriceTotal)\n            SELECT CreateDate , UnitNo, BookingNo, ContractNo, MemberId, DeveloperName, ProjectName, CustomerName, CitizenId, MobileNumber, NcbDate, LoanDate, PaidDate, PriceNcbAndLoan, PriceLoan, (SUM(PriceNcbAndLoan) + SUM(PriceLoan)) as PriceTotal \n            FROM(\n            SELECT n.TransactionId, n.CreateDate , n.UnitNo, n.BookingNo, n.ContractNo, n.MemberId, n.DeveloperName, n.ProjectName, n.CustomerName, \n            n.CitizenId, n.MobileNumber, n.NcbDate, ISNULL(t.LoanDate, n.LoanDate) as LoanDate, n.PaidDate, n.PriceNcbAndLoan, \n            ISNULL(t.PriceLoan, n.PriceLoan) as PriceLoan, n.PriceTotal\n            FROM #tempconflictncb n\n            LEFT JOIN (\n                SELECT TransactionId, CreateDate , UnitNo, BookingNo, ContractNo, ProjectName, CustomerName, CitizenId, LoanDate, PaidDate, PriceLoan\n                FROM #tempconflictloan WHERE TypeOfBorrower = 'Borrower'\n            )t ON t.BookingNo = n.BookingNo AND t.CitizenId = n.CitizenId\n            UNION\n            SELECT TransactionId, CreateDate , UnitNo, BookingNo, ContractNo, MemberId, DeveloperName, ProjectName, CustomerName, \n            CitizenId, MobileNumber, NcbDate, LoanDate, CASE WHEN TypeOfBorrower = 'Co-Borrower' THEN NULL ELSE PaidDate END as PaidDate, PriceNcbAndLoan,\n            CASE WHEN TypeOfBorrower = 'Co-Borrower' THEN 0 ELSE PriceLoan END as PriceLoan, PriceTotal\n            FROM #tempconflictloan\n            WHERE CONCAT(BookingNo,CitizenId) NOT IN (SELECT CONCAT(BookingNo,CitizenId) FROM #tempconflictncb)\n            )t\n            GROUP BY CreateDate , UnitNo, BookingNo, ContractNo, MemberId, DeveloperName, ProjectName, CustomerName, \n            CitizenId, MobileNumber, NcbDate, LoanDate, PaidDate, PriceNcbAndLoan, PriceLoan\n            ORDER BY t.CreateDate, t.BookingNo\n            ---- end conflict data ----\n\n            ---- start select tran data ----\n                --0 bulk detail\n            SELECT ROW_NUMBER() OVER (ORDER BY CreateDate) AS No, FORMAT(CreateDate, 'dd/MM/yyyy, HH:MM') as CreateDate, UnitNo, BookingNo, ContractNo, MemberId, DeveloperName, ProjectName,\n                    CONCAT(LEFT(CustomerName, 4), '********', RIGHT(CustomerName, 4)) as CustomerName,\n                    CONCAT(LEFT(CitizenId, 3), '*******', RIGHT(CitizenId, 3)) as CitizenId,\n                    CONCAT(LEFT(MobileNumber, 3), '****', RIGHT(MobileNumber, 3)) as MobileNumber,\n                    ISNULL(FORMAT(NcbDate, 'dd/MM/yyyy, HH:MM'), '') as NcbDate, ISNULL(FORMAT(LoanDate, 'dd/MM/yyyy, HH:MM'), '') as LoanDate,\n                    ISNULL(FORMAT(PaidDate, 'dd/MM/yyyy'), '') as PaidDate, ISNULL(FORMAT(PaidDate, 'HH:MM'), '') as PaidTime,\n                    PriceNcbAndLoan, PriceLoan, PriceTotal \n            FROM #tempdetail\n            ORDER BY CreateDate, BookingNo\n\n                --1 sum total price\n            SELECT ISNULL(SUM(PriceNcbAndLoan),0) as PriceNcbAndLoanTotal, ISNULL(SUM(PriceLoan),0)as PriceLoanTotal, ISNULL(SUM(PriceTotal),0) as PriceAllTotal\n            FROM #tempdetail\n            ---- end select tran data ----\n\n            ---- start select conflict data ----\n                -- 2 bulk detail\n            SELECT ROW_NUMBER() OVER (ORDER BY CreateDate) AS No, FORMAT(CreateDate, 'dd/MM/yyyy, HH:MM') as CreateDate, UnitNo, BookingNo, ContractNo, MemberId, DeveloperName, ProjectName, \n            CONCAT(LEFT(CustomerName, 4), '********', RIGHT(CustomerName, 4)) as CustomerName,\n            CONCAT(LEFT(CitizenId, 3), '*******', RIGHT(CitizenId, 3)) as CitizenId, \n            CONCAT(LEFT(MobileNumber, 3), '****', RIGHT(MobileNumber, 3)) as MobileNumber, \n            ISNULL(FORMAT(NcbDate, 'dd/MM/yyyy, HH:MM'),'') as NcbDate,  ISNULL(FORMAT(LoanDate, 'dd/MM/yyyy, HH:MM'),'') as LoanDate, \n            ISNULL(FORMAT(PaidDate, 'dd/MM/yyyy'),'') as PaidDate, ISNULL(FORMAT(PaidDate, 'HH:MM'),'') as PaidTime,\n            PriceNcbAndLoan, PriceLoan, PriceTotal \n            FROM #tempconflictdetail\n            ORDER BY CreateDate, BookingNo\n            \n                -- 3 sum total price\n            SELECT ISNULL(SUM(PriceNcbAndLoan),0) as PriceNcbAndLoanTotal, ISNULL(SUM(PriceLoan),0)as PriceLoanTotal, ISNULL(SUM(PriceTotal),0) as PriceAllTotal\n            FROM #tempconflictdetail\n            ---- end select conflict data ----\n\n                --4 start - end date\n            SELECT CONCAT(FORMAT(CAST(@start_date AS date), 'dd/MM/yyyy'), ' - ', FORMAT(CAST(@end_date AS date), 'dd/MM/yyyy')) as BetweenDate,\n                    YEAR(CAST(@start_date AS date)) as Year, @month as Month\n\n            DROP TABLE #tempncb, #temploan, #temptran, #tempdetail, #tempconflictncb, #tempconflictloan, #tempconflictdetail\n                    `);let m=[],h=[],y="",N="";if(p.recordsets){let e=null===(t=null==p?void 0:p.recordsets[4][0])||void 0===t?void 0:t.BetweenDate,r=(0,f.snakeCaseKeys)(p.recordsets[0]),i=(0,f.snakeCaseKeys)(p.recordsets[1][0]),o=(0,f.snakeCaseKeys)(p.recordsets[2]),s=(0,f.snakeCaseKeys)(p.recordsets[3][0]);N=null===(a=null==p?void 0:p.recordsets[2][0])||void 0===a?void 0:a.Year,y=null===(n=null==p?void 0:p.recordsets[2][0])||void 0===n?void 0:n.Month,m.push({between_date:e,developer_name:d,bulk_detail:u.default.orderBy(r,"no")||[],total_price:i||{}}),h.push({between_date:e,developer_name:d,bulk_detail:u.default.orderBy(o,"no")||[],total_price:s||{}})}return{status:200,message:"success",data:{year:N,month:y,bulk_sum_detail:m[0]||{},conflict_bulk_sum_detail:h[0]||{}}}}catch(e){return{status:e.status||500,message:e.message}}}))}t.reportNcb=(e,t)=>o(void 0,void 0,void 0,(function*(){try{const{developer_code:a,project_code:n,start_date:r,end_date:i,start_send_date:o,end_send_date:d}=e.body;y=e.body.number_of_customer;let u=yield(0,s.createRequest)().query(" \n                SELECT TransactionId \n                FROM Transaction_Activity_Log\n                WHERE Type = 'หักเครดิต(ncb)' AND IsCredit = '1'\n            "),l=[];u.recordset.forEach((e=>{l.push(e.TransactionId)}));let _="";r&&i&&(_="AND CONVERT(date, n.CreateDate) BETWEEN @start_date AND @end_date");let p="";r&&i&&(_="AND CONVERT(date, n.UpdateDate) BETWEEN @start_send_date AND @end_send_date");let f,m=yield(0,s.createRequestSecond)().input("ncb_id",c.default.NVarChar,l.join(",")).input("developer_code",c.default.NVarChar,a).input("project_code",c.default.NVarChar,n).input("start_date",c.default.NVarChar,r).input("end_date",c.default.NVarChar,i).input("start_send_date",c.default.NVarChar,o).input("end_send_date",c.default.NVarChar,d).query(`\n                DECLARE @TempTable TABLE (NcbId NVARCHAR(50))\n                INSERT INTO @TempTable (NcbId) SELECT value FROM STRING_SPLIT(@ncb_id, ',')\n\n                SELECT  n.CreateDate, n.NcbId, d.DeveloperName, p.ProjectName, n.RequestParams\n                , c.Name, n.UpdateDate, n.ReferenceId, n.NdidRequestId\n                FROM Master_Ncb  n \n                LEFT JOIN Master_Project p ON n.ProjectCode = p.ProjectCode \n                LEFT JOIN Master_Developer d ON p.DeveloperCode = d.DeveloperCode\n                LEFT JOIN Master_Ncb_Status c ON n.NcbStatusCode = c.NcbStatusCode \n                WHERE n.NcbId IN ( SELECT NcbId FROM @TempTable) \n                AND p.DeveloperCode LIKE '%' + @developer_code + '%'  \n                AND p.ProjectCode LIKE  '%' +  @project_code + '%'\n                ${_}\n                ${p}\n                ORDER BY n.CreateDate ASC\n            `),h=[];m.recordset.forEach(((e,t)=>{let a=JSON.parse(e.RequestParams);const n=String(t+1).padStart(6,"0");let r=N(e.CreateDate),i=N(e.UpdateDate),o=v(a.citizen_id),d=v(a.mobile_number),s=E(a.customer_name);h.push({no:t+1,date:r.date,ncb_id:e.NcbId,dev_name:e.DeveloperName,project_name:e.ProjectName,unit_code:"",data_type:"D",customer_no:n,customer_name:s,customer_id:o,customer_phone:d,ncb_pay:200,ncb_commission:60,ncb_fee:140,ncb_status:e.Name,ncb_respond_date:i.date,ndid:e.NdidRequestId,ncb_token:"",set_id:e.ReferenceId})})),y&&(f=yield h.find(T));let C=N(Date.now()),b=y?f:h,D=200*(f?1:b?b.length:0),O=60*(f?1:b?b.length:0),R=140*(f?1:b?b.length:0);t.status(200).send({status:200,message:"success",export_date:C.date,sum_ncb_pay:D,sum_ncb_commission:O,sum_ncb_fee:R,data:b})}catch(e){t.status(500).send({status:e.status||500,message:e.message})}})),t.reportNcbText=(e,t)=>o(void 0,void 0,void 0,(function*(){try{const{developer_code:a,project_code:n,start_date:r,end_date:i,start_send_date:o,end_send_date:d}=e.body;y=e.body.number_of_customer;let u={header_record_type:"H",header_sequence_no:"000001",header_bank_code:"999",header_company_ac:C(10),header_company_name:C(27)+"ICONFRAMEWORK",header_affective_date:C(8),header_service_code:C(8),header_spare:C(180),data_record_type:"D",data_sequence_no:"000001",data_bank_code:C(3),data_company_account:C(10),data_payment_date:"",data_payment_time:"",data_customer_name:"",data_customer_id:"",data_customer_phone:"",data_ref_ndid:"",data_branch_no:C(4),data_teller_no:C(4),data_kind_of_transection:"C",data_transection_code:"000",data_cheque_no:C(7),data_amount:"0000000020000",data_cheque_bank_code:C(3),data_spare:C(77),total_record_type:"T",total_sequence_no:"sum data + 2",total_bank_code:C(3),total_company_ac:C(10),total_debit_payment_comm:C(13),total_debit_transection:C(6),total_debit_payment_amt:"",total_credit_transection:"",total_total_discount:C(13),total_total_vat:C(10),total_spare:C(175)},l=yield(0,s.createRequest)().query(" \n            SELECT t.TransactionId, o.CreateDate\n            FROM  Transaction_Activity_Log t\n            LEFT JOIN  Transaction_Out_Log o ON t.ReferanceId = o.OrderCode\n            WHERE t.Type = 'หักเครดิต(ncb)' AND t.IsCredit = '1'\n        "),_=[];l.recordset.forEach((e=>{_.push(e.TransactionId)}));let f="";r&&i&&(f="AND CONVERT(date, n.CreateDate) BETWEEN @start_date AND @end_date");let m="";r&&i&&(f="AND CONVERT(date, n.UpdateDate) BETWEEN @start_send_date AND @end_send_date");let h=yield(0,s.createRequestSecond)().input("ncb_id",c.default.NVarChar,_.join(",")).input("developer_code",c.default.NVarChar,a).input("project_code",c.default.NVarChar,n).input("start_date",c.default.NVarChar,r).input("end_date",c.default.NVarChar,i).input("start_send_date",c.default.NVarChar,o).input("end_send_date",c.default.NVarChar,d).query(`\n                DECLARE @TempTable TABLE (NcbId NVARCHAR(50))\n                INSERT INTO @TempTable (NcbId) SELECT value FROM STRING_SPLIT(@ncb_id, ',')\n\n                SELECT  n.NcbId, n.RequestParams, n.NdidReference, n.IconReferenceNdid\n                FROM Master_Ncb  n \n                LEFT JOIN Master_Project p ON n.ProjectCode = p.ProjectCode \n                LEFT JOIN Master_Developer d ON p.DeveloperCode = d.DeveloperCode\n                LEFT JOIN Master_Ncb_Status c ON n.NcbStatusCode = c.NcbStatusCode \n                WHERE n.NcbId IN ( SELECT NcbId FROM @TempTable) \n                AND c.NcbStatusCode = 'NCB05'\n                AND p.DeveloperCode LIKE '%' + @developer_code + '%'  \n                AND p.ProjectCode LIKE  '%' +  @project_code + '%'\n                ${f}\n                ${m}\n                ORDER BY n.CreateDate ASC\n            `),v="";h.recordset.forEach(((e,t)=>{let a=JSON.parse(e.RequestParams);const n=String(t+2).padStart(6,"0");let r=N(l.recordset.find((({TransactionId:t})=>t===e.NcbId)).CreateDate,"txt"),i=C(50-a.customer_name.length),o=C(7),d=C(10),s=C(20-JSON.stringify(e.IconReferenceNdid).length);v+=u.data_record_type,v+=n,v+=u.data_bank_code,v+=u.data_company_account,v+=r.date,v+=r.time,v+=i+a.customer_name,v+=o+a.citizen_id,v+=d+a.mobile_number,v+=s+e.IconReferenceNdid,v+=u.data_branch_no,v+=u.data_teller_no,v+=u.data_kind_of_transection,v+=u.data_transection_code,v+=u.data_cheque_no,v+=u.data_amount,v+=u.data_cheque_bank_code,v+=u.data_spare,v+="\n"}));const E=String(h.recordset.length+2).padStart(6,"0"),T=String(h.recordset.length).padStart(6,"0"),b=String(200*h.recordset.length*100).padStart(13,"0");let D=u.header_record_type+u.header_sequence_no+u.header_bank_code+u.header_company_ac+u.header_company_name+u.header_affective_date+u.header_service_code+u.header_spare,O=u.total_record_type+E+u.total_bank_code+u.total_company_ac+u.total_debit_payment_comm+u.total_debit_transection+b+T+u.total_total_discount+u.total_total_vat+u.total_spare;const R="report-ncb.txt",I=D+"\n"+v+O;p.default.writeFile(R,I,(e=>{e?t.status(500).send("Error creating the file"):t.download(R,(e=>{e&&console.error("Error downloading the file:",e),p.default.unlink(R,(e=>{e&&console.error("Error deleting the file:",e)}))}))}))}catch(e){t.status(500).send({status:e.status||500,message:e.message})}})),t.reportLoan=(e,t)=>o(void 0,void 0,void 0,(function*(){try{const{developer_code:a,project_code:n,start_date:r,end_date:i,booking_no:o,contract_no:d}=e.body;let u=e.url,l=yield(0,s.createRequest)().query(" \n            SELECT DISTINCT  a.TransactionId,  o.CreateDate, o.Status\n            FROM Transaction_Activity_Log a\n            LEFT JOIN Transaction_Out_Log o on a.ReferanceId = o.OrderCode\n            WHERE a.Type = 'หักเครดิต(ncb)' AND a.IsCredit = '1'\n        "),_=[];l.recordset.forEach((e=>{_.push(e.TransactionId)}));let p="";r&&i&&(p="AND CONVERT(date,  n.CreateDate ) BETWEEN @start_date AND @end_date");let f=yield(0,s.createRequestSecond)().input("ncb_id",c.default.NVarChar,_.join(",")).input("developer_code",c.default.NVarChar,a).input("project_code",c.default.NVarChar,n).input("start_date",c.default.NVarChar,r).input("end_date",c.default.NVarChar,i).input("booking_no",c.default.NVarChar,o).input("contract_no",c.default.NVarChar,d).query(`\n                DECLARE @TempTable TABLE (NcbId NVARCHAR(50))\n                INSERT INTO @TempTable (NcbId) SELECT value FROM STRING_SPLIT(@ncb_id, ',')\n\n                SELECT  n.NcbId, n.CreateDate, n.BookingNo,u.UnitNo, n.ContractNo, p.DeveloperName, p.ProjectName, n.RequestParams, c.Name, n.UpdateDate, n.ReferenceId, n.NdidRequestId\n                FROM Master_Ncb  n \n                LEFT JOIN Master_Project p ON n.ProjectCode = p.ProjectCode \n                LEFT JOIN Master_Developer d ON p.DeveloperCode = d.DeveloperCode\n                LEFT JOIN Master_Ncb_Status c ON n.NcbStatusCode = c.NcbStatusCode \n                LEFT JOIN Master_Unit u ON n.UnitId = u.UnitId\n                WHERE n.NcbId IN ( SELECT NcbId FROM @TempTable) \n                AND p.DeveloperCode LIKE '%' + @developer_code + '%'  \n                AND p.ProjectCode LIKE  '%' +  @project_code + '%'\n                AND ISNULL(n.BookingNo, '') LIKE '%' + @booking_no + '%'\n                AND ISNULL(n.ContractNo, '') LIKE '%' + @contract_no + '%'\n                ${p}\n                ORDER BY n.CreateDate ASC\n                `),m=[];f.recordset.forEach(((e,t)=>{let a=JSON.parse(e.RequestParams),n=l.recordset.find((({TransactionId:t})=>t===e.NcbId));const r=String(t+1).padStart(7,"0");let i=N(e.CreateDate),o=N(n.CreateDate),d=e.UpdateDate?N(e.UpdateDate):N(e.CreateDate),s=a.customer_name,c=v(a.citizen_id),_=v(a.mobile_number),p=E(s);m.push({no:t+1,create_date:i.date,unit_no:null!=e.UnitNo?e.UnitNo:"",booking_no:e.BookingNo,contract_no:null!=e.ContractNo?e.ContractNo:"",customer_id_rem:a.member_id?a.member_id:"",developer_name:e.DeveloperName,project_name:e.ProjectName,customer_name:p,citizen_id:c,mobile_number:_,service:500,pay_date:o.date,pay_time:o.time,status:n.Status,date_sent_NCB:d.date}),"/report/loan/1"===u&&(m[t].request_id_ndid=e.NdidRequestId,m[t].ncb_token="",m[t].reference_icon=r,m[t].request_id_set=e.ReferenceId)}));let h=500*m.length,y=N(Date.now());t.status(200).send({status:200,message:"success",export_date:y.date,sum_service:h,data:m})}catch(e){t.status(500).send({status:e.status||500,message:e.message})}})),t.reportLoanSelf=(e,t)=>o(void 0,void 0,void 0,(function*(){try{const{start_date:a,end_date:n,developer_code:r,project_code:i,booking_no:o,contract_no:d}=e.body;let l=yield(0,s.createRequest)().query(" \n            SELECT TransactionId, Description, CreateDate, UpdateDate \n            FROM Transaction_Activity_Log\n            WHERE Type = 'หักเครดิต(loan)' \n            AND IsCredit = '1'\n        "),_=[];l.recordset.forEach((e=>{_.push(e.TransactionId)}));let p="";a&&n&&(p="AND CONVERT(date, l2.CreateDate ) BETWEEN @start_date AND @end_date");let f=yield(0,s.createRequestSecond)().input("start_date",c.default.NVarChar,a).input("end_date",c.default.NVarChar,n).input("loan_id",c.default.NVarChar,_.join(",")).input("developer_code",c.default.NVarChar,r).input("project_code",c.default.NVarChar,i).input("booking_no",c.default.NVarChar,o).input("contract_no",c.default.NVarChar,d).query(`\n            DECLARE @TempTable TABLE (LoanId NVARCHAR(50))\n            INSERT INTO @TempTable (LoanId) SELECT value FROM STRING_SPLIT(@loan_id, ',')\n\n            SELECT l2.CreateDate, l1.LoanId, u.UnitNo, l2.BookingNo, l2.ContractNo, c.MemberId, \n\t        d.DeveloperName, p.ProjectName, l1.CustomerData, String_AGG(b.BankCode, ',') as Bank\n\n            FROM Mapping_Loan l1\n                LEFT JOIN Master_Loan l2 ON l1.LoanId = l2.LoanId\n                LEFT JOIN Master_Unit u ON l2.UnitId = u.UnitId\n                LEFT JOIN Master_Customer c ON l1.CustomerId = c.CustomerId\n                LEFT JOIN Master_Developer d ON l2.DeveloperCode = d.DeveloperCode\n                LEFT JOIN Master_Project p ON l2.ProjectCode = p.ProjectCode\n                LEFT JOIN Mapping_Loan_Bank b ON l1.LoanId = b.LoanId AND b.IsSelectBank = '1'\n            WHERE l1.LoanId IN ( SELECT LoanId FROM @TempTable)\n                AND l1.TypeOfBorrower = 'Borrower'\n                AND l2.DeveloperCode LIKE '%%'\n                AND l2.ProjectCode LIKE '%%'\n                AND ISNULL(l2.BookingNo, '') LIKE '%%'\n                AND ISNULL(l2.ContractNo, '') LIKE '%%'\n                ${p}\n                GROUP BY l2.CreateDate, l1.LoanId, u.UnitNo, l2.BookingNo, l2.ContractNo, c.MemberId, \n                    d.DeveloperName, p.ProjectName, l1.CustomerData\n                ORDER BY l2.CreateDate ASC\n            `),m=[],h=[];f.recordset.forEach(((e,t)=>{let a=JSON.parse(e.CustomerData);m.push((0,u.isNull)(e.Bank)?[]:e.Bank.split(","));let n=l.recordset.find((({TransactionId:t})=>t===e.LoanId)),r=N(e.CreateDate),i=N(n.UpdateDate),o=a.customer.first_name+" "+a.customer.last_name,d=v(a.customer.citizen_id),s=v(a.customer.mobile_number),c=E(o);h.push({no:t+1,create_date:r.date,unit_no:e.UnitNo,booking_no:e.BookingNo,contract_no:null!=e.ContractNo?e.ContractNo:"",customer_id_rem:null!=e.MemberId?e.MemberId:"",developer_name:e.DeveloperName,project_name:e.ProjectName,customer_name:c,citizen_id:d,mobile_number:s,service:300,bulk_date:i.date,bulk_time:i.time});let _=[],p=[];m.forEach((e=>{p.push(e),_.push(e.length)}));let f=Math.max(..._);for(let e=0;e<f;e++)h[t][`bank_${e+1}`]=p[t][e]?p[t][e]:"";h[t].banks=p[t]}));let y=300*h.length,T=h.length,C=N(Date.now());t.status(200).send({status:200,message:"success",export_date:C.date,sum_service:y,sum_item:T,data:h})}catch(e){t.status(500).send({status:e.status||500,message:e.message})}})),t.reportNdid=(e,t)=>o(void 0,void 0,void 0,(function*(){try{const{start_date:a,end_date:n}=e.body;let r="";a&&n&&(r="AND CONVERT(date, a.CreateDate ) BETWEEN @start_date AND @end_date");let i=yield(0,s.createRequest)().input("start_date",c.default.NVarChar,a).input("end_date",c.default.NVarChar,n).query(" \n                SELECT DISTINCT OrderCode, COUNT(OrderCode) as SumStamp\n                    FROM  Transaction_Stamp_Log\n                GROUP BY OrderCode\n            "),o=[],d=0;i.recordset.forEach((e=>{o.push(e.OrderCode)}));let u=yield(0,s.createRequestSecond)().input("start_date",c.default.NVarChar,a).input("end_date",c.default.NVarChar,n).input("ndid",c.default.NVarChar,o.join(",")).query(`\n                DECLARE @TempTable TABLE (NdidId NVARCHAR(MAX))\n                INSERT INTO @TempTable (NdidId) SELECT value FROM STRING_SPLIT(@ndid, ',')\n\n                SELECT a.NdidRequestId,b.Name as Status, c.Name as Partner\n                FROM  Master_Ncb a\n                LEFT JOIN Master_Ncb_Status b ON a.NcbStatusCode = b.NcbStatusCode \n                LEFT JOIN Master_Idp c ON a.BankCode = c.IdpId \n                WHERE  a.NdidRequestId IN ( SELECT NdidId FROM @TempTable)\n                ${r}\n            `),l=[];u.recordset.forEach(((e,t)=>{let a=i.recordset.find((({OrderCode:t})=>t===e.NdidRequestId));l.push({no:t+1,partner_name:e.Partner,role:"RP",ndid:e.NdidRequestId,status:e.Status,sum_stamp:a.SumStamp}),d+=a.SumStamp}));let _=l.length,p=3*d,f=N(Date.now());t.status(200).send({status:200,message:"success",export_date:f.date,sum_item:_,sum_stamp:d,sum_price:p,data:l})}catch(e){t.status(500).send({status:e.status||500,message:e.message})}})),t.reportSet=(e,t)=>o(void 0,void 0,void 0,(function*(){try{const{start_date:a,end_date:n}=e.body;let r=yield(0,s.createRequest)().query(" \n            select  Type, OrderCode, CreateDate\n            from (\n                  select Id, trans.Type , trans.OrderCode , trans.CreateDate, row_number() over (partition by trans.OrderCode order by Id desc) as rn\n                   from Transaction_Stamp_Log AS trans\n                  ) as t\n            where t.rn = 1\n        "),i=[];r.recordset.forEach((e=>{i.push(e.OrderCode)}));let o="";a&&n&&(o="AND CONVERT(date, a.CreateDate ) BETWEEN @start_date AND @end_date");let d=yield(0,s.createRequestSecond)().input("start_date",c.default.NVarChar,a).input("end_date",c.default.NVarChar,n).input("ndid",c.default.NVarChar,i.join(",")).query(`\n            DECLARE @TempTable TABLE (NdidId NVARCHAR(MAX))\n            INSERT INTO @TempTable (NdidId) SELECT value FROM STRING_SPLIT(@ndid, ',')\n\n            SELECT a.ReferenceId,a.NdidRequestId, c.IdpId, a.CreateDate\n            FROM  Master_Ncb a\n            LEFT JOIN Master_Idp c ON a.BankCode = c.IdpId \n            WHERE  a.NdidRequestId IN ( SELECT NdidId FROM @TempTable)\n            ${o}\n        `),u=[];d.recordset.forEach(((e,t)=>{let a=r.recordset.find((({OrderCode:t})=>t===e.NdidRequestId)),n=N(e.CreateDate),i=N(a.CreateDate);u.push({no:t+1,partner_name:"SET",role:"RP",set:e.ReferenceId,ndid:e.NdidRequestId,create_date:n.date,create_time:n.time,update_date:i.date,update_time:i.time,status:a.Type,price:0,idp:e.IdpId})}));let l=u.length,_=5*l,p=N(Date.now());t.status(200).send({status:200,message:"success",export_date:p.date,sum_item:l,sum_price:_,data:u})}catch(e){t.status(500).send({status:e.status||500,message:e.message})}})),t.developerList=(e,t)=>o(void 0,void 0,void 0,(function*(){try{const e=yield _.Master_Developer.find((0,s.createRequestSecond)(),{});let a=[];e.forEach((e=>{a.push({code:e.developer_code,name:e.developer_name})})),t.status(200).send({status:200,message:"success",data:a})}catch(e){t.status(500).send({status:e.status||500,message:e.message})}})),t.projectList=(e,t)=>o(void 0,void 0,void 0,(function*(){try{const e=yield _.Master_Project.find((0,s.createRequestSecond)(),{});let a=[];e.forEach((e=>{a.push({code:e.project_code,name:e.project_name})})),t.status(200).send({status:200,message:"success",data:a})}catch(e){t.status(500).send({status:e.status||500,message:e.message})}})),t.reportInSummary=(e,t)=>o(void 0,void 0,void 0,(function*(){try{const{period:a,start_date:n,end_date:r}=e.body;let i="",o="",d="";n&&r&&(i="WHERE CONVERT(date, o.CreateDate) BETWEEN @start_date AND @end_date",o="AND CONVERT(date, n.UpdateDate) BETWEEN @start_date AND @end_date",d="AND CONVERT(date, l.UpdateDate) BETWEEN @start_date AND @end_date");const l=yield(0,s.createRequestSecond)().input("period",c.default.Int,parseInt(a)||0).input("start_date",c.default.NVarChar,n).input("end_date",c.default.NVarChar,r).query(`\n                CREATE TABLE #reporttable (Name NVARCHAR(100), IdCard NVARCHAR(100), Sms INT, Ncb INT, Loan INT, CreateDate NVARCHAR(100), Status NVARCHAR(100));\n\n                INSERT INTO #reporttable (Name, IdCard, Sms, Ncb, Loan, CreateDate, Status)\n                SELECT Name, IdCard, sum(Sms) as Sms, sum(Ncb) as Ncb, sum(Loan) as Loan,  \n                    FORMAT(CreateDate, 'dd/MM/yyyy HH:mm') as CreateDate, Status\n                FROM(\n                    SELECT c.FirstName as Name,\n                        o.CitizenId as IdCard,\n                        count(*) as Sms,\n                        0 as Ncb,\n                        0 AS Loan,\n                        o.CreateDate,\n                        o.Token as Id,\n                        CASE WHEN CONVERT(date, o.CreateDate + @period) >= CONVERT(date, getDate()) THEN ''\n                        ELSE 'unsuccess' END as Status\n                    FROM Transaction_Sms_Otp o\n                    INNER JOIN Master_Customer c ON o.CitizenId = c.CitizenId\n                    ${i}\n                    GROUP BY c.FirstName, o.CitizenId, o.CreateDate, o.Token\n\n                    UNION ALL\n\n                    SELECT c.FirstName as Name,\n                        c.CitizenId as IdCard,\n                        0 as Sms,\n                        count(*) as Ncb,\n                        0 AS Loan,\n                        n.CreateDate,\n                        n.NcbId as Id,\n                        'success' as Status\n                    FROM Master_Ncb n\n                    INNER JOIN Master_Customer c ON n.CustomerId = c.CustomerId\n                    INNER JOIN Master_Unit u ON n.UnitId = u.UnitId AND n.ProjectCode = n.ProjectCode\n                    WHERE n.NcbStatusCode <> 'NCB01' AND u.DeveloperCode LIKE'%%' \n                    ${o}\n                    GROUP BY c.FirstName, c.CitizenId, n.CreateDate, n.NcbId\n\n                    UNION ALL\n\n                    SELECT c.FirstName as Name,\n                        c.CitizenId as IdCard,\n                        0 as Sms,\n                        0 as Ncb,\n                        count(*) as Loan,\n                        l.UpdateDate as CreateDate,\n                        ml.LoanId as Id,\n                        'success' as Status\n                    FROM Master_Loan l\n                    INNER JOIN Mapping_Loan ml ON l.LoanId = ml.LoanId \n                    INNER JOIN Master_Customer c ON c.CustomerId = ml.CustomerId\n                    WHERE l.Status <> 'active' AND l.DeveloperCode LIKE'%%'\n                    ${d}\n                    GROUP BY c.FirstName, c.CitizenId, l.UpdateDate,  ml.LoanId\n                ) R\n                GROUP BY Name, IdCard, CreateDate, Status\n                order by Name , CreateDate asc\n\n                SELECT Name, CONCAT(LEFT(IdCard, 3), '*******', RIGHT(IdCard, 3)) AS IdCard, \n                    Sms,Ncb, Loan , CreateDate, IdCard as CitizenId\n                FROM #reporttable \n\n                SELECT Name, \n                    CONCAT(LEFT(IdCard, 3), '*******', RIGHT(IdCard, 3)) AS IdCard, \n                    SmsTotal,\n                    NcbTotal, \n                    LoanTotal, \n                    CASE WHEN CountSuccess > 0 Then 'Success'\n                        WHEN CountUnsuccess = 0 and CountSuccess = 0 THEN ''\n                        ELSE 'Unsuccess' END \n                    as Status,\n                    IdCard as CitizenId\n                FROM (\n                    SELECT Name, IdCard, sum(Sms) as SmsTotal, sum(Ncb) as NcbTotal, sum(Loan) as LoanTotal,\n                        sum(CASE WHEN status = 'success' THEN 1 ELSE 0 END) AS CountSuccess,\n                        sum(CASE WHEN status = 'unsuccess' THEN 1 ELSE 0 END) AS CountUnsuccess,\n                        sum(CASE WHEN status = '' THEN 1 ELSE 0 END) AS CountEmpty\n                    FROM #reporttable \n                    GROUP BY Name, IdCard\n                ) T\n                ORDER BY  Name\n\n                DROP TABLE #reporttable\n            `);let _=[],p=0;if(l.recordsets){let e=(0,f.snakeCaseKeys)(l.recordsets[0]),t=(0,f.snakeCaseKeys)(l.recordsets[1]),a=u.default.groupBy(e,"citizen_id"),n=u.default.groupBy(t,"citizen_id");for(const e in a){let t=[];yield a[e].forEach(((e,a)=>{t.push(u.default.omit(e,["name","id_card","citizen_id"]))}));let r=n[e];p+=1,_.push({no:p,name:r[0].name,id_card:r[0].id_card,transection:t,total:u.default.omit(r[0],["name","id_card","citizen_id"])})}}t.status(200).send({status:200,message:"success",data:_})}catch(e){t.status(500).send({status:e.status||500,message:e.message})}})),t.reportInSumMonitering=(e,t)=>o(void 0,void 0,void 0,(function*(){try{const{year:a}=e.body,n=yield(0,s.createRequestSecond)().input("year",c.default.NVarChar,a).query("\n                CREATE TABLE #sumtable (Year NVARCHAR(100), Month NVARCHAR(100), Sms INT, Ncb INT, Loan INT, SmsOverRate NVARCHAR(200), NcbLoanRate NVARCHAR(100), MonthNumber INT);\n\n                INSERT INTO #sumtable (Year, Month, Sms, Ncb, Loan, SmsOverRate, NcbLoanRate, MonthNumber)\n                    SELECT Year, Month, sum(Sms) as Sms, sum(ncb) as Ncb, sum(Loan) as Loan, \n                            CONCAT(CONVERT(DECIMAL(18,2),ISNULL( ((SUM(Sms)- (SUM(ncb) + SUM(Loan)))/( NULLIF(SUM(ncb) + SUM(Loan) + 0.0 , 0))) * 100, 100)),'%') as SmsOverRate,\n                            CONCAT(CONVERT(DECIMAL(18,2), ISNULL( ( ((SUM(ncb) + SUM(Loan)) - SUM(Sms))/(NULLIF(SUM(Sms) + 0.0,0))) * 100  , 100)), '%') as NcbLoanRate, \n                            MonthNumber\n                    FROM (\n                        SELECT YEAR(CreateDate) as Year,\n                            DATENAME(month, CreateDate) AS Month, \n                            count(*) as Sms,\n                            0 as Ncb,\n                            0 AS Loan,\n                            MONTH(CreateDate) as MonthNumber\n                        FROM Transaction_Sms_Otp\n                        WHERE YEAR(CreateDate) LIKE '%'+ @year +'%'\n                        GROUP BY YEAR(CreateDate),DATENAME(month, CreateDate), MONTH(CreateDate)\n            \n                        UNION ALL\n            \n                        SELECT YEAR(n.UpdateDate) as Year,\n                            DATENAME(month, n.UpdateDate) AS Month,\n                            0 as Sms,\n                            COUNT(*) AS Ncb,\n                            0 as Loan,\n                            MONTH(u.UpdateDate) as MonthNumber\n                        FROM Master_ncb n\n                        INNER JOIN Master_Unit u ON n.UnitId = u.UnitId AND n.ProjectCode = n.ProjectCode\n                        WHERE n.NcbStatusCode <> 'NCB01' AND u.DeveloperCode LIKE'%%' AND YEAR(u.UpdateDate) LIKE '%'+ @year +'%'\n                        GROUP BY YEAR(n.UpdateDate),DATENAME(month, n.UpdateDate), MONTH(u.UpdateDate)\n            \n                        UNION ALL\n            \n                        SELECT YEAR(l.UpdateDate) as Year,\n                            DATENAME(month, l.UpdateDate) AS Month, \n                            0 as Sms,\n                            0 as Ncb,\n                            COUNT(*) AS Loan,\n                            MONTH(l.UpdateDate) as MonthNumber\n                        FROM Master_Loan l\n                        INNER JOIN Mapping_Loan ml ON l.LoanId = ml.LoanId AND ml.TypeOfBorrower = 'Borrower'\n                        WHERE l.Status <> 'active' AND l.DeveloperCode LIKE'%%' AND YEAR(l.UpdateDate) LIKE'%'+ @year +'%'\n                        GROUP BY YEAR(l.UpdateDate),DATENAME(month, l.UpdateDate), MONTH(l.UpdateDate)\n                    ) R\n                    GROUP BY Year, Month, MonthNumber\n                    ORDER BY   Year,  MonthNumber asc\n                    \n                SELECT Year, Month, Sms, Ncb, Loan, SmsOverRate, NcbLoanRate\n                FROM #sumtable\n                ORDER BY   Year, MonthNumber asc\n\n                SELECT Year, SUM(Sms) as SmsTotal, SUM(Ncb) as NcbTotal, SUM(Loan) as LoanTotal, \n                    CONCAT(CONVERT(DECIMAL(18,2),ISNULL( ((SUM(Sms)- (SUM(ncb) + SUM(Loan)))/( NULLIF(SUM(ncb) + SUM(Loan) + 0.0 , 0))) * 100, 100)),'%') as SmsOverRateTotal,\n                    CONCAT(CONVERT(DECIMAL(18,2), ISNULL( ( ((SUM(ncb) + SUM(Loan)) - SUM(Sms))/(NULLIF(SUM(Sms) + 0.0,0))) * 100  , 100)), '%') as NcbLoanRateTotal\n                FROM #sumtable\n                GROUP BY Year\n                    \n                DROP TABLE #sumtable\n            ");let r=[];if(n.recordsets){let e=(0,f.snakeCaseKeys)(n.recordsets[0]),t=(0,f.snakeCaseKeys)(n.recordsets[1]),a=u.default.groupBy(e,"year"),i=u.default.groupBy(t,"year");for(const e in a){let t=[];yield a[e].forEach(((e,a)=>{t.push(u.default.omit(e,["year"]))}));let n=i[e];r.push({year:e,transection:t,total:u.default.omit(n[0],["year"])})}}t.status(200).send({status:200,message:"success",data:r})}catch(e){t.status(500).send({status:e.status||500,message:e.message})}})),t.reportInSumByDev=(e,t)=>o(void 0,void 0,void 0,(function*(){try{const{year:a,developer_code:n}=e.body,r=yield(0,s.createRequestSecond)().input("year",c.default.NVarChar,a).input("developer_code",c.default.NVarChar,n).query("\n                CREATE TABLE #sumdevtable (DeveloperCode NVarChar(200), DeveloperName NVarChar(200), Year NVARCHAR(100), Month NVARCHAR(100), Ncb INT, Loan INT, MonthNumber INT);\n\n                INSERT INTO #sumdevtable (DeveloperCode, DeveloperName, Year, Month, Ncb, Loan, MonthNumber)\n                    SELECT DeveloperCode, DeveloperName, Year, Month,  sum(Ncb) as Ncb, sum(Loan) as Loan , MonthNumber\n                    FROM (\n                        SELECT u.DeveloperCode,  d.DeveloperName, YEAR(n.UpdateDate) as Year,\n                            DATENAME(month, n.UpdateDate) AS Month, \n                            COUNT(*) AS Ncb ,\n                            0 as Loan,\n                            MONTH(n.UpdateDate) as MonthNumber\n                        FROM Master_Ncb n\n                            INNER JOIN Master_Unit u ON n.UnitId = u.UnitId AND n.ProjectCode = n.ProjectCode\n                            INNER JOIN Master_Developer d ON u.DeveloperCode = d.DeveloperCode\n                        WHERE n.NcbStatusCode <> 'NCB01' AND u.DeveloperCode LIKE'%'+ @developer_code +'%' AND YEAR(u.UpdateDate) LIKE '%'+ @year +'%'\n                        GROUP BY u.DeveloperCode,  d.DeveloperName, YEAR(n.UpdateDate),DATENAME(month, n.UpdateDate), MONTH(n.UpdateDate)\n            \n                        UNION ALL\n            \n                        SELECT l.DeveloperCode,  d.DeveloperName, YEAR(l.UpdateDate) as Year,\n                            DATENAME(month, l.UpdateDate) AS Month, \n                            0 as Ncb,\n                            COUNT(*) AS Loan,\n                            MONTH(l.UpdateDate) as MonthNumber\n                        FROM Master_Loan l\n                            INNER JOIN Mapping_Loan ml ON l.LoanId = ml.LoanId AND ml.TypeOfBorrower = 'Borrower'\n                            INNER JOIN Master_Developer d ON l.DeveloperCode = d.DeveloperCode\n                        WHERE l.Status <> 'active' AND l.DeveloperCode LIKE'%'+ @developer_code +'%' AND YEAR(l.UpdateDate) LIKE '%'+ @year +'%'\n                        GROUP BY l.DeveloperCode,  d.DeveloperName, YEAR(l.UpdateDate),DATENAME(month, l.UpdateDate), MONTH(l.UpdateDate)\n                    ) R\n                    GROUP BY DeveloperCode, DeveloperName, Year, Month, MonthNumber\n                    ORDER BY  DeveloperCode, Year, MonthNumber asc\n            \n                SELECT DeveloperCode, DeveloperName, Year, Month, Ncb, Loan \n                FROM #sumdevtable \n                ORDER BY Year, MonthNumber, DeveloperCode\n            \n                SELECT DeveloperCode, SUM(Ncb) as NcbTotal, SUM(Loan) as LoanTotal \n                FROM #sumdevtable  \n                GROUP BY DeveloperCode\n            \n                DROP TABLE #sumdevtable\n            ");let i=[];if(r.recordsets){let e=(0,f.snakeCaseKeys)(r.recordsets[0]),t=(0,f.snakeCaseKeys)(r.recordsets[1]),a=u.default.groupBy(e,"developer_code"),n=u.default.groupBy(t,"developer_code");for(const e in a){let t=[],r=u.default.groupBy(a[e],"year");for(const e in r){let a=[];yield r[e].forEach(((e,t)=>{a.push(u.default.omit(e,["developer_code","developer_name","year"]))})),t.push({year:e,data:a})}let o=n[e];i.push({developer_code:e,developer_name:a[e][0].developer_name,transection:t,total:u.default.omit(o[0],["developer_code"])})}}t.status(200).send({status:200,message:"success",data:i})}catch(e){t.status(500).send({status:e.status||500,message:e.message})}})),t.reportBulkSummary=(e,t)=>o(void 0,void 0,void 0,(function*(){try{const{start_date:a,end_date:n,developer_code:r,project_code:i}=e.body;if(!a||!n||!r)return{status:400,message:"กรุณาระบุ start_date, end_date และ developer_code"};const o=yield _.Master_Developer.findOne((0,s.createRequest)(),{developer_code:r});if(!o)return t.status(400).send({status:400,message:"ไม่พบข้อมูลบริษัท"});e.body.developer_name=null==o?void 0:o.developer_name;const d=yield b(e.body);if(200!=d.status)throw d;t.status(200).send({status:200,message:"success",data:null==d?void 0:d.data})}catch(e){t.status(500).send({status:e.status||500,message:e.message})}})),t.reportBulkDetail=(e,t)=>o(void 0,void 0,void 0,(function*(){try{const{start_date:a,end_date:n,developer_code:r,project_code:i}=e.body;if(!a||!n||!r)return t.status(400).send({status:400,message:"กรุณาระบุ start_date, end_date และ developer_code"});const o=yield _.Master_Developer.findOne((0,s.createRequest)(),{developer_code:r});if(!o)return t.status(400).send({status:400,message:"ไม่พบข้อมูลบริษัท"});e.body.developer_name=null==o?void 0:o.developer_name;const d=yield D(e.body);if(200!=d.status)throw d;t.status(200).send({status:200,message:"success",data:null==d?void 0:d.data})}catch(e){t.status(500).send({status:e.status||500,message:e.message})}})),t.reportBulkSummaryJob=()=>o(void 0,void 0,void 0,(function*(){var e,t,a,n,r,i,o,d,u,l,p,f,y,N,v,E,T;try{const O=yield _.Master_Developer.find((0,s.createRequest)(),{is_active:1});for(var C in O){let _=O[C],R=null==_?void 0:_.developer_code;try{const C={developer_code:R,developer_name:null==_?void 0:_.developer_name},O=yield b(C);if(200==O.status){const _=yield(0,s.createRequest)().input("developer_code",c.default.NVarChar,R).input("year",c.default.NVarChar,null===(e=null==O?void 0:O.data)||void 0===e?void 0:e.year).input("month",c.default.NVarChar,null===(t=null==O?void 0:O.data)||void 0===t?void 0:t.month).query("\n                        SELECT TOP 1 * FROM Transaction_Report \n                        WHERE Type = 'bulk' AND DeveloperCode = @developer_code AND Year = @year AND Month = @month\n                        AND Status IN ('success','pending', 'wait email')\n                    ");let b=(null===(a=null==_?void 0:_.recordset[0])||void 0===a?void 0:a.ReportId)||"";if(!_.recordset[0]){const e=yield D(C);if(200==e.status){const t={bulk_sum_data:null===(n=null==O?void 0:O.data)||void 0===n?void 0:n.bulk_sum_data,bulk_sum_detail:null===(r=null==e?void 0:e.data)||void 0===r?void 0:r.bulk_sum_detail},a={bulk_sum_data:null===(i=null==O?void 0:O.data)||void 0===i?void 0:i.bulk_conflict_data,bulk_sum_detail:null===(o=null==e?void 0:e.data)||void 0===o?void 0:o.conflict_bulk_sum_detail};b=(0,m.v4)(),yield h.Transaction_Report.insert((0,s.createRequest)(),{report_id:b,type:"bulk",data:JSON.stringify(t),data_conflict:JSON.stringify(a),is_conflict:null===(d=null==O?void 0:O.data)||void 0===d?void 0:d.is_conflict,developer_code:R,status:"pending",month_number:null===(u=null==O?void 0:O.data)||void 0===u?void 0:u.month_number,month:null===(l=null==O?void 0:O.data)||void 0===l?void 0:l.month,year:null===(p=null==O?void 0:O.data)||void 0===p?void 0:p.year,create_date:new Date})}}if(b&&!(yield h.Transaction_Email.findOne((0,s.createRequest)(),{job_id:b}))){let e="pending";const t=yield h.Master_Email.findOne((0,s.createRequest)(),{developer_code:R});t&&(null==t?void 0:t.email_to)||(e="wait email"),yield h.Transaction_Email.insert((0,s.createRequest)(),{send_to:(null==t?void 0:t.email_to)||"",send_cc:(null==t?void 0:t.email_cc)?`${null==t?void 0:t.email_cc},`:"",subject:`รายการสรุปยอดค่าใช้จ่ายประจำเดือน${null===(f=null==O?void 0:O.data)||void 0===f?void 0:f.month}`,body:`เรียน ${null===(N=null===(y=null==O?void 0:O.data)||void 0===y?void 0:y.bulk_sum_data)||void 0===N?void 0:N.developer_name}\n\nรายการสรุปยอดค่าใช้จ่ายประจำเดือน${null===(v=null==O?void 0:O.data)||void 0===v?void 0:v.month}\nระหว่างวันที่ ${null===(T=null===(E=null==O?void 0:O.data)||void 0===E?void 0:E.bulk_sum_data)||void 0===T?void 0:T.between_date}\n\n\n\nขอแสดงความนับถือ\nบริษัท ไอคอน เฟรมเวิร์ค จำกัด`,developer_code:R,create_date:new Date,error_count:0,status:e,job_id:b})}}}catch(e){console.log(`${R}, Bulk Report error`)}}return!0}catch(e){return!1}})),t.reportBulkSumaryData=b,t.reportBulkDetailData=D},5222:function(e,t,a){var n="src/controllers/internals",r=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function o(e){try{s(n.next(e))}catch(e){i(e)}}function d(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,d)}s((n=n.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.retryReportNcbJob=t.reportNcbJob=t.reportNcb=t.getfileDecrypt=t.getfile=t.retryReportNcb=t.getReportNcb=void 0;const o=a(2275),d=i(a(7172)),s=i(a(9227)),c=i(a(6113)),u=i(a(7147)),l=i(a(9424)),_=i(a(1017)),p=a(961),f=a(5828),m=i(a(2245)),h=a(3833),y=i(a(7339)),N=u.default.readFileSync(_.default.join(n,"../..","keys","ncb_sftp_private_key.pem"),{encoding:"utf-8"});u.default.readFileSync(_.default.join(n,"../..","keys","ncb_sftp_public_key.pem"),{encoding:"utf-8"});let v=".txt";function E(e,t){return r(this,void 0,void 0,(function*(){try{let a={header_record_type:"H",header_sequence_no:"000001",header_bank_code:"999",header_company_ac:C(10),header_company_name:C(27)+"ICONFRAMEWORK",header_affective_date:C(8),header_service_code:C(8),header_spare:C(180),data_record_type:"D",data_sequence_no:"000001",data_bank_code:C(3),data_company_account:C(10),data_payment_date:"",data_payment_time:"",data_customer_name:"",data_customer_id:"",data_customer_phone:"",data_ref_ndid:"",data_branch_no:C(4),data_teller_no:C(4),data_kind_of_transection:"C",data_transection_code:"000",data_cheque_no:C(7),data_amount:"0000000020000",data_cheque_bank_code:C(3),data_spare:C(77),total_record_type:"T",total_sequence_no:"sum data + 2",total_bank_code:C(3),total_company_ac:C(10),total_debit_payment_comm:C(13),total_debit_transection:C(6),total_debit_payment_amt:"",total_credit_transection:"",total_total_discount:C(13),total_total_vat:C(10),total_spare:C(175)},n=yield(0,o.createRequest)().query(" \n            SELECT t.TransactionId, o.CreateDate\n            FROM  Transaction_Activity_Log t\n            LEFT JOIN  Transaction_Out_Log o ON t.ReferanceId = o.OrderCode\n            WHERE t.Type = 'หักเครดิต(ncb)' AND t.IsCredit = '1'\n        "),r=[];n.recordset.forEach((e=>{r.push(e.TransactionId)}));let i=yield(0,o.createRequestSecond)().input("ncb_id",l.default.NVarChar,r.join(",")).input("date",l.default.Date,t).query("\n                DECLARE @TempTable TABLE (NcbId NVARCHAR(50))\n                INSERT INTO @TempTable (NcbId) SELECT value FROM STRING_SPLIT(@ncb_id, ',')\n\n                SELECT  n.NcbId, n.RequestParams, n.NdidReference, n.IconReferenceNdid\n                FROM Master_Ncb  n \n                LEFT JOIN Master_Project p ON n.ProjectCode = p.ProjectCode \n                LEFT JOIN Master_Developer d ON p.DeveloperCode = d.DeveloperCode\n                LEFT JOIN Master_Ncb_Status c ON n.NcbStatusCode = c.NcbStatusCode \n                WHERE n.NcbId IN ( SELECT NcbId FROM @TempTable) \n                AND c.NcbStatusCode = 'NCB05'\n                --AND CONVERT(date, n.UpdateDate) = CONVERT(date, getDate() - 1)\n                AND CONVERT(date, n.UpdateDate) = @date\n                ORDER BY n.CreateDate ASC\n            "),d="";i.recordset.forEach(((e,t)=>{let r=JSON.parse(e.RequestParams);const i=String(t+2).padStart(6,"0");let o=function(e,t){const a=new Date(e);let n=a.getMonth()+1,r="",i="";{const e=String(n).padStart(2,"0");r=String(a.getDate()).padStart(2,"0")+e+a.getFullYear(),i=String(a.getHours()).padStart(2,"0")+String(a.getMinutes()).padStart(2,"0")+String(a.getSeconds()).padStart(2,"0")}return{date:r,time:i}}(n.recordset.find((({TransactionId:t})=>t===e.NcbId)).CreateDate),s=C(50-r.customer_name.length),c=C(7),u=C(10),l=C(20-JSON.stringify(e.IconReferenceNdid).length);d+=a.data_record_type,d+=i,d+=a.data_bank_code,d+=a.data_company_account,d+=o.date,d+=o.time,d+=s+r.customer_name,d+=c+r.citizen_id,d+=u+r.mobile_number,d+=l+e.IconReferenceNdid,d+=a.data_branch_no,d+=a.data_teller_no,d+=a.data_kind_of_transection,d+=a.data_transection_code,d+=a.data_cheque_no,d+=a.data_amount,d+=a.data_cheque_bank_code,d+=a.data_spare,d+="\n"}));const s=String(i.recordset.length+2).padStart(6,"0"),c=String(i.recordset.length).padStart(6,"0"),u=String(200*i.recordset.length*100).padStart(13,"0");let _=a.header_record_type+a.header_sequence_no+a.header_bank_code+a.header_company_ac+a.header_company_name+(0,m.default)(t).format("DDMMYYYY")+a.header_service_code+a.header_spare,p=a.total_record_type+s+a.total_bank_code+a.total_company_ac+a.total_debit_payment_comm+a.total_debit_transection+u+c+a.total_total_discount+a.total_total_vat+a.total_spare,f=`${_}\n${d}${p}`,h=Buffer.from(f,"utf-8");return console.log(`Created file ${e} successfully.`),{status:!0,meassage:`Created file ${e} successfully`,data:{encrypted_file:h}}}catch(e){return console.log("Create file error:",e),{status:!1,meassage:"Create file error",data:e}}}))}function T(e,t){return r(this,void 0,void 0,(function*(){const a=new d.default;try{yield a.connect({host:process.env.SFTP_IP,port:parseInt(process.env.SFTP_PORT),username:process.env.SFTP_USER,password:process.env.SFTP_PASSWORD}),yield a.put(t,`${process.env.SFTP_FOLDER}/${e}`)}finally{yield a.end()}}))}function C(e){let t="";for(let a=0;a<e;a++)t+=" ";return t}t.getReportNcb=(e,t,a)=>r(void 0,void 0,void 0,(function*(){try{const e=yield p.Log_Report.find((0,o.createRequest)(),{});t.status(200).send({status:200,message:"success",data:e||[]})}catch(e){t.status(500).send({status:500,message:"error",data:e})}})),t.retryReportNcb=(e,t,a)=>r(void 0,void 0,void 0,(function*(){let a=e.body.id;try{const e=yield p.Log_Report.findOne((0,o.createRequest)(),{id:a});if(!e)return console.log(`log id ${a} , Not found data.`),t.status(400).send({status:400,messsage:"Not found data."});if("success"===e.status)return console.log(`log id ${a} , The file already exists.`),t.status(400).send({status:400,messsage:"The file already exists."});a=null==e?void 0:e.id;let n=null==e?void 0:e.name,r=null==e?void 0:e.date;console.log(`log id ${a} ,API retry report date ${r}`);let i=yield E(n,r);if(0==i.status)throw i;yield T(n,i.data.encrypted_file),console.log(`File ${n} uploaded successfully.`),yield p.Log_Report.update((0,o.createRequest)(),{name:n,path:`${process.env.SFTP_FOLDER}/${n}`,status:"success",update_date:new Date},{id:e.id}),t.status(200).send({status:200,message:`File ${n} has been successfully uploaded.`})}catch(e){console.log(`File uploaded fail, Error ===> ${e}`),yield p.Log_Report.update((0,o.createRequest)(),{status:"fail",update_date:new Date,error_message:JSON.stringify(e)},{id:a}),t.status(500).send({status:500,message:"File uploaded fail.",data:e})}})),t.getfile=(e,t,a)=>r(void 0,void 0,void 0,(function*(){try{var a=e.files[0];console.log(a);const n=c.default.randomBytes(16).toString("hex"),i=c.default.createDecipheriv("aes-256-ctr",N,Buffer.from(n,"hex"));let o=Buffer.concat([i.update(a.buffer),i.final()]);console.log(o);const d=yield s.default.loadAsync(o),l=Object.values(d.files);yield Promise.all(l.map((e=>r(void 0,void 0,void 0,(function*(){console.log(e);const t=e.name.split(".");let a=t[t.length-1],n=e.name.replace(a,"txt"),r=yield e.async("nodebuffer");u.default.writeFileSync(n,r),console.log(`Extracted: ${n}`)}))))),t.send(!0)}catch(e){console.log(e),t.send(!1)}})),t.getfileDecrypt=(e,t,a)=>r(void 0,void 0,void 0,(function*(){try{var a=e.files[0];console.log(a);const r=yield(n=a.buffer,new y.default(N).decrypt(n));console.log(r),u.default.writeFileSync(a.originalname,r),t.send(!0)}catch(e){console.log(e),t.send(!1)}var n})),t.reportNcb=(e,t,a)=>r(void 0,void 0,void 0,(function*(){try{const{start_date:n,end_date:r}=e.body,i=yield(0,o.createRequest)().input("start_date",l.default.NVarChar,n).input("end_date",l.default.NVarChar,r).query("\n                DECLARE @TableAllDate TABLE (dateData DATE)\n                INSERT INTO @TableAllDate (dateData)\n                SELECT dateData\n                FROM (\n                    SELECT DATEADD(DAY, number, @start_date) AS dateData\n                    FROM master..spt_values\n                    WHERE type = 'P'\n                    AND DATEADD(DAY, number, @start_date) <= @end_date\n                    AND DATEADD(DAY, number, @start_date) < FORMAT(GETDATE(), 'yyyy-MM-dd')\n                ) AS Dates\n                \n                SELECT dateData FROM @TableAllDate;\n                DELETE FROM @TableAllDate\n                WHERE dateData IN (SELECT Date FROM Log_Report WHERE [Date] IN (SELECT dateData FROM @TableAllDate) GROUP BY Date);\n                \n                SELECT dateData FROM @TableAllDate\n            ");console.log("All dates before the current date ======>",i.recordsets[0]),console.log("All dates of document retrieval ======>",i.recordsets[1]);let d=[],s=0,c=[],u=0;for(var a in i.recordsets[1]){let e=(0,f.v4)(),t=(0,m.default)(i.recordsets[1][a].dateData).format("YYYY-MM-DD");const n=`ICONxNCB_${(0,m.default)(i.recordsets[1][a].dateData).format("DDMMYYYY")}${v}`;try{yield p.Log_Report.insert((0,o.createRequest)(),{id:e,sftp_ip:process.env.SFTP_IP,name:n,path:`${process.env.SFTP_FOLDER}/${n}`,date:t,status:"pending",create_date:new Date});let a=yield E(n,t);if(0==a.status)throw a;yield T(n,a.data.encrypted_file),console.log(`File ${n} uploaded successfully.`),yield p.Log_Report.update((0,o.createRequest)(),{status:"success",update_date:new Date},{id:e}),d.push(n),s+=1}catch(t){console.log(`File  ${n} uploaded fail, Error ===> ${t}`),yield p.Log_Report.update((0,o.createRequest)(),{status:"fail",update_date:new Date,error_message:JSON.stringify(t)},{id:e}),c.push(n),u+=1}}t.status(200).send({status:200,message:`${s} file uploaded successfully, ${u} file uploaded fail.`,data:{file_upload_success:d,file_upload_fail:c}})}catch(e){t.status(500).send({status:500,message:e.message||"error"})}})),t.reportNcbJob=()=>r(void 0,void 0,void 0,(function*(){let e=new Date,t=(0,m.default)(e.setDate(e.getDate()-1)).format("YYYY-MM-DD"),a=(0,m.default)(e).format("DDMMYYYY"),n=((0,m.default)(e).format("HHmmss"),(0,f.v4)());const r=`ICONxNCB_${a}${v}`;try{yield p.Log_Report.insert((0,o.createRequest)(),{id:n,sftp_ip:process.env.SFTP_IP,name:r,path:`${process.env.SFTP_FOLDER}/${r}`,date:t,status:"pending",create_date:new Date});let e=yield E(r,t);if(0==e.status)throw e;return yield T(r,e.data.encrypted_file),console.log(`File ${r} uploaded successfully.`),yield p.Log_Report.update((0,o.createRequest)(),{status:"success",update_date:new Date},{id:n}),!0}catch(e){return console.log(`File  ${r} uploaded fail, Error ===> ${e}`),yield p.Log_Report.update((0,o.createRequest)(),{status:"fail",update_date:new Date,error_message:JSON.stringify(e)},{id:n}),!1}})),t.retryReportNcbJob=()=>r(void 0,void 0,void 0,(function*(){var e,t;let a=new Date,n=(0,m.default)(a.setDate(a.getDate()-1)).format("YYYY-MM-DD"),r=process.env.COUNT_RETRY;try{const a=yield(0,o.createRequest)().input("date",l.default.NVarChar,n).input("count_retry",l.default.Int,parseInt(r)).query("SELECT Id, SftpIP, Name, Path, Data, Date, Status, CountRetry\n                FROM Log_Report\n                WHERE Date = @date AND Status IN('pending','fail') AND CountRetry < @count_retry\n            ");let i=(0,h.snakeCaseKeys)(a.recordset);if(i)for(let a in i){let n=i[a].id,d=null===(e=i[a])||void 0===e?void 0:e.name,s=parseInt(i[a].count_retry+1);yield p.Log_Report.update((0,o.createRequest)(),{count_retry:s,update_date:new Date},{id:n}),console.log(`log id ${n} ,Auto retry count ${s}/${r}`);try{let e=null===(t=i[a])||void 0===t?void 0:t.date,n=yield E(d,e);if(0==n.status)throw n;yield T(d,n.data.encrypted_file),console.log(`File ${d} uploaded successfully.`),yield p.Log_Report.update((0,o.createRequest)(),{name:d,path:`${process.env.SFTP_FOLDER}/${d}`,status:"success",update_date:new Date},{id:i[a].id})}catch(e){console.log(`File  ${d} uploaded fail, Error ===> ${e}`),yield p.Log_Report.update((0,o.createRequest)(),{name:d,path:`${process.env.SFTP_FOLDER}/${d}`,status:"fail",update_date:new Date,error_message:JSON.stringify(e)},{id:n})}}return!0}catch(e){return!1}}))},9966:function(e,t,a){var n=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function o(e){try{s(n.next(e))}catch(e){i(e)}}function d(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,d)}s((n=n.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Master_Developer=void 0;const i=r(a(9424)),o=a(5379);class d{constructor(e){null!=e&&this.loadByData(e)}loadByData(e){this.id=e.id,this.developer_code=e.developer_code,this.developer_name=e.developer_name,this.developer_image_url=e.developer_image_url,this.url_api=e.url_api,this.header_api=e.header_api,this.is_active=e.is_active,this.create_date=e.create_date,this.update_date=e.update_date}insert(e){return d.insert(e,{id:this.id,developer_code:this.developer_code,developer_name:this.developer_name,developer_image_url:this.developer_image_url,url_api:this.url_api,header_api:this.header_api,is_active:this.is_active,create_date:this.create_date,update_date:this.update_date})}static find(e,t){return n(this,void 0,void 0,(function*(){return(yield this.builder.find(e,t)).map((e=>new d(e)))}))}static findOne(e,t){return n(this,void 0,void 0,(function*(){const a=yield this.builder.findOne(e,t);return null==a?null:new d(a)}))}static count(e,t){return n(this,void 0,void 0,(function*(){return yield this.builder.count(e,t)}))}static insert(e,t){return this.builder.insert(e,t)}static update(e,t,a){return this.builder.update(e,t,a)}static delete(e,t){return this.builder.delete(e,t)}}t.Master_Developer=d,d.builder=new o.SqlBuilder("Master_Developer",{id:{name:"Id",type:i.default.Int,is_identity:!1,is_primary:!1},developer_code:{name:"DeveloperCode",type:i.default.NVarChar,is_identity:!1,is_primary:!1},developer_name:{name:"DeveloperName",type:i.default.NVarChar,is_identity:!1,is_primary:!1},developer_image_url:{name:"DeveloperImageUrl",type:i.default.NVarChar,is_identity:!1,is_primary:!1},url_api:{name:"UrlApi",type:i.default.NVarChar,is_identity:!1,is_primary:!1},header_api:{name:"HeaderApi",type:i.default.NVarChar,is_identity:!1,is_primary:!1},is_active:{name:"IsActive",type:i.default.Int,is_identity:!1,is_primary:!1},create_date:{name:"CreateDate",type:i.default.DateTime,is_identity:!1,is_primary:!1},update_date:{name:"UpdateDate",type:i.default.DateTime,is_identity:!1,is_primary:!1}},[],["id","developer_code","developer_name","developer_image_url","url_api","header_api","is_active","create_date","update_date"])},6081:function(e,t,a){var n=this&&this.__createBinding||(Object.create?function(e,t,a,n){void 0===n&&(n=a);var r=Object.getOwnPropertyDescriptor(t,a);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,n,r)}:function(e,t,a,n){void 0===n&&(n=a),e[n]=t[a]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&n(t,e,a);return r(t,e),t},o=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function o(e){try{s(n.next(e))}catch(e){i(e)}}function d(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,d)}s((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.Master_Ncb=void 0;const d=i(a(9424)),s=a(5379);class c{constructor(e,t){if(t){if(null==e)throw new Error("Pool request is required.");this.load(e,t)}else{if(e instanceof d.Request)throw new Error("id is required.");this.loadByData(e)}}load(e,t){return o(this,void 0,void 0,(function*(){const a=yield c.findOne(e,{id:t});this.loadByData(a)}))}loadByData(e){this.id=e.id,this.ncb_id=e.ncb_id,this.is_ncb=e.is_ncb,this.is_ncb_terms=e.is_ncb_terms,this.ncb_status_code=e.ncb_status_code,this.ncb_type=e.ncb_type,this.ncb_count=e.ncb_count,this.bank_code=e.bank_code,this.bank_mode=e.bank_mode,this.reference_id=e.reference_id,this.ndid_request_id=e.ndid_request_id,this.ndid_response=e.ndid_response,this.customer_id=e.customer_id,this.booking_no=e.booking_no,this.contract_id=e.contract_id,this.contract_no=e.contract_no,this.project_code=e.project_code,this.project_name=e.project_name,this.create_date=e.create_date,this.update_date=e.update_date,this.ncb_date_of_expiry=e.ncb_date_of_expiry,this.ndid_reference=e.ndid_reference,this.request_params=e.request_params}insert(e){return c.insert(e,{id:this.id,ncb_id:this.ncb_id,is_ncb:this.is_ncb,is_ncb_terms:this.is_ncb_terms,ncb_status_code:this.ncb_status_code,ncb_type:this.ncb_type,ncb_count:this.ncb_count,bank_code:this.bank_code,bank_mode:this.bank_mode,reference_id:this.reference_id,ndid_request_id:this.ndid_request_id,ndid_response:this.ndid_response,customer_id:this.customer_id,booking_no:this.booking_no,contract_id:this.contract_id,contract_no:this.contract_no,project_code:this.project_code,project_name:this.project_name,create_date:this.create_date,update_date:this.update_date,ncb_date_of_expiry:this.ncb_date_of_expiry,ndid_reference:this.ndid_reference,request_params:this.request_params})}update(e){return c.update(e,{id:this.id,ncb_id:this.ncb_id,is_ncb:this.is_ncb,is_ncb_terms:this.is_ncb_terms,ncb_status_code:this.ncb_status_code,ncb_type:this.ncb_type,ncb_count:this.ncb_count,bank_code:this.bank_code,bank_mode:this.bank_mode,reference_id:this.reference_id,ndid_request_id:this.ndid_request_id,ndid_response:this.ndid_response,customer_id:this.customer_id,booking_no:this.booking_no,contract_id:this.contract_id,contract_no:this.contract_no,project_code:this.project_code,project_name:this.project_name,create_date:this.create_date,update_date:this.update_date,ncb_date_of_expiry:this.ncb_date_of_expiry,ndid_reference:this.ndid_reference,request_params:this.request_params},{id:this.id})}delete(e,t){return c.delete(e,{id:t})}static find(e,t){return o(this,void 0,void 0,(function*(){return(yield this.builder.find(e,t)).map((e=>new c(e)))}))}static findOne(e,t){return o(this,void 0,void 0,(function*(){const a=yield this.builder.findOne(e,t);return null==a?null:new c(a)}))}static count(e,t){return o(this,void 0,void 0,(function*(){return yield this.builder.count(e,t)}))}static insert(e,t){return this.builder.insert(e,t)}static update(e,t,a){return this.builder.update(e,t,a)}static delete(e,t){return this.builder.delete(e,t)}}t.Master_Ncb=c,c.builder=new s.SqlBuilder("Master_Ncb",{id:{name:"Id",type:d.default.Int,is_identity:!0,is_primary:!0},ncb_id:{name:"NcbId",type:d.default.NVarChar,is_identity:!1,is_primary:!0},is_ncb:{name:"IsNcb",type:d.default.Bit,is_identity:!1,is_primary:!1},is_ncb_terms:{name:"IsNcbTerms",type:d.default.Bit,is_identity:!1,is_primary:!1},ncb_status_code:{name:"NcbStatusCode",type:d.default.NVarChar,is_identity:!1,is_primary:!1},ncb_type:{name:"NcbType",type:d.default.NVarChar,is_identity:!1,is_primary:!1},ncb_count:{name:"NcbCount",type:d.default.Int,is_identity:!1,is_primary:!1},bank_code:{name:"BankCode",type:d.default.NVarChar,is_identity:!1,is_primary:!1},bank_mode:{name:"BankMode",type:d.default.Int,is_identity:!1,is_primary:!1},reference_id:{name:"ReferenceId",type:d.default.NVarChar,is_identity:!1,is_primary:!1},ndid_request_id:{name:"NdidRequestId",type:d.default.NVarChar,is_identity:!1,is_primary:!1},ndid_response:{name:"NdidResponse",type:d.default.NVarChar,is_identity:!1,is_primary:!1},customer_id:{name:"CustomerId",type:d.default.NVarChar,is_identity:!1,is_primary:!1},booking_no:{name:"BookingNo",type:d.default.NVarChar,is_identity:!1,is_primary:!1},contract_id:{name:"ContractId",type:d.default.NVarChar,is_identity:!1,is_primary:!1},contract_no:{name:"ContractNo",type:d.default.NVarChar,is_identity:!1,is_primary:!1},project_code:{name:"ProjectCode",type:d.default.NVarChar,is_identity:!1,is_primary:!1},project_name:{name:"ProjectName",type:d.default.NVarChar,is_identity:!1,is_primary:!1},create_date:{name:"CreateDate",type:d.default.DateTime,is_identity:!1,is_primary:!1},update_date:{name:"UpdateDate",type:d.default.DateTime,is_identity:!1,is_primary:!1},ncb_date_of_expiry:{name:"NcbDateOfExpiry",type:d.default.DateTime,is_identity:!1,is_primary:!1},ndid_reference:{name:"NdidReference",type:d.default.Int,is_identity:!1,is_primary:!1},request_params:{name:"RequestParams",type:d.default.NVarChar,is_identity:!1,is_primary:!1}},["id"],["id","ncb_id","is_ncb","is_ncb_terms","ncb_status_code","ncb_type","ncb_count","bank_code","bank_mode","reference_id","ndid_request_id","ndid_response","customer_id","booking_no","contract_id","contract_no","project_code","project_name","create_date","update_date","ncb_date_of_expiry","ndid_reference","request_params"])},4965:function(e,t,a){var n=this&&this.__createBinding||(Object.create?function(e,t,a,n){void 0===n&&(n=a);var r=Object.getOwnPropertyDescriptor(t,a);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,n,r)}:function(e,t,a,n){void 0===n&&(n=a),e[n]=t[a]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&n(t,e,a);return r(t,e),t},o=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function o(e){try{s(n.next(e))}catch(e){i(e)}}function d(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,d)}s((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.Master_Project=void 0;const d=i(a(9424)),s=a(5379);class c{constructor(e,t){if(t){if(null==e)throw new Error("Pool request is required.");this.load(e,t)}else{if(e instanceof d.Request)throw new Error("id is required.");this.loadByData(e)}}load(e,t){return o(this,void 0,void 0,(function*(){const a=yield c.findOne(e,{id:t});this.loadByData(a)}))}loadByData(e){this.id=e.id,this.project_code=e.project_code,this.project_name=e.project_name,this.project_type=e.project_type,this.project_type_name=e.project_type_name,this.developer_code=e.developer_code,this.developer_name=e.developer_name,this.create_date=e.create_date,this.update_date=e.update_date}insert(e){return c.insert(e,{id:this.id,project_code:this.project_code,project_name:this.project_name,project_type:this.project_type,project_type_name:this.project_type_name,developer_code:this.developer_code,developer_name:this.developer_name,create_date:this.create_date,update_date:this.update_date})}update(e){return c.update(e,{id:this.id,project_code:this.project_code,project_name:this.project_name,project_type:this.project_type,project_type_name:this.project_type_name,developer_code:this.developer_code,developer_name:this.developer_name,create_date:this.create_date,update_date:this.update_date},{id:this.id})}delete(e,t){return c.delete(e,{id:t})}static find(e,t){return o(this,void 0,void 0,(function*(){return(yield this.builder.find(e,t)).map((e=>new c(e)))}))}static findOne(e,t){return o(this,void 0,void 0,(function*(){const a=yield this.builder.findOne(e,t);return null==a?null:new c(a)}))}static count(e,t){return o(this,void 0,void 0,(function*(){return yield this.builder.count(e,t)}))}static insert(e,t){return this.builder.insert(e,t)}static update(e,t,a){return this.builder.update(e,t,a)}static delete(e,t){return this.builder.delete(e,t)}}t.Master_Project=c,c.builder=new s.SqlBuilder("Master_Project",{id:{name:"Id",type:d.default.Int,is_identity:!0,is_primary:!0},project_code:{name:"ProjectCode",type:d.default.NVarChar,is_identity:!1,is_primary:!1},project_name:{name:"ProjectName",type:d.default.NVarChar,is_identity:!1,is_primary:!1},project_type:{name:"ProjectType",type:d.default.NVarChar,is_identity:!1,is_primary:!1},project_type_name:{name:"ProjectTypeName",type:d.default.NVarChar,is_identity:!1,is_primary:!1},developer_code:{name:"DeveloperCode",type:d.default.NVarChar,is_identity:!1,is_primary:!1},developer_name:{name:"DeveloperName",type:d.default.NVarChar,is_identity:!1,is_primary:!1},create_date:{name:"CreateDate",type:d.default.DateTime,is_identity:!1,is_primary:!1},update_date:{name:"UpdateDate",type:d.default.DateTime,is_identity:!1,is_primary:!1}},["id"],["id","project_code","project_name","project_type","project_type_name","developer_code","developer_name","create_date","update_date"])},4814:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Master_Developer=t.Master_Project=t.Master_Ncb=void 0;const n=a(6081);Object.defineProperty(t,"Master_Ncb",{enumerable:!0,get:function(){return n.Master_Ncb}});const r=a(4965);Object.defineProperty(t,"Master_Project",{enumerable:!0,get:function(){return r.Master_Project}});const i=a(9966);Object.defineProperty(t,"Master_Developer",{enumerable:!0,get:function(){return i.Master_Developer}})},9506:function(e,t,a){var n=this&&this.__createBinding||(Object.create?function(e,t,a,n){void 0===n&&(n=a);var r=Object.getOwnPropertyDescriptor(t,a);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,n,r)}:function(e,t,a,n){void 0===n&&(n=a),e[n]=t[a]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&n(t,e,a);return r(t,e),t},o=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function o(e){try{s(n.next(e))}catch(e){i(e)}}function d(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,d)}s((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.Log_Report=void 0;const d=i(a(9424)),s=a(5379);class c{constructor(e,t){if(t){if(null==e)throw new Error("Pool request is required.");this.load(e,t)}else{if(e instanceof d.Request)throw new Error("id is required.");this.loadByData(e)}}load(e,t){return o(this,void 0,void 0,(function*(){const a=yield c.findOne(e,{id:t});this.loadByData(a)}))}loadByData(e){this.id=e.id,this.sftp_ip=e.sftp_ip,this.name=e.name,this.path=e.path,this.data=e.data,this.date=e.date,this.status=e.status,this.create_date=e.create_date,this.update_date=e.update_date,this.count_retry=e.count_retry,this.error_message=e.error_message}insert(e){return c.insert(e,{id:this.id,sftp_ip:this.sftp_ip,name:this.name,path:this.path,data:this.data,date:this.date,status:this.status,create_date:this.create_date,update_date:this.update_date,count_retry:this.count_retry,error_message:this.error_message})}update(e){return c.update(e,{id:this.id,sftp_ip:this.sftp_ip,name:this.name,path:this.path,data:this.data,date:this.date,status:this.status,create_date:this.create_date,update_date:this.update_date,count_retry:this.count_retry,error_message:this.error_message},{id:this.id})}delete(e,t){return c.delete(e,{id:t})}static find(e,t){return o(this,void 0,void 0,(function*(){return(yield this.builder.find(e,t)).map((e=>new c(e)))}))}static findOne(e,t){return o(this,void 0,void 0,(function*(){const a=yield this.builder.findOne(e,t);return null==a?null:new c(a)}))}static count(e,t){return o(this,void 0,void 0,(function*(){return yield this.builder.count(e,t)}))}static insert(e,t){return this.builder.insert(e,t)}static update(e,t,a){return this.builder.update(e,t,a)}static delete(e,t){return this.builder.delete(e,t)}}t.Log_Report=c,c.builder=new s.SqlBuilder("Log_Report",{id:{name:"Id",type:d.default.NVarChar,is_identity:!1,is_primary:!0},sftp_ip:{name:"SftpIP",type:d.default.NVarChar,is_identity:!1,is_primary:!1},name:{name:"Name",type:d.default.NVarChar,is_identity:!1,is_primary:!1},path:{name:"Path",type:d.default.NVarChar,is_identity:!1,is_primary:!1},data:{name:"Data",type:d.default.NVarChar,is_identity:!1,is_primary:!1},date:{name:"Date",type:d.default.NVarChar,is_identity:!1,is_primary:!1},status:{name:"Status",type:d.default.NVarChar,is_identity:!1,is_primary:!1},create_date:{name:"CreateDate",type:d.default.DateTime,is_identity:!1,is_primary:!1},update_date:{name:"UpdateDate",type:d.default.DateTime,is_identity:!1,is_primary:!1},count_retry:{name:"CountRetry",type:d.default.Int,is_identity:!1,is_primary:!1},error_message:{name:"ErrorMessage",type:d.default.NVarChar,is_identity:!1,is_primary:!1}},[],["id","sftp_ip","name","path","data","date","status","create_date","update_date","count_retry","error_message"])},3540:function(e,t,a){var n=this&&this.__createBinding||(Object.create?function(e,t,a,n){void 0===n&&(n=a);var r=Object.getOwnPropertyDescriptor(t,a);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,n,r)}:function(e,t,a,n){void 0===n&&(n=a),e[n]=t[a]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&n(t,e,a);return r(t,e),t},o=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function o(e){try{s(n.next(e))}catch(e){i(e)}}function d(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,d)}s((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.Mapping_Role_Module=void 0;const d=i(a(9424)),s=a(5379);class c{constructor(e,t){if(t){if(null==e)throw new Error("Pool request is required.");this.load(e,t)}else{if(e instanceof d.Request)throw new Error("role_id is required.");this.loadByData(e)}}load(e,t){return o(this,void 0,void 0,(function*(){const a=yield c.findOne(e,{role_id:t});this.loadByData(a)}))}loadByData(e){this.role_id=e.role_id,this.module_id=e.module_id}insert(e){return c.insert(e,{role_id:this.role_id,module_id:this.module_id})}update(e){return c.update(e,{role_id:this.role_id,module_id:this.module_id},{role_id:this.role_id})}delete(e,t){return c.delete(e,{role_id:t})}static find(e,t){return o(this,void 0,void 0,(function*(){return(yield this.builder.find(e,t)).map((e=>new c(e)))}))}static findOne(e,t){return o(this,void 0,void 0,(function*(){const a=yield this.builder.findOne(e,t);return null==a?null:new c(a)}))}static count(e,t){return o(this,void 0,void 0,(function*(){return yield this.builder.count(e,t)}))}static insert(e,t){return this.builder.insert(e,t)}static update(e,t,a){return this.builder.update(e,t,a)}static delete(e,t){return this.builder.delete(e,t)}}t.Mapping_Role_Module=c,c.builder=new s.SqlBuilder("Mapping_Role_Module",{role_id:{name:"RoleId",type:d.default.Int,is_identity:!1,is_primary:!0},module_id:{name:"ModuleId",type:d.default.Int,is_identity:!1,is_primary:!0}},[],["role_id","module_id"])},2515:function(e,t,a){var n=this&&this.__createBinding||(Object.create?function(e,t,a,n){void 0===n&&(n=a);var r=Object.getOwnPropertyDescriptor(t,a);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,n,r)}:function(e,t,a,n){void 0===n&&(n=a),e[n]=t[a]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&n(t,e,a);return r(t,e),t},o=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function o(e){try{s(n.next(e))}catch(e){i(e)}}function d(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,d)}s((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.Mapping_Role_User=void 0;const d=i(a(9424)),s=a(5379);class c{constructor(e,t){if(t){if(null==e)throw new Error("Pool request is required.");this.load(e,t)}else{if(e instanceof d.Request)throw new Error("role_id is required.");this.loadByData(e)}}load(e,t){return o(this,void 0,void 0,(function*(){const a=yield c.findOne(e,{role_id:t});this.loadByData(a)}))}loadByData(e){this.role_id=e.role_id,this.user_id=e.user_id}insert(e){return c.insert(e,{role_id:this.role_id,user_id:this.user_id})}update(e){return c.update(e,{role_id:this.role_id,user_id:this.user_id},{role_id:this.role_id})}delete(e,t){return c.delete(e,{role_id:t})}static find(e,t){return o(this,void 0,void 0,(function*(){return(yield this.builder.find(e,t)).map((e=>new c(e)))}))}static findOne(e,t){return o(this,void 0,void 0,(function*(){const a=yield this.builder.findOne(e,t);return null==a?null:new c(a)}))}static count(e,t){return o(this,void 0,void 0,(function*(){return yield this.builder.count(e,t)}))}static insert(e,t){return this.builder.insert(e,t)}static update(e,t,a){return this.builder.update(e,t,a)}static delete(e,t){return this.builder.delete(e,t)}}t.Mapping_Role_User=c,c.builder=new s.SqlBuilder("Mapping_Role_User",{role_id:{name:"RoleId",type:d.default.Int,is_identity:!1,is_primary:!0},user_id:{name:"UserId",type:d.default.Int,is_identity:!1,is_primary:!0}},[],["role_id","user_id"])},8557:function(e,t,a){var n=this&&this.__createBinding||(Object.create?function(e,t,a,n){void 0===n&&(n=a);var r=Object.getOwnPropertyDescriptor(t,a);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,n,r)}:function(e,t,a,n){void 0===n&&(n=a),e[n]=t[a]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&n(t,e,a);return r(t,e),t},o=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function o(e){try{s(n.next(e))}catch(e){i(e)}}function d(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,d)}s((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.Master_Credit_Balance=void 0;const d=i(a(9424)),s=a(5379);class c{constructor(e,t){if(t){if(null==e)throw new Error("Pool request is required.");this.load(e,t)}else{if(e instanceof d.Request)throw new Error("id is required.");this.loadByData(e)}}load(e,t){return o(this,void 0,void 0,(function*(){const a=yield c.findOne(e,{id:t});this.loadByData(a)}))}loadByData(e){this.id=e.id,this.developer_id=e.developer_id,this.total_balance=e.total_balance,this.total_in=e.total_in,this.total_out=e.total_out,this.update_date=e.update_date,this.create_date=e.create_date}insert(e){return c.insert(e,{id:this.id,developer_id:this.developer_id,total_balance:this.total_balance,total_in:this.total_in,total_out:this.total_out,update_date:this.update_date,create_date:this.create_date})}update(e){return c.update(e,{id:this.id,developer_id:this.developer_id,total_balance:this.total_balance,total_in:this.total_in,total_out:this.total_out,update_date:this.update_date,create_date:this.create_date},{id:this.id})}delete(e,t){return c.delete(e,{id:t})}static find(e,t){return o(this,void 0,void 0,(function*(){return(yield this.builder.find(e,t)).map((e=>new c(e)))}))}static findOne(e,t){return o(this,void 0,void 0,(function*(){const a=yield this.builder.findOne(e,t);return null==a?null:new c(a)}))}static insert(e,t){return this.builder.insert(e,t)}static update(e,t,a){return this.builder.update(e,t,a)}static delete(e,t){return this.builder.delete(e,t)}}t.Master_Credit_Balance=c,c.builder=new s.SqlBuilder("Master_Credit_Balance",{id:{name:"Id",type:d.default.Int,is_identity:!0,is_primary:!0},developer_id:{name:"DeveloperId",type:d.default.Int,is_identity:!1,is_primary:!1},total_balance:{name:"TotalBalance",type:d.default.Int,is_identity:!1,is_primary:!1},total_in:{name:"TotalIn",type:d.default.Int,is_identity:!1,is_primary:!1},total_out:{name:"TotalOut",type:d.default.Int,is_identity:!1,is_primary:!1},update_date:{name:"UpdateDate",type:d.default.DateTime,is_identity:!1,is_primary:!1},create_date:{name:"CreateDate",type:d.default.DateTime,is_identity:!1,is_primary:!1}},["id"],["id","developer_id","total_balance","total_in","total_out","update_date","create_date"])},6187:function(e,t,a){var n=this&&this.__createBinding||(Object.create?function(e,t,a,n){void 0===n&&(n=a);var r=Object.getOwnPropertyDescriptor(t,a);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,n,r)}:function(e,t,a,n){void 0===n&&(n=a),e[n]=t[a]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&n(t,e,a);return r(t,e),t},o=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function o(e){try{s(n.next(e))}catch(e){i(e)}}function d(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,d)}s((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.Master_Credit_Free=void 0;const d=i(a(9424)),s=a(5379);class c{constructor(e,t){if(t){if(null==e)throw new Error("Pool request is required.");this.load(e,t)}else{if(e instanceof d.Request)throw new Error("id is required.");this.loadByData(e)}}load(e,t){return o(this,void 0,void 0,(function*(){const a=yield c.findOne(e,{id:t});this.loadByData(a)}))}loadByData(e){this.id=e.id,this.developer_id=e.developer_id,this.total_balance=e.total_balance,this.total_in=e.total_in,this.total_out=e.total_out,this.expired_date=e.expired_date,this.update_date=e.update_date,this.create_date=e.create_date}insert(e){return c.insert(e,{id:this.id,developer_id:this.developer_id,total_balance:this.total_balance,total_in:this.total_in,total_out:this.total_out,expired_date:this.expired_date,update_date:this.update_date,create_date:this.create_date})}update(e){return c.update(e,{id:this.id,developer_id:this.developer_id,total_balance:this.total_balance,total_in:this.total_in,total_out:this.total_out,expired_date:this.expired_date,update_date:this.update_date,create_date:this.create_date},{id:this.id})}delete(e,t){return c.delete(e,{id:t})}static find(e,t){return o(this,void 0,void 0,(function*(){return(yield this.builder.find(e,t)).map((e=>new c(e)))}))}static findOne(e,t){return o(this,void 0,void 0,(function*(){const a=yield this.builder.findOne(e,t);return null==a?null:new c(a)}))}static insert(e,t){return this.builder.insert(e,t)}static update(e,t,a){return this.builder.update(e,t,a)}static delete(e,t){return this.builder.delete(e,t)}}t.Master_Credit_Free=c,c.builder=new s.SqlBuilder("Master_Credit_Free",{id:{name:"Id",type:d.default.Int,is_identity:!0,is_primary:!0},developer_id:{name:"DeveloperId",type:d.default.Int,is_identity:!1,is_primary:!1},total_balance:{name:"TotalBalance",type:d.default.Int,is_identity:!1,is_primary:!1},total_in:{name:"TotalIn",type:d.default.Int,is_identity:!1,is_primary:!1},total_out:{name:"TotalOut",type:d.default.Int,is_identity:!1,is_primary:!1},expired_date:{name:"ExpiredDate",type:d.default.DateTime,is_identity:!1,is_primary:!1},update_date:{name:"UpdateDate",type:d.default.DateTime,is_identity:!1,is_primary:!1},create_date:{name:"CreateDate",type:d.default.DateTime,is_identity:!1,is_primary:!1}},["id"],["id","developer_id","total_balance","total_in","total_out","expired_date","update_date","create_date"])},9521:function(e,t,a){var n=this&&this.__createBinding||(Object.create?function(e,t,a,n){void 0===n&&(n=a);var r=Object.getOwnPropertyDescriptor(t,a);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,n,r)}:function(e,t,a,n){void 0===n&&(n=a),e[n]=t[a]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&n(t,e,a);return r(t,e),t},o=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function o(e){try{s(n.next(e))}catch(e){i(e)}}function d(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,d)}s((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.Master_Description=void 0;const d=i(a(9424)),s=a(5379);class c{constructor(e,t){if(t){if(null==e)throw new Error("Pool request is required.");this.load(e,t)}else{if(e instanceof d.Request)throw new Error("id is required.");this.loadByData(e)}}load(e,t){return o(this,void 0,void 0,(function*(){const a=yield c.findOne(e,{id:t});this.loadByData(a)}))}loadByData(e){this.id=e.id,this.description_code=e.description_code,this.description_text=e.description_text,this.status=e.status}insert(e){return c.insert(e,{id:this.id,description_code:this.description_code,description_text:this.description_text,status:this.status})}update(e){return c.update(e,{id:this.id,description_code:this.description_code,description_text:this.description_text,status:this.status},{id:this.id})}delete(e,t){return c.delete(e,{id:t})}static find(e,t){return o(this,void 0,void 0,(function*(){return(yield this.builder.find(e,t)).map((e=>new c(e)))}))}static findOne(e,t){return o(this,void 0,void 0,(function*(){const a=yield this.builder.findOne(e,t);return null==a?null:new c(a)}))}static count(e,t){return o(this,void 0,void 0,(function*(){return yield this.builder.count(e,t)}))}static insert(e,t){return this.builder.insert(e,t)}static update(e,t,a){return this.builder.update(e,t,a)}static delete(e,t){return this.builder.delete(e,t)}}t.Master_Description=c,c.builder=new s.SqlBuilder("Master_Description",{id:{name:"Id",type:d.default.Int,is_identity:!0,is_primary:!0},description_code:{name:"DescriptionCode",type:d.default.NVarChar,is_identity:!1,is_primary:!1},description_text:{name:"DescriptionText",type:d.default.NVarChar,is_identity:!1,is_primary:!1},status:{name:"Status",type:d.default.NVarChar,is_identity:!1,is_primary:!1}},["id"],["id","description_code","description_text","status"])},47:function(e,t,a){var n=this&&this.__createBinding||(Object.create?function(e,t,a,n){void 0===n&&(n=a);var r=Object.getOwnPropertyDescriptor(t,a);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,n,r)}:function(e,t,a,n){void 0===n&&(n=a),e[n]=t[a]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&n(t,e,a);return r(t,e),t},o=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function o(e){try{s(n.next(e))}catch(e){i(e)}}function d(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,d)}s((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.Master_Developer=void 0;const d=i(a(9424)),s=a(5379);class c{constructor(e,t){if(t){if(null==e)throw new Error("Pool request is required.");this.load(e,t)}else{if(e instanceof d.Request)throw new Error("id is required.");this.loadByData(e)}}load(e,t){return o(this,void 0,void 0,(function*(){const a=yield c.findOne(e,{id:t});this.loadByData(a)}))}loadByData(e){this.id=e.id,this.developer_code=e.developer_code,this.developer_name=e.developer_name,this.developer_image_url=e.developer_image_url,this.url_api=e.url_api,this.header_api=e.header_api,this.is_active=e.is_active,this.create_date=e.create_date,this.update_date=e.update_date}insert(e){return c.insert(e,{id:this.id,developer_code:this.developer_code,developer_name:this.developer_name,developer_image_url:this.developer_image_url,url_api:this.url_api,header_api:this.header_api,is_active:this.is_active,create_date:this.create_date,update_date:this.update_date})}update(e){return c.update(e,{id:this.id,developer_code:this.developer_code,developer_name:this.developer_name,developer_image_url:this.developer_image_url,url_api:this.url_api,header_api:this.header_api,is_active:this.is_active,create_date:this.create_date,update_date:this.update_date},{id:this.id})}delete(e,t){return c.delete(e,{id:t})}static find(e,t){return o(this,void 0,void 0,(function*(){return(yield this.builder.find(e,t)).map((e=>new c(e)))}))}static findOne(e,t){return o(this,void 0,void 0,(function*(){const a=yield this.builder.findOne(e,t);return null==a?null:new c(a)}))}static count(e,t){return o(this,void 0,void 0,(function*(){return yield this.builder.count(e,t)}))}static insert(e,t){return this.builder.insert(e,t)}static update(e,t,a){return this.builder.update(e,t,a)}static delete(e,t){return this.builder.delete(e,t)}}t.Master_Developer=c,c.builder=new s.SqlBuilder("Master_Developer",{id:{name:"Id",type:d.default.Int,is_identity:!0,is_primary:!0},developer_code:{name:"DeveloperCode",type:d.default.NVarChar,is_identity:!1,is_primary:!1},developer_name:{name:"DeveloperName",type:d.default.NVarChar,is_identity:!1,is_primary:!1},developer_image_url:{name:"DeveloperImageUrl",type:d.default.NVarChar,is_identity:!1,is_primary:!1},url_api:{name:"UrlApi",type:d.default.NVarChar,is_identity:!1,is_primary:!1},header_api:{name:"HeaderApi",type:d.default.NVarChar,is_identity:!1,is_primary:!1},is_active:{name:"IsActive",type:d.default.Int,is_identity:!1,is_primary:!1},create_date:{name:"CreateDate",type:d.default.DateTime,is_identity:!1,is_primary:!1},update_date:{name:"UpdateDate",type:d.default.DateTime,is_identity:!1,is_primary:!1}},["id"],["id","developer_code","developer_name","developer_image_url","url_api","header_api","is_active","create_date","update_date"])},2846:function(e,t,a){var n=this&&this.__createBinding||(Object.create?function(e,t,a,n){void 0===n&&(n=a);var r=Object.getOwnPropertyDescriptor(t,a);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,n,r)}:function(e,t,a,n){void 0===n&&(n=a),e[n]=t[a]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&n(t,e,a);return r(t,e),t},o=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function o(e){try{s(n.next(e))}catch(e){i(e)}}function d(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,d)}s((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.Master_Email=void 0;const d=i(a(9424)),s=a(5379);class c{constructor(e,t){if(t){if(null==e)throw new Error("Pool request is required.");this.load(e,t)}else{if(e instanceof d.Request)throw new Error("id is required.");this.loadByData(e)}}load(e,t){return o(this,void 0,void 0,(function*(){const a=yield c.findOne(e,{developer_code:t});this.loadByData(a)}))}loadByData(e){this.developer_code=e.developer_code,this.email_to=e.email_to,this.email_cc=e.email_cc,this.email_support=e.email_support,this.send_date=e.send_date,this.update_date=e.update_date,this.create_date=e.create_date}insert(e){return c.insert(e,{developer_code:this.developer_code,email_to:this.email_to,email_cc:this.email_cc,email_support:this.email_support,send_date:this.send_date,update_date:this.update_date,create_date:this.create_date})}update(e){return c.update(e,{developer_code:this.developer_code,email_to:this.email_to,email_cc:this.email_cc,email_support:this.email_support,send_date:this.send_date,update_date:this.update_date,create_date:this.create_date},{developer_code:this.developer_code})}delete(e,t){return c.delete(e,{developer_code:t})}static find(e,t){return o(this,void 0,void 0,(function*(){return(yield this.builder.find(e,t)).map((e=>new c(e)))}))}static findOne(e,t){return o(this,void 0,void 0,(function*(){const a=yield this.builder.findOne(e,t);return null==a?null:new c(a)}))}static insert(e,t){return this.builder.insert(e,t)}static update(e,t,a){return this.builder.update(e,t,a)}static delete(e,t){return this.builder.delete(e,t)}}t.Master_Email=c,c.builder=new s.SqlBuilder("Master_Email",{developer_code:{name:"DeveloperCode",type:d.default.NVarChar,is_identity:!1,is_primary:!1},email_to:{name:"EmailTo",type:d.default.NVarChar,is_identity:!1,is_primary:!1},email_cc:{name:"EmailCc",type:d.default.NVarChar,is_identity:!1,is_primary:!1},email_support:{name:"EmailSupport",type:d.default.NVarChar,is_identity:!1,is_primary:!1},send_date:{name:"SendDate",type:d.default.NVarChar,is_identity:!1,is_primary:!1},update_date:{name:"UpdateDate",type:d.default.DateTime,is_identity:!1,is_primary:!1},create_date:{name:"CreateDate",type:d.default.DateTime,is_identity:!1,is_primary:!1}},[""],["developer_code","email_to","email_cc","email_support","send_date","update_date","create_date"])},7708:function(e,t,a){var n=this&&this.__createBinding||(Object.create?function(e,t,a,n){void 0===n&&(n=a);var r=Object.getOwnPropertyDescriptor(t,a);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,n,r)}:function(e,t,a,n){void 0===n&&(n=a),e[n]=t[a]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&n(t,e,a);return r(t,e),t},o=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function o(e){try{s(n.next(e))}catch(e){i(e)}}function d(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,d)}s((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.Master_Module=void 0;const d=i(a(9424)),s=a(5379);class c{constructor(e,t){if(t){if(null==e)throw new Error("Pool request is required.");this.load(e,t)}else{if(e instanceof d.Request)throw new Error("id is required.");this.loadByData(e)}}load(e,t){return o(this,void 0,void 0,(function*(){const a=yield c.findOne(e,{id:t});this.loadByData(a)}))}loadByData(e){this.id=e.id,this.path=e.path,this.name=e.name,this.parent_id=e.parent_id,this.developer_id=e.developer_id,this.status=e.status,this.create_date=e.create_date,this.modify_date=e.modify_date,this.seq=e.seq}insert(e){return c.insert(e,{id:this.id,path:this.path,name:this.name,parent_id:this.parent_id,developer_id:this.developer_id,status:this.status,create_date:this.create_date,modify_date:this.modify_date,seq:this.seq})}update(e){return c.update(e,{id:this.id,path:this.path,name:this.name,parent_id:this.parent_id,developer_id:this.developer_id,status:this.status,create_date:this.create_date,modify_date:this.modify_date,seq:this.seq},{id:this.id})}delete(e,t){return c.delete(e,{id:t})}static find(e,t){return o(this,void 0,void 0,(function*(){return(yield this.builder.find(e,t)).map((e=>new c(e)))}))}static findOne(e,t){return o(this,void 0,void 0,(function*(){const a=yield this.builder.findOne(e,t);return null==a?null:new c(a)}))}static count(e,t){return o(this,void 0,void 0,(function*(){return yield this.builder.count(e,t)}))}static insert(e,t){return this.builder.insert(e,t)}static update(e,t,a){return this.builder.update(e,t,a)}static delete(e,t){return this.builder.delete(e,t)}}t.Master_Module=c,c.builder=new s.SqlBuilder("Master_Module",{id:{name:"Id",type:d.default.Int,is_identity:!0,is_primary:!0},path:{name:"Path",type:d.default.NVarChar,is_identity:!1,is_primary:!1},name:{name:"Name",type:d.default.NVarChar,is_identity:!1,is_primary:!1},parent_id:{name:"ParentId",type:d.default.Int,is_identity:!1,is_primary:!1},developer_id:{name:"DeveloperId",type:d.default.Int,is_identity:!1,is_primary:!1},status:{name:"Status",type:d.default.NVarChar,is_identity:!1,is_primary:!1},create_date:{name:"CreateDate",type:d.default.DateTime,is_identity:!1,is_primary:!1},modify_date:{name:"ModifyDate",type:d.default.DateTime,is_identity:!1,is_primary:!1},seq:{name:"Seq",type:d.default.Int,is_identity:!1,is_primary:!1}},["id"],["id","path","name","parent_id","developer_id","status","create_date","modify_date","seq"])},1303:function(e,t,a){var n=this&&this.__createBinding||(Object.create?function(e,t,a,n){void 0===n&&(n=a);var r=Object.getOwnPropertyDescriptor(t,a);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,n,r)}:function(e,t,a,n){void 0===n&&(n=a),e[n]=t[a]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&n(t,e,a);return r(t,e),t},o=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function o(e){try{s(n.next(e))}catch(e){i(e)}}function d(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,d)}s((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.Master_Role=void 0;const d=i(a(9424)),s=a(5379);class c{constructor(e,t){if(t){if(null==e)throw new Error("Pool request is required.");this.load(e,t)}else{if(e instanceof d.Request)throw new Error("id is required.");this.loadByData(e)}}load(e,t){return o(this,void 0,void 0,(function*(){const a=yield c.findOne(e,{id:t});this.loadByData(a)}))}loadByData(e){this.id=e.id,this.name=e.name,this.created_date=e.created_date,this.modified_date=e.modified_date,this.developer_id=e.developer_id}insert(e){return c.insert(e,{id:this.id,name:this.name,created_date:this.created_date,modified_date:this.modified_date,developer_id:this.developer_id})}update(e){return c.update(e,{id:this.id,name:this.name,created_date:this.created_date,modified_date:this.modified_date,developer_id:this.developer_id},{id:this.id})}delete(e,t){return c.delete(e,{id:t})}static find(e,t){return o(this,void 0,void 0,(function*(){return(yield this.builder.find(e,t)).map((e=>new c(e)))}))}static findOne(e,t){return o(this,void 0,void 0,(function*(){const a=yield this.builder.findOne(e,t);return null==a?null:new c(a)}))}static count(e,t){return o(this,void 0,void 0,(function*(){return yield this.builder.count(e,t)}))}static insert(e,t){return this.builder.insert(e,t)}static update(e,t,a){return this.builder.update(e,t,a)}static delete(e,t){return this.builder.delete(e,t)}}t.Master_Role=c,c.builder=new s.SqlBuilder("Master_Role",{id:{name:"Id",type:d.default.Int,is_identity:!0,is_primary:!0},name:{name:"Name",type:d.default.NVarChar,is_identity:!1,is_primary:!1},created_date:{name:"CreatedDate",type:d.default.DateTime,is_identity:!1,is_primary:!1},modified_date:{name:"ModifiedDate",type:d.default.DateTime,is_identity:!1,is_primary:!1},developer_id:{name:"DeveloperId",type:d.default.Int,is_identity:!1,is_primary:!1}},["id"],["id","name","created_date","modified_date","developer_id"])},6328:function(e,t,a){var n=this&&this.__createBinding||(Object.create?function(e,t,a,n){void 0===n&&(n=a);var r=Object.getOwnPropertyDescriptor(t,a);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,n,r)}:function(e,t,a,n){void 0===n&&(n=a),e[n]=t[a]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&n(t,e,a);return r(t,e),t},o=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function o(e){try{s(n.next(e))}catch(e){i(e)}}function d(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,d)}s((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.Master_User=void 0;const d=i(a(9424)),s=a(5379);class c{constructor(e,t){if(t){if(null==e)throw new Error("Pool request is required.");this.load(e,t)}else{if(e instanceof d.Request)throw new Error("id is required.");this.loadByData(e)}}load(e,t){return o(this,void 0,void 0,(function*(){const a=yield c.findOne(e,{id:t});this.loadByData(a)}))}loadByData(e){this.id=e.id,this.first_name=e.first_name,this.last_name=e.last_name,this.email=e.email,this.password=e.password,this.developer_id=e.developer_id,this.created_date=e.created_date,this.modified_date=e.modified_date,this.status=e.status}insert(e){return c.insert(e,{id:this.id,first_name:this.first_name,last_name:this.last_name,email:this.email,password:this.password,developer_id:this.developer_id,created_date:this.created_date,modified_date:this.modified_date,status:this.status})}update(e){return c.update(e,{id:this.id,first_name:this.first_name,last_name:this.last_name,email:this.email,password:this.password,developer_id:this.developer_id,created_date:this.created_date,modified_date:this.modified_date,status:this.status},{id:this.id})}delete(e,t){return c.delete(e,{id:t})}static find(e,t){return o(this,void 0,void 0,(function*(){return(yield this.builder.find(e,t)).map((e=>new c(e)))}))}static findOne(e,t){return o(this,void 0,void 0,(function*(){const a=yield this.builder.findOne(e,t);return null==a?null:new c(a)}))}static count(e,t){return o(this,void 0,void 0,(function*(){return yield this.builder.count(e,t)}))}static insert(e,t){return this.builder.insert(e,t)}static update(e,t,a){return this.builder.update(e,t,a)}static delete(e,t){return this.builder.delete(e,t)}}t.Master_User=c,c.builder=new s.SqlBuilder("Master_User",{id:{name:"Id",type:d.default.Int,is_identity:!0,is_primary:!0},first_name:{name:"FirstName",type:d.default.NVarChar,is_identity:!1,is_primary:!1},last_name:{name:"LastName",type:d.default.NVarChar,is_identity:!1,is_primary:!1},email:{name:"Email",type:d.default.NVarChar,is_identity:!1,is_primary:!1},password:{name:"Password",type:d.default.NVarChar,is_identity:!1,is_primary:!1},developer_id:{name:"DeveloperId",type:d.default.Int,is_identity:!1,is_primary:!1},created_date:{name:"CreatedDate",type:d.default.DateTime,is_identity:!1,is_primary:!1},modified_date:{name:"ModifiedDate",type:d.default.DateTime,is_identity:!1,is_primary:!1},status:{name:"Status",type:d.default.NVarChar,is_identity:!1,is_primary:!1}},["id"],["id","first_name","last_name","email","password","developer_id","created_date","modified_date","status"])},5379:function(e,t,a){var n=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function o(e){try{s(n.next(e))}catch(e){i(e)}}function d(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,d)}s((n=n.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.snakeCaseKeys=t.getWhereText=t.validateParams=t.setWhereParams=t.setRequestParams=t.SqlBuilder=void 0;const i=r(a(6517)),o=r(a(9424)),d=r(a(2245));function s(e,t,a){i.default.forEach(t,((t,n)=>{const r=Object.assign({},a[n]);r.type==o.default.DateTime&&(r.type=o.default.NVarChar,i.default.isDate(t)&&(t=(0,d.default)(t).format("YYYY-MM-DD HH:mm:ss.SSS"))),e.input(r.name,r.type,t)}))}function c(e,t,a){i.default.forEach(t,((t,n)=>{const r=Object.assign({},a[n]);r.type==o.default.DateTime&&(r.type=o.default.NVarChar,i.default.isDate(t)&&(t=(0,d.default)(t).format("YYYY-MM-DD HH:mm:ss.SSS"))),e.input("W_"+r.name,r.type,t)}))}function u(e,t=!1,a,n){var r=i.default.keys(e);return r=i.default.intersection(r,a),t&&(r=i.default.difference(r,n)),[r,e=i.default.pick(e,r)]}function l(e,t){let a="",n=!0;return i.default.forEach(e,((e,r)=>{n&&(a+="WHERE "),a+=null==e?(n?"":"AND")+" ["+t[r].name+"] IS NULL ":(n?"":"AND")+" ["+t[r].name+"] = @W_"+t[r].name+" ",n&&(n=!1)})),a}function _(e){if(i.default.isArray(e))return e.map((e=>_(e)));if(i.default.isDate(e)||0==i.default.isObject(e))return e;var t={};return i.default.map(e,((e,a)=>{i.default.isArray(e)?t[i.default.snakeCase(a)]=i.default.map(e,(e=>_(e))):i.default.isDate(e)?t[i.default.snakeCase(a)]=e:i.default.isObject(e)?t[i.default.snakeCase(a)]=_(e):t[i.default.snakeCase(a)]=e})),t}t.SqlBuilder=class{constructor(e,t,a,n){this.init(e,t,a,n)}init(e,t,a,n){this.TABLE_NAME=e,this.SQL_COLUMN=t,this.IDENTITY_KEY=a,this.ALL_SNAKE_KEY=n}find(e,t){return n(this,void 0,void 0,(function*(){var[a,n]=u(t,!1,this.ALL_SNAKE_KEY,this.IDENTITY_KEY),r=`\n            SELECT *\n            FROM [${this.TABLE_NAME}]\n        `;return r+=l(n,this.SQL_COLUMN),c(e,n,this.SQL_COLUMN),_((yield e.query(r)).recordset)}))}findOne(e,t){return n(this,void 0,void 0,(function*(){const a=yield this.find(e,t);return a.length>0?_(a[0]):null}))}count(e,t){return n(this,void 0,void 0,(function*(){var[a,n]=u(t,!1,this.ALL_SNAKE_KEY,this.IDENTITY_KEY),r=`\n            SELECT COUNT(0) AS RW_LEN\n            FROM [${this.TABLE_NAME}]\n        `;r+=l(n,this.SQL_COLUMN),c(e,n,this.SQL_COLUMN);const i=yield e.query(r);return 0==i.recordset.length?0:i.recordset[0].RW_LEN}))}insert(e,t){return n(this,void 0,void 0,(function*(){var[a,n]=u(t,!0,this.ALL_SNAKE_KEY,this.IDENTITY_KEY),r=`\n            INSERT INTO [${this.TABLE_NAME}]\n            (\n                ${a.map(((e,t)=>`[${this.SQL_COLUMN[e].name}]`))}\n            )\n            VALUES\n            (\n                ${a.map(((e,t)=>`@${this.SQL_COLUMN[e].name}`))}\n            )\n            SELECT SCOPE_IDENTITY() AS [SCOPE_IDENTITY];\n        `;s(e,n,this.SQL_COLUMN);const i=yield e.query(r);return this.IDENTITY_KEY.length>0&&i.recordset.length>0?i.recordset[0].SCOPE_IDENTITY:""}))}update(e,t,a){return n(this,void 0,void 0,(function*(){var[n,r]=u(t,!0,this.ALL_SNAKE_KEY,this.IDENTITY_KEY),[i,o]=u(a,!1,this.ALL_SNAKE_KEY,this.IDENTITY_KEY),d=`\n        UPDATE [${this.TABLE_NAME}]\n        SET\n            ${n.map(((e,t)=>`[${this.SQL_COLUMN[e].name}] = @${this.SQL_COLUMN[e].name}`))}\n        `;d+=l(o,this.SQL_COLUMN),s(e,r,this.SQL_COLUMN),c(e,o,this.SQL_COLUMN),yield e.query(d)}))}delete(e,t){return n(this,void 0,void 0,(function*(){var[a,n]=u(t,!1,this.ALL_SNAKE_KEY,this.IDENTITY_KEY),r=`\n        DELETE [${this.TABLE_NAME}]\n        `;r+=l(n,this.SQL_COLUMN),c(e,n,this.SQL_COLUMN),yield e.query(r)}))}},t.setRequestParams=s,t.setWhereParams=c,t.validateParams=u,t.getWhereText=l,t.snakeCaseKeys=_},7142:function(e,t,a){var n=this&&this.__createBinding||(Object.create?function(e,t,a,n){void 0===n&&(n=a);var r=Object.getOwnPropertyDescriptor(t,a);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,n,r)}:function(e,t,a,n){void 0===n&&(n=a),e[n]=t[a]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&n(t,e,a);return r(t,e),t},o=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function o(e){try{s(n.next(e))}catch(e){i(e)}}function d(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,d)}s((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.Transaction_Activity_Log=void 0;const d=i(a(9424)),s=a(5379);class c{constructor(e,t){if(t){if(null==e)throw new Error("Pool request is required.");this.load(e,t)}else{if(e instanceof d.Request)throw new Error("id is required.");this.loadByData(e)}}load(e,t){return o(this,void 0,void 0,(function*(){const a=yield c.findOne(e,{id:t});this.loadByData(a)}))}loadByData(e){this.id=e.id,this.transaction_id=e.transaction_id,this.developer_id=e.developer_id,this.referance_id=e.referance_id,this.is_credit=e.is_credit,this.is_credit_free=e.is_credit_free,this.type=e.type,this.method=e.method,this.origin=e.origin,this.header=e.header,this.body=e.body,this.response=e.response,this.description_code=e.description_code,this.description=e.description,this.error_message=e.error_message,this.create_date=e.create_date,this.update_date=e.update_date,this.create_by=e.create_by,this.update_by=e.update_by}insert(e){return c.insert(e,{id:this.id,transaction_id:this.transaction_id,developer_id:this.developer_id,referance_id:this.referance_id,is_credit:this.is_credit,is_credit_free:this.is_credit_free,type:this.type,method:this.method,origin:this.origin,header:this.header,body:this.body,response:this.response,description_code:this.description_code,description:this.description,error_message:this.error_message,create_date:this.create_date,update_date:this.update_date,create_by:this.create_by,update_by:this.update_by})}update(e){return c.update(e,{id:this.id,transaction_id:this.transaction_id,developer_id:this.developer_id,referance_id:this.referance_id,is_credit:this.is_credit,is_credit_free:this.is_credit_free,type:this.type,method:this.method,origin:this.origin,header:this.header,body:this.body,response:this.response,description_code:this.description_code,description:this.description,error_message:this.error_message,create_date:this.create_date,update_date:this.update_date,create_by:this.create_by,update_by:this.update_by},{id:this.id})}delete(e,t){return c.delete(e,{id:t})}static find(e,t){return o(this,void 0,void 0,(function*(){return(yield this.builder.find(e,t)).map((e=>new c(e)))}))}static findOne(e,t){return o(this,void 0,void 0,(function*(){const a=yield this.builder.findOne(e,t);return null==a?null:new c(a)}))}static insert(e,t){return this.builder.insert(e,t)}static update(e,t,a){return this.builder.update(e,t,a)}static delete(e,t){return this.builder.delete(e,t)}}t.Transaction_Activity_Log=c,c.builder=new s.SqlBuilder("Transaction_Activity_Log",{id:{name:"Id",type:d.default.Int,is_identity:!0,is_primary:!0},transaction_id:{name:"TransactionId",type:d.default.NVarChar,is_identity:!1,is_primary:!1},developer_id:{name:"DeveloperId",type:d.default.Int,is_identity:!1,is_primary:!1},referance_id:{name:"ReferanceId",type:d.default.NVarChar,is_identity:!1,is_primary:!1},is_credit:{name:"IsCredit",type:d.default.Bit,is_identity:!1,is_primary:!1},is_credit_free:{name:"IsCreditFree",type:d.default.Bit,is_identity:!1,is_primary:!1},type:{name:"Type",type:d.default.NVarChar,is_identity:!1,is_primary:!1},method:{name:"Method",type:d.default.NVarChar,is_identity:!1,is_primary:!1},origin:{name:"Origin",type:d.default.NVarChar,is_identity:!1,is_primary:!1},header:{name:"Header",type:d.default.NVarChar,is_identity:!1,is_primary:!1},body:{name:"Body",type:d.default.NVarChar,is_identity:!1,is_primary:!1},response:{name:"Response",type:d.default.NVarChar,is_identity:!1,is_primary:!1},description_code:{name:"DescriptionCode",type:d.default.NVarChar,is_identity:!1,is_primary:!1},description:{name:"Description",type:d.default.NVarChar,is_identity:!1,is_primary:!1},error_message:{name:"ErrorMessage",type:d.default.NVarChar,is_identity:!1,is_primary:!1},create_date:{name:"CreateDate",type:d.default.DateTime,is_identity:!1,is_primary:!1},update_date:{name:"UpdateDate",type:d.default.DateTime,is_identity:!1,is_primary:!1},create_by:{name:"CreateBy",type:d.default.NVarChar,is_identity:!1,is_primary:!1},update_by:{name:"UpdateBy",type:d.default.NVarChar,is_identity:!1,is_primary:!1}},["id"],["id","transaction_id","developer_id","referance_id","is_credit","is_credit_free","type","method","origin","header","body","response","description_code","description","error_message","create_date","update_date","create_by","update_by"])},3413:function(e,t,a){var n=this&&this.__createBinding||(Object.create?function(e,t,a,n){void 0===n&&(n=a);var r=Object.getOwnPropertyDescriptor(t,a);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,n,r)}:function(e,t,a,n){void 0===n&&(n=a),e[n]=t[a]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&n(t,e,a);return r(t,e),t},o=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function o(e){try{s(n.next(e))}catch(e){i(e)}}function d(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,d)}s((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.Transaction_Email=void 0;const d=i(a(9424)),s=a(5379);class c{constructor(e,t){if(t){if(null==e)throw new Error("Pool request is required.");this.load(e,t)}else{if(e instanceof d.Request)throw new Error("id is required.");this.loadByData(e)}}load(e,t){return o(this,void 0,void 0,(function*(){const a=yield c.findOne(e,{id:t});this.loadByData(a)}))}loadByData(e){this.id=e.id,this.send_to=e.send_to,this.send_cc=e.send_cc,this.subject=e.subject,this.body=e.body,this.developer_code=e.developer_code,this.create_date=e.create_date,this.update_date=e.update_date,this.effective_date=e.effective_date,this.sent_date=e.sent_date,this.error_date=e.error_date,this.error_message=e.error_message,this.error_count=e.error_count,this.status=e.status,this.job_id=e.job_id}insert(e){return c.insert(e,{id:this.id,send_to:this.send_to,send_cc:this.send_cc,subject:this.subject,body:this.body,developer_code:this.developer_code,create_date:this.create_date,update_date:this.update_date,effective_date:this.effective_date,sent_date:this.sent_date,error_date:this.error_date,error_message:this.error_message,error_count:this.error_count,status:this.status,job_id:this.job_id})}update(e){return c.update(e,{id:this.id,send_to:this.send_to,send_cc:this.send_cc,subject:this.subject,body:this.body,developer_code:this.developer_code,create_date:this.create_date,update_date:this.update_date,effective_date:this.effective_date,sent_date:this.sent_date,error_date:this.error_date,error_message:this.error_message,error_count:this.error_count,status:this.status,job_id:this.job_id},{id:this.id})}delete(e,t){return c.delete(e,{id:t})}static find(e,t){return o(this,void 0,void 0,(function*(){return(yield this.builder.find(e,t)).map((e=>new c(e)))}))}static findOne(e,t){return o(this,void 0,void 0,(function*(){const a=yield this.builder.findOne(e,t);return null==a?null:new c(a)}))}static count(e,t){return o(this,void 0,void 0,(function*(){return yield this.builder.count(e,t)}))}static insert(e,t){return this.builder.insert(e,t)}static update(e,t,a){return this.builder.update(e,t,a)}static delete(e,t){return this.builder.delete(e,t)}}t.Transaction_Email=c,c.builder=new s.SqlBuilder("Transaction_Email",{id:{name:"Id",type:d.default.Int,is_identity:!0,is_primary:!0},send_to:{name:"SendTo",type:d.default.NVarChar,is_identity:!1,is_primary:!1},send_cc:{name:"SendCC",type:d.default.NVarChar,is_identity:!1,is_primary:!1},subject:{name:"Subject",type:d.default.NVarChar,is_identity:!1,is_primary:!1},body:{name:"Body",type:d.default.NText,is_identity:!1,is_primary:!1},developer_code:{name:"DeveloperCode",type:d.default.NVarChar,is_identity:!1,is_primary:!1},create_date:{name:"CreateDate",type:d.default.DateTime,is_identity:!1,is_primary:!1},update_date:{name:"UpdateDate",type:d.default.DateTime,is_identity:!1,is_primary:!1},effective_date:{name:"EffectiveDate",type:d.default.DateTime,is_identity:!1,is_primary:!1},sent_date:{name:"SentDate",type:d.default.DateTime,is_identity:!1,is_primary:!1},error_date:{name:"ErrorDate",type:d.default.DateTime,is_identity:!1,is_primary:!1},error_message:{name:"ErrorMessage",type:d.default.NVarChar,is_identity:!1,is_primary:!1},error_count:{name:"ErrorCount",type:d.default.Int,is_identity:!1,is_primary:!1},status:{name:"Status",type:d.default.NVarChar,is_identity:!1,is_primary:!1},job_id:{name:"JobId",type:d.default.NVarChar,is_identity:!1,is_primary:!1}},["id"],["id","send_to","send_cc","subject","body","developer_code","create_date","update_date","effective_date","sent_date","error_date","error_message","error_count","status","job_id"])},1129:function(e,t,a){var n=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function o(e){try{s(n.next(e))}catch(e){i(e)}}function d(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,d)}s((n=n.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Transaction_In_Log=void 0;const i=r(a(9424)),o=a(5379);class d{constructor(e){null!=e&&this.loadByData(e)}loadByData(e){this.id=e.id,this.order_code=e.order_code,this.type=e.type,this.amount=e.amount,this.create_date=e.create_date,this.status=e.status,this.developer_id=e.developer_id}insert(e){return d.insert(e,{id:this.id,order_code:this.order_code,type:this.type,amount:this.amount,create_date:this.create_date,status:this.status,developer_id:this.developer_id})}static find(e,t){return n(this,void 0,void 0,(function*(){return(yield this.builder.find(e,t)).map((e=>new d(e)))}))}static findOne(e,t){return n(this,void 0,void 0,(function*(){const a=yield this.builder.findOne(e,t);return null==a?null:new d(a)}))}static count(e,t){return n(this,void 0,void 0,(function*(){return yield this.builder.count(e,t)}))}static insert(e,t){return this.builder.insert(e,t)}static update(e,t,a){return n(this,void 0,void 0,(function*(){return this.builder.update(e,t,a)}))}static delete(e,t){return this.builder.delete(e,t)}}t.Transaction_In_Log=d,d.builder=new o.SqlBuilder("Transaction_In_Log",{id:{name:"Id",type:i.default.Int,is_identity:!0,is_primary:!1},order_code:{name:"OrderCode",type:i.default.NVarChar,is_identity:!1,is_primary:!1},type:{name:"Type",type:i.default.NVarChar,is_identity:!1,is_primary:!1},amount:{name:"Amount",type:i.default.Int,is_identity:!1,is_primary:!1},create_date:{name:"CreateDate",type:i.default.DateTime,is_identity:!1,is_primary:!1},status:{name:"Status",type:i.default.NVarChar,is_identity:!1,is_primary:!1},developer_id:{name:"DeveloperId",type:i.default.Int,is_identity:!1,is_primary:!1}},["id"],["id","order_code","type","amount","create_date","status","developer_id"])},2343:function(e,t,a){var n=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function o(e){try{s(n.next(e))}catch(e){i(e)}}function d(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,d)}s((n=n.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Transaction_Out_Log=void 0;const i=r(a(9424)),o=a(5379);class d{constructor(e){null!=e&&this.loadByData(e)}loadByData(e){this.id=e.id,this.order_code=e.order_code,this.type=e.type,this.amount=e.amount,this.create_date=e.create_date,this.status=e.status,this.developer_id=e.developer_id}insert(e){return d.insert(e,{id:this.id,order_code:this.order_code,type:this.type,amount:this.amount,create_date:this.create_date,status:this.status,developer_id:this.developer_id})}static find(e,t){return n(this,void 0,void 0,(function*(){return(yield this.builder.find(e,t)).map((e=>new d(e)))}))}static findOne(e,t){return n(this,void 0,void 0,(function*(){const a=yield this.builder.findOne(e,t);return null==a?null:new d(a)}))}static count(e,t){return n(this,void 0,void 0,(function*(){return yield this.builder.count(e,t)}))}static insert(e,t){return this.builder.insert(e,t)}static update(e,t,a){return this.builder.update(e,t,a)}static delete(e,t){return this.builder.delete(e,t)}}t.Transaction_Out_Log=d,d.builder=new o.SqlBuilder("Transaction_Out_Log",{id:{name:"Id",type:i.default.Int,is_identity:!0,is_primary:!1},order_code:{name:"OrderCode",type:i.default.NVarChar,is_identity:!1,is_primary:!1},type:{name:"Type",type:i.default.NVarChar,is_identity:!1,is_primary:!1},amount:{name:"Amount",type:i.default.Int,is_identity:!1,is_primary:!1},create_date:{name:"CreateDate",type:i.default.DateTime,is_identity:!1,is_primary:!1},status:{name:"Status",type:i.default.NVarChar,is_identity:!1,is_primary:!1},developer_id:{name:"DeveloperId",type:i.default.Int,is_identity:!1,is_primary:!1}},["id"],["id","order_code","type","amount","create_date","status","developer_id"])},5817:function(e,t,a){var n=this&&this.__createBinding||(Object.create?function(e,t,a,n){void 0===n&&(n=a);var r=Object.getOwnPropertyDescriptor(t,a);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,n,r)}:function(e,t,a,n){void 0===n&&(n=a),e[n]=t[a]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&n(t,e,a);return r(t,e),t},o=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function o(e){try{s(n.next(e))}catch(e){i(e)}}function d(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,d)}s((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.Transaction_Report=void 0;const d=i(a(9424)),s=a(5379);class c{constructor(e,t){if(t){if(null==e)throw new Error("Pool request is required.");this.load(e,t)}else{if(e instanceof d.Request)throw new Error("id is required.");this.loadByData(e)}}load(e,t){return o(this,void 0,void 0,(function*(){const a=yield c.findOne(e,{report_id:t});this.loadByData(a)}))}loadByData(e){this.report_id=e.report_id,this.type=e.type,this.data=e.data,this.data_conflict=e.data_conflict,this.is_conflict=e.is_conflict,this.developer_code=e.developer_code,this.status=e.status,this.month_number=e.month_number,this.month=e.month,this.year=e.year,this.create_date=e.create_date,this.update_date=e.update_date}insert(e){return c.insert(e,{report_id:this.report_id,type:this.type,data:this.data,data_conflict:this.data_conflict,is_conflict:this.is_conflict,developer_code:this.developer_code,status:this.status,month:this.month,year:this.year,create_date:this.create_date,update_date:this.update_date})}update(e){return c.update(e,{report_id:this.report_id,type:this.type,data:this.data,data_conflict:this.data_conflict,is_conflict:this.is_conflict,developer_code:this.developer_code,status:this.status,month_number:this.month_number,month:this.month,year:this.year,create_date:this.create_date,update_date:this.update_date},{report_id:this.report_id})}delete(e,t){return c.delete(e,{report_id:t})}static find(e,t){return o(this,void 0,void 0,(function*(){return(yield this.builder.find(e,t)).map((e=>new c(e)))}))}static findOne(e,t){return o(this,void 0,void 0,(function*(){const a=yield this.builder.findOne(e,t);return null==a?null:new c(a)}))}static count(e,t){return o(this,void 0,void 0,(function*(){return yield this.builder.count(e,t)}))}static insert(e,t){return this.builder.insert(e,t)}static update(e,t,a){return this.builder.update(e,t,a)}static delete(e,t){return this.builder.delete(e,t)}}t.Transaction_Report=c,c.builder=new s.SqlBuilder("Transaction_Report",{report_id:{name:"ReportId",type:d.default.NVarChar,is_identity:!1,is_primary:!0},type:{name:"Type",type:d.default.NVarChar,is_identity:!1,is_primary:!1},data:{name:"Data",type:d.default.NVarChar,is_identity:!1,is_primary:!1},data_conflict:{name:"DataConflict",type:d.default.NVarChar,is_identity:!1,is_primary:!1},is_conflict:{name:"IsConflict",type:d.default.Bit,is_identity:!1,is_primary:!1},developer_code:{name:"DeveloperCode",type:d.default.NVarChar,is_identity:!1,is_primary:!1},status:{name:"Status",type:d.default.NVarChar,is_identity:!1,is_primary:!1},month_number:{name:"MonthNumber",type:d.default.NVarChar,is_identity:!1,is_primary:!1},month:{name:"Month",type:d.default.NVarChar,is_identity:!1,is_primary:!1},year:{name:"Year",type:d.default.NVarChar,is_identity:!1,is_primary:!1},create_date:{name:"CreateDate",type:d.default.DateTime,is_identity:!1,is_primary:!1},update_date:{name:"UpdateDate",type:d.default.DateTime,is_identity:!1,is_primary:!1}},[],["report_id","type","data","data_conflict","is_conflict","developer_code","status","month_number","month","year","create_date","update_date"])},586:function(e,t,a){var n=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function o(e){try{s(n.next(e))}catch(e){i(e)}}function d(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,d)}s((n=n.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Transaction_Stamp_Log=void 0;const i=r(a(9424)),o=a(5379);class d{constructor(e){null!=e&&this.loadByData(e)}loadByData(e){this.id=e.id,this.order_code=e.order_code,this.type=e.type,this.amount=e.amount,this.create_date=e.create_date,this.status=e.status,this.developer_id=e.developer_id}insert(e){return d.insert(e,{id:this.id,order_code:this.order_code,type:this.type,amount:this.amount,create_date:this.create_date,status:this.status,developer_id:this.developer_id})}static find(e,t){return n(this,void 0,void 0,(function*(){return(yield this.builder.find(e,t)).map((e=>new d(e)))}))}static findOne(e,t){return n(this,void 0,void 0,(function*(){const a=yield this.builder.findOne(e,t);return null==a?null:new d(a)}))}static count(e,t){return n(this,void 0,void 0,(function*(){return yield this.builder.count(e,t)}))}static insert(e,t){return this.builder.insert(e,t)}static update(e,t,a){return this.builder.update(e,t,a)}static delete(e,t){return this.builder.delete(e,t)}}t.Transaction_Stamp_Log=d,d.builder=new o.SqlBuilder("Transaction_Stamp_Log",{id:{name:"Id",type:i.default.Int,is_identity:!0,is_primary:!1},order_code:{name:"OrderCode",type:i.default.NVarChar,is_identity:!1,is_primary:!1},type:{name:"Type",type:i.default.NVarChar,is_identity:!1,is_primary:!1},amount:{name:"Amount",type:i.default.Int,is_identity:!1,is_primary:!1},create_date:{name:"CreateDate",type:i.default.DateTime,is_identity:!1,is_primary:!1},status:{name:"Status",type:i.default.NVarChar,is_identity:!1,is_primary:!1},developer_id:{name:"DeveloperId",type:i.default.Int,is_identity:!1,is_primary:!1}},["id"],["id","order_code","type","amount","create_date","status","developer_id"])},60:function(e,t,a){var n=this&&this.__createBinding||(Object.create?function(e,t,a,n){void 0===n&&(n=a);var r=Object.getOwnPropertyDescriptor(t,a);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,n,r)}:function(e,t,a,n){void 0===n&&(n=a),e[n]=t[a]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&n(t,e,a);return r(t,e),t},o=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function o(e){try{s(n.next(e))}catch(e){i(e)}}function d(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,d)}s((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.Transaction_Token_User=void 0;const d=i(a(9424)),s=a(5379);class c{constructor(e,t){if(t){if(null==e)throw new Error("Pool request is required.");this.load(e,t)}else{if(e instanceof d.Request)throw new Error("id is required.");this.loadByData(e)}}load(e,t){return o(this,void 0,void 0,(function*(){const a=yield c.findOne(e,{id:t});this.loadByData(a)}))}loadByData(e){this.id=e.id,this.user_id=e.user_id,this.token_id=e.token_id,this.status=e.status,this.create_date=e.create_date}insert(e){return c.insert(e,{id:this.id,user_id:this.user_id,token_id:this.token_id,status:this.status,create_date:this.create_date})}update(e){return c.update(e,{id:this.id,user_id:this.user_id,token_id:this.token_id,status:this.status,create_date:this.create_date},{id:this.id})}delete(e,t){return c.delete(e,{id:t})}static find(e,t){return o(this,void 0,void 0,(function*(){return(yield this.builder.find(e,t)).map((e=>new c(e)))}))}static findOne(e,t){return o(this,void 0,void 0,(function*(){const a=yield this.builder.findOne(e,t);return null==a?null:new c(a)}))}static count(e,t){return o(this,void 0,void 0,(function*(){return yield this.builder.count(e,t)}))}static insert(e,t){return this.builder.insert(e,t)}static update(e,t,a){return this.builder.update(e,t,a)}static delete(e,t){return this.builder.delete(e,t)}}t.Transaction_Token_User=c,c.builder=new s.SqlBuilder("Transaction_Token_User",{id:{name:"Id",type:d.default.Int,is_identity:!0,is_primary:!0},user_id:{name:"UserId",type:d.default.NVarChar,is_identity:!1,is_primary:!1},token_id:{name:"TokenId",type:d.default.NVarChar,is_identity:!1,is_primary:!1},status:{name:"Status",type:d.default.NVarChar,is_identity:!1,is_primary:!1},create_date:{name:"CreateDate",type:d.default.DateTime,is_identity:!1,is_primary:!1}},["id"],["id","user_id","token_id","status","create_date"])},961:(e,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Log_Report=t.Transaction_Token_User=t.Transaction_Email=t.Transaction_Stamp_Log=t.Transaction_Out_Log=t.Transaction_In_Log=t.Transaction_Report=t.Transaction_Activity_Log=t.Master_User=t.Master_Role=t.Master_Module=t.Master_Email=t.Master_Developer=t.Master_Description=t.Master_Credit_Free=t.Master_Credit_Balance=t.Mapping_Role_User=t.Mapping_Role_Module=void 0;const n=a(3540);Object.defineProperty(t,"Mapping_Role_Module",{enumerable:!0,get:function(){return n.Mapping_Role_Module}});const r=a(2515);Object.defineProperty(t,"Mapping_Role_User",{enumerable:!0,get:function(){return r.Mapping_Role_User}});const i=a(8557);Object.defineProperty(t,"Master_Credit_Balance",{enumerable:!0,get:function(){return i.Master_Credit_Balance}});const o=a(6187);Object.defineProperty(t,"Master_Credit_Free",{enumerable:!0,get:function(){return o.Master_Credit_Free}});const d=a(9521);Object.defineProperty(t,"Master_Description",{enumerable:!0,get:function(){return d.Master_Description}});const s=a(47);Object.defineProperty(t,"Master_Developer",{enumerable:!0,get:function(){return s.Master_Developer}});const c=a(2846);Object.defineProperty(t,"Master_Email",{enumerable:!0,get:function(){return c.Master_Email}});const u=a(7708);Object.defineProperty(t,"Master_Module",{enumerable:!0,get:function(){return u.Master_Module}});const l=a(1303);Object.defineProperty(t,"Master_Role",{enumerable:!0,get:function(){return l.Master_Role}});const _=a(6328);Object.defineProperty(t,"Master_User",{enumerable:!0,get:function(){return _.Master_User}});const p=a(7142);Object.defineProperty(t,"Transaction_Activity_Log",{enumerable:!0,get:function(){return p.Transaction_Activity_Log}});const f=a(5817);Object.defineProperty(t,"Transaction_Report",{enumerable:!0,get:function(){return f.Transaction_Report}});const m=a(1129);Object.defineProperty(t,"Transaction_In_Log",{enumerable:!0,get:function(){return m.Transaction_In_Log}});const h=a(2343);Object.defineProperty(t,"Transaction_Out_Log",{enumerable:!0,get:function(){return h.Transaction_Out_Log}});const y=a(586);Object.defineProperty(t,"Transaction_Stamp_Log",{enumerable:!0,get:function(){return y.Transaction_Stamp_Log}});const N=a(3413);Object.defineProperty(t,"Transaction_Email",{enumerable:!0,get:function(){return N.Transaction_Email}});const v=a(60);Object.defineProperty(t,"Transaction_Token_User",{enumerable:!0,get:function(){return v.Transaction_Token_User}});const E=a(9506);Object.defineProperty(t,"Log_Report",{enumerable:!0,get:function(){return E.Log_Report}})},2821:function(e,t,a){var n=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function o(e){try{s(n.next(e))}catch(e){i(e)}}function d(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,d)}s((n=n.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.withOAuth=t.withAuthen=void 0;const i=r(a(5960)),o=a(2275),d=a(961),s=r(a(6517)),c=r(a(6113));t.withAuthen=(e,t,a)=>n(void 0,void 0,void 0,(function*(){try{if(!e.headers.authorization||"Bearer"!==e.headers.authorization.split(" ")[0])throw new Error("No Token");{const t=e.headers.authorization.split(" ")[1];if(!(yield d.Transaction_Token_User.findOne((0,o.createRequest)(),{token_id:t,status:"active"})))throw new Error("Token Unavailable");{const n=i.default.verify(t,null);if(!n||!n.id)throw new Error("Token Expired");{const t=yield d.Master_User.findOne((0,o.createRequest)(),{id:n.id,status:"active"});if(!t)throw new Error("User Unavailable");e.auth=s.default.omit(t,["password","created_date","modified_date","status"]),a()}}}}catch(e){t.status(401).send({status:401,message:e.message,expired:!0})}})),t.withOAuth=(e,t,a)=>n(void 0,void 0,void 0,(function*(){try{if(!e.headers.authorization||"Bearer"!==e.headers.authorization.split(" ")[0])throw new Error("authorize error");if(!(yield d.Transaction_Token_User.findOne((0,o.createRequest)(),{token_id:e.headers.authorization.split(" ")[1]})))throw new Error("authorize error");{const t=i.default.verify(e.headers.authorization.split(" ")[1],null);if(!t||!t.result)throw new Error("authorize error");{let e=c.default.createHmac("sha256",process.env.TOKEN_CLIENT_ID+"+"+process.env.TOKEN_CLIENT_SECRET).update(process.env.TOKEN_CLIENT_SIG).digest("base64");if(t.result!==e)throw new Error("authorize error")}}a()}catch(e){t.status(401).send({code:401,error:"authorize error"})}}))},4041:function(e,t,a){var n=this&&this.__createBinding||(Object.create?function(e,t,a,n){void 0===n&&(n=a);var r=Object.getOwnPropertyDescriptor(t,a);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,n,r)}:function(e,t,a,n){void 0===n&&(n=a),e[n]=t[a]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&n(t,e,a);return r(t,e),t};Object.defineProperty(t,"__esModule",{value:!0});const o=i(a(2116)),d=i(a(6777));t.default={reportNcbJob:o,reportBulkJob:d}},6777:function(e,t,a){var n=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function o(e){try{s(n.next(e))}catch(e){i(e)}}function d(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,d)}s((n=n.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.cancel=t.sendMail=t.start=void 0;const i=r(a(5022)),o=r(a(7344)),d=a(5373),s=a(7123);let c=null;t.start=()=>{c=o.default.scheduleJob(process.env.BULK_JOB_RUN_TIME,(()=>n(void 0,void 0,void 0,(function*(){try{yield(0,d.reportBulkSummaryJob)(),console.log(i.default.yellowBright.inverse("Report bulk job started, Run at 00:15 on the first day of every month"))}catch(e){console.error(e)}}))))},t.sendMail=()=>{c=o.default.scheduleJob(process.env.BULK_MAIL_JOB_RUN_TIME,(()=>n(void 0,void 0,void 0,(function*(){try{yield(0,s.sendMailBulkSummaryJob)(),console.log(i.default.yellowBright.inverse("Send report bulk to email job started, Run at 8:00 AM on the first day of every month"))}catch(e){console.error(e)}}))))},t.cancel=()=>{c&&c.cancel()}},2116:function(e,t,a){var n=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function o(e){try{s(n.next(e))}catch(e){i(e)}}function d(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,d)}s((n=n.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.cancel=t.retry=t.start=void 0;const i=r(a(5022)),o=r(a(7344)),d=a(5222);let s=null;t.start=()=>{s=o.default.scheduleJob(process.env.SFTP_JOB_RUN_TIME,(()=>n(void 0,void 0,void 0,(function*(){try{console.log(new Date),yield(0,d.reportNcbJob)(),console.log(i.default.yellowBright.inverse("Report NCB job started, This job runs at 00:10 every day"))}catch(e){console.error(e)}}))))},t.retry=()=>{s=o.default.scheduleJob(process.env.SFTP_RETRY_JOB_RUN_TIME,(()=>n(void 0,void 0,void 0,(function*(){try{console.log(new Date),yield(0,d.retryReportNcbJob)(),console.log(i.default.yellowBright.inverse("Retry report NCB job started, This job is run every day from 00:11 to 00:20"))}catch(e){console.error(e)}}))))},t.cancel=()=>{s&&s.cancel()}},7728:function(e,t,a){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(a(6860)),i=n(a(5045)),o=n(a(3685)),d=n(a(5142)),s=n(a(5022)),c=n(a(7806)),u=n(a(6891)),l=n(a(3582)),_=n(a(7455)),p=n(a(9470)),f=a(3833),m=a(2275),h=n(a(5960)),y=n(a(1017)),N=n(a(4041));let v;const E=d.default.config();if(E.error)throw E.error;E.parsed;const T=(0,r.default)();T.use((0,c.default)({crossOriginEmbedderPolicy:!1})),T.use((0,u.default)()),T.use((0,l.default)({origin:"*",methods:["GET","POST","DELETE","UPDATE","PUT","PATCH","HEAD"]})),T.use((0,_.default)()),T.use(r.default.json({limit:"20mb"})),T.use(r.default.urlencoded({extended:!0})),T.use((0,p.default)("dev")),T.use(i.default),T.use((function(e,t,a,n){if(a.headersSent)return n(e);e.status&&e.status<500?f.logger.info(e.message):e.stack?f.logger.error(e.stack):f.logger.info(e.message),a.status(e.status||500).send({error_code:e.status||500,error_message:e.message||"System error, Something went wrong"})}));const C={server:process.env.DB_HOST,user:process.env.DB_USER,password:process.env.DB_PASSWORD,database:process.env.DB_NAME,requestTimeout:5e4,connectionTimeout:5e4,pool:{max:10,min:0,idleTimeoutMillis:3e4},options:{encrypt:!1,rowCollectionOnDone:!0,useUTC:!1,enableArithAbort:!0}},b={server:process.env.DB_HOST,user:process.env.DB_USER,password:process.env.DB_PASSWORD,database:process.env.DB_NAME_SECOND,requestTimeout:5e4,connectionTimeout:5e4,pool:{max:10,min:0,idleTimeoutMillis:3e4},options:{encrypt:!1,rowCollectionOnDone:!0,useUTC:!1,enableArithAbort:!0}};h.default.setKeyFromPath("src/keys"),T.use("/api/statics",r.default.static(y.default.join("src","../public"))),T.use("/images",r.default.static("./images/")),Promise.all([(0,m.createPoolFirst)(C),(0,m.createPoolSecond)(b)]).then((()=>{console.log(s.default.green.inverse("Pool connected")),v=new Date,"true"===process.env.REPORT_NCB_JOB&&N.default.reportNcbJob.start(),"true"===process.env.RETRY_REPORT_NCB_JOB&&N.default.reportNcbJob.retry(),"true"===process.env.REPORT_BULK_JOB&&N.default.reportBulkJob.start(),"true"===process.env.REPORT_BULK_MAIL_JOB&&N.default.reportBulkJob.sendMail(),o.default.createServer(T).listen(process.env.PORT,(()=>{console.log(s.default.green.inverse(`Listening on port ${process.env.PORT}`))}))})).catch((e=>{console.log(s.default.red.inverse("Pool connect error"),e)}))},82:function(e,t,a){var n=this&&this.__awaiter||function(e,t,a,n){return new(a||(a=Promise))((function(r,i){function o(e){try{s(n.next(e))}catch(e){i(e)}}function d(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?r(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,d)}s((n=n.apply(e,t||[])).next())}))},r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.sendMail=void 0;const i=a(448);r(a(5142)).default.config(),t.sendMail=e=>n(void 0,void 0,void 0,(function*(){try{let t="",a="",n=[];return t=null==e?void 0:e.text,a=null==e?void 0:e.html,n=null==e?void 0:e.attachments,yield i.transport.sendMail({to:e.send_to.split(","),cc:e.send_cc.split(","),from:process.env.EMAIL_USERNAME,subject:e.subject,text:t,html:a,attachments:n}),{status:!0,message:"success"}}catch(e){return{status:!1,message:"fail",error:e}}}))},3833:function(e,t,a){var n=this&&this.__createBinding||(Object.create?function(e,t,a,n){void 0===n&&(n=a);var r=Object.getOwnPropertyDescriptor(t,a);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,n,r)}:function(e,t,a,n){void 0===n&&(n=a),e[n]=t[a]}),r=this&&this.__exportStar||function(e,t){for(var a in e)"default"===a||Object.prototype.hasOwnProperty.call(t,a)||n(t,e,a)},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.snakeCaseKeys=void 0;const o=i(a(6517));r(a(9572),t),t.snakeCaseKeys=e=>{if(o.default.isDate(e)||0==o.default.isObject(e))return e;function a(e){let a={};return o.default.map(e,((e,n)=>{o.default.isArray(e)?a[o.default.snakeCase(n)]=o.default.map(e,(e=>(0,t.snakeCaseKeys)(e))):o.default.isDate(e)?a[o.default.snakeCase(n)]=e:o.default.isObject(e)?a[o.default.snakeCase(n)]=(0,t.snakeCaseKeys)(e):a[o.default.snakeCase(n)]=e})),a}return o.default.isArray(e)?o.default.map(e,(e=>a(e))):a(e)}},5960:function(e,t,a){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const r=n(a(7147)),i=n(a(9344));var o="",d="";t.default={setKey:(e,t)=>{o=e,d=t},setKeyFromPath:e=>{var t,a;o=null===(t=r.default.readFileSync(`${e}/private_key.pem`,"utf8"))||void 0===t?void 0:t.toString(),d=null===(a=r.default.readFileSync(`${e}/public_key.pem`,"utf8"))||void 0===a?void 0:a.toString()},sign:(e,t)=>i.default.sign(e,o,t),verify:(e,t)=>{try{return i.default.verify(e,d,t)}catch(e){return!1}},decode:e=>i.default.decode(e,{complete:!0})}},9572:function(e,t,a){var n=this&&this.__createBinding||(Object.create?function(e,t,a,n){void 0===n&&(n=a);var r=Object.getOwnPropertyDescriptor(t,a);r&&!("get"in r?!t.__esModule:r.writable||r.configurable)||(r={enumerable:!0,get:function(){return t[a]}}),Object.defineProperty(e,n,r)}:function(e,t,a,n){void 0===n&&(n=a),e[n]=t[a]}),r=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)"default"!==a&&Object.prototype.hasOwnProperty.call(e,a)&&n(t,e,a);return r(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),t.logger=void 0;const o=i(a(7773));t.logger=o.default.createLogger({format:o.format.combine(o.format.timestamp(),o.format.splat(),o.format.simple()),transports:[new o.default.transports.File({filename:"error.log",level:"error"}),new o.default.transports.File({filename:"combined.log",level:"info"})],exceptionHandlers:[new o.default.transports.File({filename:"exceptions.log"})]})},7096:e=>{e.exports=require("bcrypt")},5022:e=>{e.exports=require("chalk")},7455:e=>{e.exports=require("compression")},3582:e=>{e.exports=require("cors")},5142:e=>{e.exports=require("dotenv")},6860:e=>{e.exports=require("express")},7806:e=>{e.exports=require("helmet")},9344:e=>{e.exports=require("jsonwebtoken")},9227:e=>{e.exports=require("jszip")},6517:e=>{e.exports=require("lodash")},3027:e=>{e.exports=require("maskdata")},2245:e=>{e.exports=require("moment")},9470:e=>{e.exports=require("morgan")},9424:e=>{e.exports=require("mssql")},1738:e=>{e.exports=require("multer")},6891:e=>{e.exports=require("nocache")},7339:e=>{e.exports=require("node-rsa")},7344:e=>{e.exports=require("node-schedule")},5184:e=>{e.exports=require("nodemailer")},6753:e=>{e.exports=require("sheetjs-style")},7172:e=>{e.exports=require("ssh2-sftp-client")},5828:e=>{e.exports=require("uuid")},7773:e=>{e.exports=require("winston")},6113:e=>{e.exports=require("crypto")},7147:e=>{e.exports=require("fs")},3685:e=>{e.exports=require("http")},1017:e=>{e.exports=require("path")}},t={};!function a(n){var r=t[n];if(void 0!==r)return r.exports;var i=t[n]={exports:{}};return e[n].call(i.exports,i,i.exports,a),i.exports}(7728)})();